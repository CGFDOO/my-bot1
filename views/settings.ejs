<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Control | ุฅุนุฏุงุฏุงุช ุงูุณูุฑูุฑ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] },
                    colors: { brand: { DEFAULT: '#5865F2', dark: '#4752C4', light: '#7289DA' }, dark: { 900: '#0b0f19', 800: '#151b2b', 700: '#1f2937', 600: '#334155' } }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0b0f19; color: #f8fafc; overflow-x: hidden; scroll-behavior: smooth; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0b0f19; }
        ::-webkit-scrollbar-thumb { background: #1f2937; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #5865F2; }
        
        .glass-card { background: rgba(21, 27, 43, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.05); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }
        .input-glow:focus { box-shadow: 0 0 0 3px rgba(88, 101, 242, 0.25); border-color: #5865F2; outline: none; }
        
        .settings-section { display: none; animation: fadeIn 0.4s ease forwards; }
        .settings-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ๐๏ธ ุงูุฅุตูุงุญ ุงูุฌุฐุฑู ูุฃุฒุฑุงุฑ ุงูุชูุนูู (Toggles) ูุชุชุญุฑู ุจูุนููุฉ ูุจุฏูู ุฃุฎุทุงุก */
        .toggle-checkbox:checked { right: 0; border-color: #10B981; }
        .toggle-checkbox:checked + .toggle-label { background-color: #10B981; }
        .toggle-checkbox { right: auto; left: 0; z-index: 1; border-color: #374151; transition: all 0.3s ease; }
        .toggle-label { background-color: #374151; border-radius: 9999px; transition: all 0.3s ease; }
        .toggle-checkbox:checked { transform: translateX(100%); }
    </style>
</head>

<% 
    let textChannels = []; let voiceChannels = []; let categories = []; let serverRoles = [];
    let guildName = "Unknown Server"; let guildIconUrl = "https://cdn.discordapp.com/embed/avatars/0.png";

    if (bot && guildId) {
        const currentGuild = bot.guilds.cache.get(guildId);
        if (currentGuild) {
            guildName = currentGuild.name;
            if (currentGuild.icon) guildIconUrl = `https://cdn.discordapp.com/icons/${guildId}/${currentGuild.icon}.png`;
            textChannels = currentGuild.channels.cache.filter(c => c.type === 0 || c.type === 5 || c.type === 15).sort((a,b) => a.position - b.position).map(c => ({ id: c.id, name: c.name }));
            categories = currentGuild.channels.cache.filter(c => c.type === 4).sort((a,b) => a.position - b.position).map(c => ({ id: c.id, name: c.name }));
            serverRoles = currentGuild.roles.cache.filter(r => r.id !== guildId).sort((a,b) => b.position - a.position).map(r => ({ id: r.id, name: r.name }));
        }
    }
%>

<body class="flex h-screen overflow-hidden selection:bg-brand selection:text-white">

    <aside class="w-72 flex-shrink-0 border-l border-dark-700 bg-dark-800 flex flex-col z-20 shadow-2xl">
        <div class="h-24 flex flex-col items-center justify-center border-b border-dark-700 bg-dark-900/50">
            <h1 class="text-2xl font-black text-white tracking-wider">MNC <span class="text-brand">CONTROL</span></h1>
        </div>
        <nav class="flex-1 overflow-y-auto py-6 px-4 space-y-1.5 custom-scrollbar" id="sidebar-nav">
            <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 px-2">ุงูุฃุณุงุณูุงุช ูุงูุฐูุงุก ุงูุงุตุทูุงุนู</div>
            <button onclick="switchSection('general')" class="nav-btn active-nav w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all bg-brand text-white font-bold" data-target="general"><span>โ๏ธ</span> <span>ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูุงูุฃููุงู</span></button>
            <button onclick="switchSection('ai_system')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-amber-400 hover:bg-dark-700 font-bold" data-target="ai_system"><span>โจ</span> <span>ุงูุฐูุงุก ุงูุงุตุทูุงุนู (AI)</span></button>
            <button onclick="switchSection('live_embed')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="live_embed"><span>๐จ</span> <span>ุตุงูุน ุงูุฅููุจุฏ ุงูุญุฑ</span></button>

            <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 mt-6 px-2">ุงูุชุฐุงูุฑ ูุงููุณุงุทุฉ</div>
            <button onclick="switchSection('middleman')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="middleman"><span>โ๏ธ</span> <span>ุงููุณุงุทุฉ (ุงููุนุฒูู)</span></button>
            <button onclick="switchSection('custom_panels')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="custom_panels"><span>๐ซ</span> <span>ุงูุจุงููุงุช ุงูุฏููุงููููุฉ</span></button>
            <button onclick="switchSection('ticket_controls')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="ticket_controls"><span>๐๏ธ</span> <span>ุงูุชุญูู ุงูุฏุงุฎูู ููุชูุช</span></button>

            <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 mt-6 px-2">ุงูุชููููุงุช ูุงูุฃูุงูุฑ</div>
            <button onclick="switchSection('ratings')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="ratings"><span>โญ</span> <span>ุงูุชููููุงุช ุงููุฒุฏูุฌุฉ</span></button>
            <button onclick="switchSection('roles')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="roles"><span>๐</span> <span>ุงูุฑุชุจ ูุงูุตูุงุญูุงุช</span></button>
            <button onclick="switchSection('commands')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="commands"><span>โจ๏ธ</span> <span>ุชุฎุตูุต ุงูุฃูุงูุฑ</span></button>

            <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 mt-6 px-2">ุงูุญูุงูุฉ ูุงููุฑุงูุจุฉ</div>
            <button onclick="switchSection('protection')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="protection"><span>๐ก๏ธ</span> <span>ุงูุญูุงูุฉ ูุงููููู</span></button>
            <button onclick="switchSection('warnings')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="warnings"><span>โ๏ธ</span> <span>ุงูุชุญุฐูุฑุงุช ูุงูููุงููู</span></button>
            <button onclick="switchSection('logs')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="logs"><span>๐</span> <span>ุณุฌูุงุช ุงูุณูุฑูุฑ ุงูุดุงููุฉ</span></button>

            <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 mt-6 px-2">ุงูุฃุนุถุงุก ูุงูุชูุงุนู</div>
            <button onclick="switchSection('welcome')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="welcome"><span>๐</span> <span>ุงูุชุฑุญูุจ ูุงููุบุงุฏุฑุฉ</span></button>
            <button onclick="switchSection('auto_roles')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="auto_roles"><span>๐ค</span> <span>ุงูุฑุฏ ูุงูุฑุชุจ ุงูุชููุงุฆูุฉ</span></button>
            <button onclick="switchSection('leveling')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="leveling"><span>๐</span> <span>ุงูุงูุชุตุงุฏ ูุงููููุงุช</span></button>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col h-screen relative bg-dark-900">
        <header class="h-24 flex-shrink-0 border-b border-dark-700 bg-dark-800/80 backdrop-blur-xl flex items-center px-10 z-10 shadow-sm">
            <div class="flex items-center space-x-5 space-x-reverse">
                <img src="<%= guildIconUrl %>" alt="Guild Icon" class="w-14 h-14 rounded-xl border border-dark-600 object-cover">
                <div><h2 class="text-2xl font-black text-white"><%= guildName %></h2></div>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-6 md:p-10 z-10 custom-scrollbar relative" id="main-scroll-area">
            
            <% if (typeof success !== 'undefined' && success) { %>
                <div class="mb-8 bg-emerald-500/10 border-r-4 border-emerald-500 text-emerald-400 px-6 py-5 rounded-l-xl flex items-center shadow-lg mx-auto max-w-5xl">
                    <span class="text-2xl ml-4">โ</span> <div><h4 class="font-bold text-lg">ุชู ุงูุญูุธ ุจูุฌุงุญ!</h4></div>
                </div>
            <% } %>

            <form action="/settings/<%= guildId %>/save" method="POST" id="mega-settings-form" onsubmit="return syncAllDataBeforeSave()">
                
                <div id="section-general" class="settings-section active max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูุงูุฃููุงู โ๏ธ</h2>
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-brand">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุงูุจุงุฏุฆุฉ (Prefix)</label><input type="text" name="prefix" value="<%= config.prefix || '!' %>" required class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-5 text-white input-glow font-mono text-center"></div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ูุบุฉ ุงููุธุงู</label>
                                <select name="language" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3.5 px-5 text-white input-glow font-bold">
                                    <option value="ar" <%= config.language === 'ar' ? 'selected' : '' %>>๐ธ๐ฆ ุงูุนุฑุจูุฉ</option>
                                    <option value="en" <%= config.language === 'en' ? 'selected' : '' %>>๐บ๐ธ ุงูุฅูุฌููุฒูุฉ</option>
                                </select>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-4">๐จ ุฃููุงู ุงูุฅููุจุฏุงุช ุงูุดุงููุฉ (Global Embeds)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-dark-900/50 p-4 rounded-xl border border-dark-700"><label class="block text-xs font-bold text-brand-light mb-2">โน๏ธ ุงูููู ุงูุฃุณุงุณู</label><input type="color" name="emb_primaryColor" value="<%= config.embedSetup?.primaryColor || '#5865F2' %>" class="w-full h-10 rounded bg-dark-900 border border-dark-600 p-1 cursor-pointer"></div>
                            <div class="bg-dark-900/50 p-4 rounded-xl border border-dark-700"><label class="block text-xs font-bold text-emerald-400 mb-2">โ ููู ุงููุฌุงุญ</label><input type="color" name="emb_successColor" value="<%= config.embedSetup?.successColor || '#3ba55d' %>" class="w-full h-10 rounded bg-dark-900 border border-dark-600 p-1 cursor-pointer"></div>
                            <div class="bg-dark-900/50 p-4 rounded-xl border border-dark-700"><label class="block text-xs font-bold text-red-400 mb-2">โ ููู ุงูุฎุทุฃ</label><input type="color" name="emb_errorColor" value="<%= config.embedSetup?.errorColor || '#ed4245' %>" class="w-full h-10 rounded bg-dark-900 border border-dark-600 p-1 cursor-pointer"></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="md:col-span-2"><label class="block text-sm font-bold text-slate-300 mb-2">ูุต ุงูููุชุฑ ุงูููุญุฏ (Footer Text)</label><input type="text" name="emb_footerText" value="<%= config.embedSetup?.footerText || 'Enterprise System ยฉ 2024' %>" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow"></div>
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุฑุงุจุท ุฃููููุฉ ุงูููุชุฑ</label><input type="text" name="emb_footerIconUrl" value="<%= config.embedSetup?.footerIconUrl || '' %>" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow text-left font-mono" dir="ltr" placeholder="https://..."></div>
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุฑุงุจุท ุงูุตูุฑุฉ ุงูุฌุงูุจูุฉ (Thumbnail)</label><input type="text" name="emb_thumbnailUrl" value="<%= config.embedSetup?.thumbnailUrl || '' %>" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow text-left font-mono" dir="ltr" placeholder="https://..."></div>
                        </div>
                    </div>
                </div>

                <div id="section-ai_system" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-amber-400 mb-6 border-b border-dark-700 pb-4">ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุชูุฏู (AI) โจ</h2>
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-amber-400 shadow-[0_0_30px_rgba(251,191,36,0.1)]">
                        
                        <div class="flex items-center justify-between bg-dark-900/80 p-5 rounded-2xl border border-amber-500/30 mb-8">
                            <div><h3 class="text-lg font-bold text-white">ุชูุนูู ูุธุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุจุงููุญุงุฏุซุงุช</h3></div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="ai_enabled" class="sr-only peer" <%= config.aiSystem?.enabled !== false ? 'checked' : '' %>>
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
                            </label>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุดุฎุตูุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู (Tone)</label>
                                <select name="ai_personality" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3.5 px-4 text-white input-glow font-bold cursor-pointer">
                                    <option value="street" <%= config.aiSystem?.personality === 'street' ? 'selected' : '' %>>๐ ุตุงูุน ูุดุจุญ (Street Smart)</option>
                                    <option value="cheerful" <%= config.aiSystem?.personality === 'cheerful' ? 'selected' : '' %>>๐ ูุฑููุด ูุจููุฒุฑ (Cheerful)</option>
                                    <option value="formal" <%= config.aiSystem?.personality === 'formal' ? 'selected' : '' %>>๐ ุฑุณูู ูุงุญุชุฑุงูู (Formal)</option>
                                    <option value="sarcastic" <%= config.aiSystem?.personality === 'sarcastic' ? 'selected' : '' %>>๐ ุณุงุฎุฑ ููุณุชูุฒ (Sarcastic)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ููุน ุงูุจูุช (Gender)</label>
                                <select name="ai_gender" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3.5 px-4 text-white input-glow font-bold cursor-pointer">
                                    <option value="boy" <%= config.aiSystem?.gender === 'boy' ? 'selected' : '' %>>๐ฆ ุฐูุฑ (ููุฏ)</option>
                                    <option value="girl" <%= config.aiSystem?.gender === 'girl' ? 'selected' : '' %>>๐ง ุฃูุซู (ุจูุช)</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุงุณู ุงูุจูุช (ูู ูุงู ููุฏ)</label><input type="text" name="ai_boyName" value="<%= config.aiSystem?.boyName || 'ุฒูุฒู' %>" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow font-bold"></div>
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุงุณู ุงูุจูุช (ูู ูุงูุช ุจูุช)</label><input type="text" name="ai_girlName" value="<%= config.aiSystem?.girlName || 'ุณูุณู' %>" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow font-bold"></div>
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-slate-300 mb-2">ุฑูู ุงูุฏุฑุฏุดุฉ ูุน ุงูุฐูุงุก ุงูุงุตุทูุงุนู</label>
                            <select name="ai_chatChannelId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3.5 px-4 text-white input-glow cursor-pointer">
                                <option value="">-- ุงุฎุชุฑ ุงูุฑูู ููุชุญุฏุซ ูููุง ุงูุฃุนุถุงุก --</option>
                                <% textChannels.forEach(ch => { %> <option value="<%= ch.id %>" <%= config.aiSystem?.chatChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option> <% }) %>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="section-live_embed" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุตุงูุน ุงูุฅููุจุฏ ุงูุญุฑ ๐จ</h2>
                    <div class="glass-card rounded-3xl p-8 border-t-4 border-t-fuchsia-500">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-6">
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุงุฎุชุฑ ุงูุฑูู</label><select id="live_embed_channel" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white"><option value="">-- ุงุฎุชุฑ --</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>">๐ฌ <%= ch.name %></option><% }) %></select></div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ููู ุงูุฅููุจุฏ</label>
                                <div class="flex items-center space-x-3 space-x-reverse"><input type="color" id="live_embed_color_picker" value="#5865F2" class="h-12 w-14 rounded-xl cursor-pointer bg-dark-900 border border-dark-700 p-1" onchange="document.getElementById('live_embed_color').value = this.value"><input type="text" id="live_embed_color" value="#5865F2" class="flex-1 bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow font-mono uppercase text-center" oninput="document.getElementById('live_embed_color_picker').value = this.value"></div>
                            </div>
                        </div>
                        <input type="text" id="live_embed_title" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white mb-4 font-bold" placeholder="ุงูุนููุงู...">
                        <textarea id="live_embed_desc" rows="5" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-4 px-5 text-white resize-y mb-4" placeholder="ุงููุตู ูุงูููุงููู (ูุฏุนู ุงูุฒุฎุงุฑู)..."></textarea>
                        <input type="text" id="live_embed_image" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white mb-6 font-mono text-left" dir="ltr" placeholder="ุฑุงุจุท ุตูุฑุฉ (ุงุฎุชูุงุฑู) https://...">
                        <div id="live_embed_status" class="hidden mb-4 p-3 rounded-lg font-bold text-center"></div>
                        <button type="button" onclick="sendLiveEmbed('<%= guildId %>')" class="w-full py-4 bg-fuchsia-600 hover:bg-fuchsia-500 text-white font-black text-lg rounded-xl transition-all shadow-lg shadow-fuchsia-500/30">๐ ุฅุฑุณุงู ุงูุฅููุจุฏ ุงูุขู!</button>
                    </div>
                </div>

                <div id="section-middleman" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ูุธุงู ุงููุณุงุทุฉ ุงููุนุฒูู โ๏ธ</h2>
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-amber-500">
                        <div class="flex items-center justify-between bg-dark-900/50 p-5 rounded-2xl border border-dark-700 mb-8">
                            <div><h3 class="text-lg font-bold text-white">ุชูุนูู ูุธุงู ุงููุณุงุทุฉ</h3><p class="text-sm text-slate-400">ุจุงูู ูููุตู ูุนุชูุฏ ุนูู ุฃูุฑ <code>!done</code> ููุชูููู.</p></div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" name="mm_enabled" class="sr-only peer" <%= config.middlemanSystem?.enabled ? 'checked' : '' %>>
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
                            </label>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ูุณู ุงูุชุฐุงูุฑ (Category)</label><select name="mm_categoryId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white"><option value="">-- ุงุฎุชุฑ --</option><% categories.forEach(cat => { %><option value="<%= cat.id %>" <%= config.middlemanSystem?.categoryId === cat.id ? 'selected' : '' %>>๐ <%= cat.name %></option><% }) %></select></div>
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุฑูู ุงูุจุงูู</label><select name="mm_panelChannelId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white"><option value="">-- ุงุฎุชุฑ --</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.middlemanSystem?.panelChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option><% }) %></select></div>
                        </div>

                        <div class="bg-dark-900/50 p-6 rounded-2xl border border-dark-700">
                            <h4 class="text-md font-bold text-brand-light mb-4">๐ ุฃุณุฆูุฉ ุงููุงูุฐุฉ (Modal) ูููุณุงุทุฉ</h4>
                            <input type="hidden" name="mm_modalFieldsData" id="mm_modalFieldsData" value="<%= JSON.stringify(config.middlemanSystem?.modalFields || []) %>">
                            <div id="mm-fields-ui-container" class="space-y-4 mb-4"></div>
                            <button type="button" onclick="addMmFieldUI()" class="w-full py-3 bg-emerald-600/20 hover:bg-emerald-600 text-emerald-400 hover:text-white font-bold rounded-xl border border-dashed border-emerald-500 transition-colors">โ ุฅุถุงูุฉ ุณุคุงู ูููุงูุฐุฉ</button>
                        </div>
                    </div>
                </div>

<div id="section-custom_panels" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุงูุจุงููุงุช ุงููุชุนุฏุฏุฉ ๐ซ</h2>
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-blue-500">
                        <input type="hidden" name="ticketPanelsData" id="ticketPanelsData" value="<%= JSON.stringify(config.ticketPanels || []) %>">
                        <div id="dynamic-panels-container" class="space-y-8"></div>
                        <button type="button" onclick="addNewPanelUI()" class="mt-8 flex items-center justify-center w-full px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white font-black text-lg rounded-xl transition-all shadow-lg shadow-blue-600/30">
                            <span class="text-2xl mr-2">โ</span> ุฅุถุงูุฉ ุจุงูู ุชุฐุงูุฑ ุฌุฏูุฏ
                        </button>
                    </div>
                </div>

                <div id="section-ticket_controls" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุงูุชุญูู ุงูุฐูู ูุงูุชุฑุงูุณูุฑูุจุช ๐๏ธ</h2>
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-indigo-500">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div class="bg-dark-900/50 p-5 rounded-2xl border border-dark-700 relative overflow-hidden">
                                <div class="absolute top-0 right-0 bg-brand text-xs font-bold px-3 py-1 rounded-bl-xl">Counter ๐ข</div>
                                <label class="block text-sm font-bold text-white mb-3 mt-2">ุฑูู ุงูุชูุช ุงููุงุฏู (ููููู ูู ุงูุจูุช ุงููุฏูู)</label>
                                <input type="number" name="tc_ticketCounter" value="<%= config.ticketControls?.ticketCounter || 1 %>" min="1" class="w-full bg-dark-800 border border-dark-600 rounded-xl py-3 px-4 text-brand-light font-mono text-2xl text-center font-black">
                            </div>
                            <div class="bg-dark-900/50 p-5 rounded-2xl border border-dark-700 relative overflow-hidden">
                                <div class="absolute top-0 right-0 bg-slate-600 text-xs font-bold px-3 py-1 rounded-bl-xl text-white">Limits ๐</div>
                                <label class="block text-sm font-bold text-white mb-3 mt-2">ุฃูุตู ุนุฏุฏ ุชูุชุงุช ููุชูุญุฉ ููุนุถู</label>
                                <input type="number" name="tc_maxOpenTicketsPerUser" value="<%= config.ticketControls?.maxOpenTicketsPerUser || 1 %>" min="1" max="10" class="w-full bg-dark-800 border border-dark-600 rounded-xl py-3 px-4 text-white font-mono text-2xl text-center font-black">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุฑูู ุญูุธ ุงูุชุฑุงูุณูุฑูุจุช (ุฑุณุงุฆู ุงูุชุฐูุฑุฉ)</label><select name="tc_transcriptChannelId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white"><option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.ticketControls?.transcriptChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option><% }) %></select></div>
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุฑูู ููุฌ ุงูุชุฐุงูุฑ (ูุชุญ ูุฅุบูุงู)</label><select name="tc_ticketLogChannelId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white"><option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.ticketControls?.ticketLogChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option><% }) %></select></div>
                        </div>

                        <h3 class="text-xl font-bold text-amber-400 mb-4">๐ต๏ธ ุฅุนุฏุงุฏุงุช ุฒุฑ ุงูุงุณุชูุงู (Claim)</h3>
                        <p class="text-xs text-slate-400 mb-4">ููุงุญุธุฉ: ูุง ููููู ุชูุนูู ุงูุฅุฎูุงุก ูุงููุฑุงุกุฉ ูุนุงู.</p>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-5 bg-dark-900/50 rounded-2xl border border-dark-700" id="hide_claim_container">
                                <div><h3 class="text-lg font-bold text-white">ุฅุฎูุงุก ุงูุชุฐูุฑุฉ ุนูุฏ ุงูุงุณุชูุงู</h3></div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="tc_hideTicketOnClaim" id="tc_hideTicketOnClaim" class="sr-only peer" <%= config.ticketControls?.hideTicketOnClaim ? 'checked' : '' %>>
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-500"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between p-5 bg-dark-900/50 rounded-2xl border border-dark-700" id="read_claim_container">
                                <div><h3 class="text-lg font-bold text-white">ููุน ุงูุฅุฏุงุฑููู ุงูุขุฎุฑูู ูู ุงููุชุงุจุฉ (Read-Only)</h3></div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="tc_readOnlyStaffOnClaim" id="tc_readOnlyStaffOnClaim" class="sr-only peer" <%= config.ticketControls?.readOnlyStaffOnClaim ? 'checked' : '' %>>
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-500"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="section-ratings" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุงูุชููููุงุช ุงููุฒุฏูุฌุฉ โญ</h2>
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-yellow-500">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div class="bg-dark-900/50 p-6 rounded-2xl border border-dark-700">
                                <h3 class="text-lg font-bold text-brand-light mb-4">๐ก๏ธ ุชููููุงุช ุงูุฏุนู ุงูููู</h3>
                                <label class="block text-xs font-bold text-slate-400 mb-2">ุฑูู ุงูููุฌ</label>
                                <select name="rating_staffLogChannelId" class="w-full bg-dark-800 rounded-lg py-2 px-3 text-white mb-4"><option value="">-- ุงุฎุชุฑ --</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.ratings?.staffLogChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option><% }) %></select>
                                <label class="block text-xs font-bold text-slate-400 mb-2">ุงูููู</label>
                                <input type="color" name="rating_staffEmbedColor" value="<%= config.ratings?.staffEmbedColor || '#3ba55d' %>" class="w-full h-10 rounded cursor-pointer p-1 bg-dark-800 border border-dark-600">
                            </div>
                            <div class="bg-dark-900/50 p-6 rounded-2xl border border-dark-700">
                                <h3 class="text-lg font-bold text-amber-500 mb-4">โ๏ธ ุชููููุงุช ุงููุณุทุงุก</h3>
                                <label class="block text-xs font-bold text-slate-400 mb-2">ุฑูู ุงูููุฌ</label>
                                <select name="rating_middlemanLogChannelId" class="w-full bg-dark-800 rounded-lg py-2 px-3 text-white mb-4"><option value="">-- ุงุฎุชุฑ --</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.ratings?.middlemanLogChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option><% }) %></select>
                                <label class="block text-xs font-bold text-slate-400 mb-2">ุงูููู</label>
                                <input type="color" name="rating_middlemanEmbedColor" value="<%= config.ratings?.middlemanEmbedColor || '#f2a658' %>" class="w-full h-10 rounded cursor-pointer p-1 bg-dark-800 border border-dark-600">
                            </div>
                        </div>
                        <label class="block text-sm font-bold text-slate-300 mb-2">ุฎูุงุฑุงุช ุงูุชูููู ุงูุฌุงูุฒุฉ (ุณุทุฑ ููู ุฎูุงุฑ)</label>
                        <textarea name="rating_customReviewOptions" rows="3" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white resize-y"><%= (config.ratings?.customReviewOptions || []).join('\n') %></textarea>
                    </div>
                </div>

                <div id="section-roles" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุงูุฑุชุจ ูุงูุตูุงุญูุงุช ๐</h2>
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-purple-500">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุฑุชุจุฉ ุงูุฏุนู ุงูููู</label><select name="role_adminRoleId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white"><option value="">-- ุงุฎุชุฑ --</option><% serverRoles.forEach(role => { %><option value="<%= role.id %>" <%= config.roles?.adminRoleId === role.id ? 'selected' : '' %>><%= role.name %></option><% }) %></select></div>
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุฑุชุจุฉ ุงููุณูุท ุงูุฃุณุงุณูุฉ</label><select name="role_middlemanRoleId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white"><option value="">-- ุงุฎุชุฑ --</option><% serverRoles.forEach(role => { %><option value="<%= role.id %>" <%= config.roles?.middlemanRoleId === role.id ? 'selected' : '' %>><%= role.name %></option><% }) %></select></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div><label class="block text-sm font-bold text-amber-400 mb-2">ุฑุชุจ ุงูุฅุฏุงุฑุฉ ุงูุนููุง (ููููุงููุฉ)</label><select name="role_highAdminRoles" multiple class="w-full h-24 bg-dark-900 border border-dark-700 rounded-xl py-2 px-3 text-white text-sm"><% serverRoles.forEach(role => { %><option value="<%= role.id %>" <%= (config.roles?.highAdminRoles || []).includes(role.id) ? 'selected' : '' %>><%= role.name %></option><% }) %></select></div>
                            <div><label class="block text-sm font-bold text-blue-400 mb-2">ุฑุชุจ ููุดู ุงูุชุฑูุฏ</label><select name="role_tradePingRoleIds" multiple class="w-full h-24 bg-dark-900 border border-dark-700 rounded-xl py-2 px-3 text-white text-sm"><% serverRoles.forEach(role => { %><option value="<%= role.id %>" <%= (config.roles?.tradePingRoleIds || []).includes(role.id) ? 'selected' : '' %>><%= role.name %></option><% }) %></select></div>
                            <div><label class="block text-sm font-bold text-emerald-400 mb-2">ุฑุชุจ ุงูููุงููุฉ ุนูู ุงูุชุฑูุฏ</label><select name="role_tradeApproveRoleIds" multiple class="w-full h-24 bg-dark-900 border border-dark-700 rounded-xl py-2 px-3 text-white text-sm"><% serverRoles.forEach(role => { %><option value="<%= role.id %>" <%= (config.roles?.tradeApproveRoleIds || []).includes(role.id) ? 'selected' : '' %>><%= role.name %></option><% }) %></select></div>
                        </div>
                    </div>
                </div>

                <div id="section-commands" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุชุฎุตูุต ุงูุฃูุงูุฑ โจ๏ธ</h2>
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-cyan-500">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-dark-900/50 p-4 rounded-xl border border-dark-700"><label class="block text-xs font-bold text-amber-500 mb-2">ุฃูุฑ ุงูุชุฑูุฏ (Trade)</label><input type="text" name="cmd_tradeCmd" value="<%= config.commands?.tradeCmd || 'trade' %>" class="w-full bg-dark-800 rounded p-2 text-white font-mono mb-2"><select name="cmd_tradeAllowedRoles" multiple class="w-full h-16 bg-dark-800 rounded p-1 text-xs text-white"><% serverRoles.forEach(role => { %><option value="<%= role.id %>" <%= (config.commands?.tradeAllowedRoles || []).includes(role.id) ? 'selected' : '' %>><%= role.name %></option><% }) %></select></div>
                            <div class="bg-dark-900/50 p-4 rounded-xl border border-dark-700"><label class="block text-xs font-bold text-amber-500 mb-2">ุฃูุฑ ุงูููุงููุฉ (Approve)</label><input type="text" name="cmd_approveCmd" value="<%= config.commands?.approveCmd || 'approve' %>" class="w-full bg-dark-800 rounded p-2 text-white font-mono mb-2"><select name="cmd_approveAllowedRoles" multiple class="w-full h-16 bg-dark-800 rounded p-1 text-xs text-white"><% serverRoles.forEach(role => { %><option value="<%= role.id %>" <%= (config.commands?.approveAllowedRoles || []).includes(role.id) ? 'selected' : '' %>><%= role.name %></option><% }) %></select></div>
                            <div class="bg-dark-900/50 p-4 rounded-xl border border-dark-700"><label class="block text-xs font-bold text-emerald-500 mb-2">ุฃูุฑ ุงูุฅุบูุงู (Done)</label><input type="text" name="cmd_doneCmd" value="<%= config.commands?.doneCmd || 'done' %>" class="w-full bg-dark-800 rounded p-2 text-white font-mono mb-2"><select name="cmd_doneAllowedRoles" multiple class="w-full h-16 bg-dark-800 rounded p-1 text-xs text-white"><% serverRoles.forEach(role => { %><option value="<%= role.id %>" <%= (config.commands?.doneAllowedRoles || []).includes(role.id) ? 'selected' : '' %>><%= role.name %></option><% }) %></select></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div><label class="block text-xs text-slate-400 mb-1">Come</label><input type="text" name="cmd_comeCmd" value="<%= config.commands?.comeCmd || 'come' %>" class="w-full bg-dark-900 rounded p-2 text-white font-mono"><select name="cmd_comeAllowedRoles" multiple class="w-full h-16 bg-dark-900 mt-1 rounded text-xs"><% serverRoles.forEach(r => { %><option value="<%= r.id %>" <%= (config.commands?.comeAllowedRoles || []).includes(r.id) ? 'selected' : '' %>><%= r.name %></option><% }) %></select></div>
                            <div><label class="block text-xs text-slate-400 mb-1">Clear</label><input type="text" name="cmd_clearCmd" value="<%= config.commands?.clearCmd || 'clear' %>" class="w-full bg-dark-900 rounded p-2 text-white font-mono"><select name="cmd_clearAllowedRoles" multiple class="w-full h-16 bg-dark-900 mt-1 rounded text-xs"><% serverRoles.forEach(r => { %><option value="<%= r.id %>" <%= (config.commands?.clearAllowedRoles || []).includes(r.id) ? 'selected' : '' %>><%= r.name %></option><% }) %></select></div>
                            <div><label class="block text-xs text-slate-400 mb-1">Timeout</label><input type="text" name="cmd_timeoutCmd" value="<%= config.commands?.timeoutCmd || 'timeout' %>" class="w-full bg-dark-900 rounded p-2 text-white font-mono"><select name="cmd_timeoutAllowedRoles" multiple class="w-full h-16 bg-dark-900 mt-1 rounded text-xs"><% serverRoles.forEach(r => { %><option value="<%= r.id %>" <%= (config.commands?.timeoutAllowedRoles || []).includes(r.id) ? 'selected' : '' %>><%= r.name %></option><% }) %></select></div>
                            <div><label class="block text-xs text-slate-400 mb-1">Ban</label><input type="text" name="cmd_banCmd" value="<%= config.commands?.banCmd || 'ban' %>" class="w-full bg-dark-900 rounded p-2 text-white font-mono"><select name="cmd_banAllowedRoles" multiple class="w-full h-16 bg-dark-900 mt-1 rounded text-xs"><% serverRoles.forEach(r => { %><option value="<%= r.id %>" <%= (config.commands?.banAllowedRoles || []).includes(r.id) ? 'selected' : '' %>><%= r.name %></option><% }) %></select></div>
                        </div>
                    </div>
                </div>

                <div id="section-logs" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุณุฌูุงุช ุงูุณูุฑูุฑ ุงูุดุงููุฉ ๐</h2>
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-teal-500 space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-dark-900/50 p-4 rounded-xl border border-dark-700">
                                <label class="block text-xs font-bold text-red-500 mb-2">๐ ููุฌ ุงูุฑูุฃูุช (ุฅุถุงูุฉ ูุญุฐู)</label>
                                <select name="log_reactionLogId" class="w-full bg-dark-800 rounded py-2 px-2 text-white text-sm"><option value="">-- ูุนุทู --</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.reactionLogId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option><% }) %></select>
                            </div>
                            <div class="bg-dark-900/50 p-4 rounded-xl border border-dark-700">
                                <label class="block text-xs font-bold text-amber-400 mb-2">๐ ููุฌ ุงูุฑููุงุช (ุฅูุดุงุก ูุญุฐู)</label>
                                <select name="log_channelCreateDeleteLogId" class="w-full bg-dark-800 rounded py-2 px-2 text-white text-sm"><option value="">-- ูุนุทู --</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.channelCreateDeleteLogId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option><% }) %></select>
                            </div>
                            <div class="bg-dark-900/50 p-4 rounded-xl border border-dark-700">
                                <label class="block text-xs font-bold text-brand-light mb-2">๐งต ููุฌ ุงูุซุฑูุฏุงุช (Threads)</label>
                                <select name="log_threadCreateDeleteLogId" class="w-full bg-dark-800 rounded py-2 px-2 text-white text-sm"><option value="">-- ูุนุทู --</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.threadCreateDeleteLogId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option><% }) %></select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div><label class="block text-[10px] text-slate-400 mb-1">ุญุฐู ุฑุณุงุฆู</label><select name="log_messageDeleteLogId" class="w-full bg-dark-900 rounded p-2 text-white text-xs"><option value="">- ูุนุทู -</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.messageDeleteLogId === ch.id ? 'selected' : '' %>><%= ch.name %></option><% }) %></select></div>
                            <div><label class="block text-[10px] text-slate-400 mb-1">ุชุนุฏูู ุฑุณุงุฆู</label><select name="log_messageEditLogId" class="w-full bg-dark-900 rounded p-2 text-white text-xs"><option value="">- ูุนุทู -</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.messageEditLogId === ch.id ? 'selected' : '' %>><%= ch.name %></option><% }) %></select></div>
                            <div><label class="block text-[10px] text-amber-500 mb-1">ุญุฐู ุตูุฑ ููุท</label><select name="log_imageDeleteLogId" class="w-full bg-dark-900 rounded p-2 text-white text-xs"><option value="">- ูุนุทู -</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.imageDeleteLogId === ch.id ? 'selected' : '' %>><%= ch.name %></option><% }) %></select></div>
                            <div><label class="block text-[10px] text-slate-400 mb-1">ุฅุนุทุงุก/ุณุญุจ ุฑุชุจ</label><select name="log_roleGiveTakeLogId" class="w-full bg-dark-900 rounded p-2 text-white text-xs"><option value="">- ูุนุทู -</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.roleGiveTakeLogId === ch.id ? 'selected' : '' %>><%= ch.name %></option><% }) %></select></div>
                            
                            <div><label class="block text-[10px] text-slate-400 mb-1">ุฏุฎูู/ุฎุฑูุฌ</label><select name="log_memberJoinLeaveLogId" class="w-full bg-dark-900 rounded p-2 text-white text-xs"><option value="">- ูุนุทู -</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.memberJoinLeaveLogId === ch.id ? 'selected' : '' %>><%= ch.name %></option><% }) %></select></div>
                            <div><label class="block text-[10px] text-slate-400 mb-1">ูููุณ (Voice)</label><select name="log_voiceStateLogId" class="w-full bg-dark-900 rounded p-2 text-white text-xs"><option value="">- ูุนุทู -</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.voiceStateLogId === ch.id ? 'selected' : '' %>><%= ch.name %></option><% }) %></select></div>
                            <div><label class="block text-[10px] text-red-500 mb-1">ุจุงูุฏ ูุทุฑุฏ</label><select name="log_banKickLogId" class="w-full bg-dark-900 rounded p-2 text-white text-xs"><option value="">- ูุนุทู -</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.banKickLogId === ch.id ? 'selected' : '' %>><%= ch.name %></option><% }) %></select></div>
                            <div><label class="block text-[10px] text-slate-400 mb-1">ุงูุงูุชุฑุงุญุงุช ูุงูุชุญุฐูุฑุงุช</label><select name="log_warningsLogId" class="w-full bg-dark-900 rounded p-2 text-white text-xs"><option value="">- ูุนุทู -</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.serverLogs?.warningsLogId === ch.id ? 'selected' : '' %>><%= ch.name %></option><% }) %></select></div>
                        </div>
                    </div>
                </div>

                <div id="section-warnings" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ูุธุงู ุงูุชุญุฐูุฑุงุช ูุงูููุงููู โ๏ธ</h2>
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-orange-500">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div><label class="block text-sm font-bold text-slate-300 mb-2">ุฃูุตู ุนุฏุฏ ููุชุญุฐูุฑุงุช</label><input type="number" name="warn_maxWarnings" value="<%= config.warnings?.maxWarnings || 3 %>" class="w-full bg-dark-900 rounded-xl py-3 px-4 text-white text-center font-bold"></div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุงูุนููุจุฉ ุงูุชููุงุฆูุฉ</label>
                                <select name="warn_autoAction" class="w-full bg-dark-900 rounded-xl py-3.5 px-4 text-white font-bold">
                                    <option value="timeout" <%= config.warnings?.autoAction === 'timeout' ? 'selected' : '' %>>โณ ุฅุณูุงุช (Timeout)</option>
                                    <option value="kick" <%= config.warnings?.autoAction === 'kick' ? 'selected' : '' %>>๐ข ุทุฑุฏ (Kick)</option>
                                    <option value="ban" <%= config.warnings?.autoAction === 'ban' ? 'selected' : '' %>>๐จ ุญุธุฑ (Ban)</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="bg-dark-900/50 p-5 rounded-2xl border border-dark-700">
                                <h4 class="text-brand-light font-bold mb-4 flex justify-between items-center"><span>ุงูุฃุณุจุงุจ ุงูุนุฑุจูุฉ ๐ธ๐ฆ</span> <button type="button" onclick="addWarnReason('ar')" class="px-3 py-1 bg-brand text-xs text-white rounded">โ ุฅุถุงูุฉ ุณุจุจ</button></h4>
                                <input type="hidden" name="warn_presetReasonsAr" id="hidden_warn_ar">
                                <div id="warn-ar-container" class="space-y-2 mb-4 max-h-40 overflow-y-auto custom-scrollbar pr-2"></div>
                                <label class="block text-xs font-bold text-slate-400 mb-2">ูุต ุงูููุงููู (ููุฑุณู ูู ุงูุฎุงุต ููุนุถู)</label>
                                <textarea name="warn_serverRulesAr" rows="3" class="w-full bg-dark-800 border border-dark-600 rounded-lg p-3 text-white text-sm"><%= config.warnings?.serverRulesAr || 'ุงูุฑุฌุงุก ุงูุงูุชุฒุงู ุจุงูููุงููู.' %></textarea>
                            </div>
                            <div class="bg-dark-900/50 p-5 rounded-2xl border border-dark-700" dir="ltr">
                                <h4 class="text-brand-light font-bold mb-4 flex justify-between items-center"><span>English Reasons ๐บ๐ธ</span> <button type="button" onclick="addWarnReason('en')" class="px-3 py-1 bg-brand text-xs text-white rounded">โ Add Reason</button></h4>
                                <input type="hidden" name="warn_presetReasonsEn" id="hidden_warn_en">
                                <div id="warn-en-container" class="space-y-2 mb-4 max-h-40 overflow-y-auto custom-scrollbar pl-2"></div>
                                <label class="block text-xs font-bold text-slate-400 mb-2 text-left">Server Rules (Sent in DM)</label>
                                <textarea name="warn_serverRulesEn" rows="3" class="w-full bg-dark-800 border border-dark-600 rounded-lg p-3 text-white text-sm" dir="ltr"><%= config.warnings?.serverRulesEn || 'Please follow the rules.' %></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="section-welcome" class="settings-section max-w-5xl mx-auto"><h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุงูุชุฑุญูุจ ูุงููุบุงุฏุฑุฉ ๐</h2><div class="glass-card rounded-3xl p-8 mb-8"><div class="flex justify-between items-center mb-6"><span>ุชูุนูู ุงูุชุฑุญูุจ</span><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" name="wel_enabled" class="sr-only peer" <%= config.welcomeSystem?.enabled ? 'checked' : '' %>><div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div></label></div><select name="wel_channelId" class="w-full bg-dark-900 rounded-xl py-3 px-4 text-white mb-4"><option value="">-- ุงูุฑูู --</option><% textChannels.forEach(ch => { %><option value="<%= ch.id %>" <%= config.welcomeSystem?.channelId === ch.id ? 'selected' : '' %>><%= ch.name %></option><% }) %></select><textarea name="wel_messageText" rows="2" class="w-full bg-dark-900 rounded-xl p-4 text-white mb-4"><%= config.welcomeSystem?.messageText || 'ูุฑุญุจุงู ุจู' %></textarea><input type="text" name="wel_backgroundUrl" value="<%= config.welcomeSystem?.backgroundUrl || '' %>" class="w-full bg-dark-900 rounded-xl p-3 text-white mb-4" placeholder="ุฑุงุจุท ุงูุฎูููุฉ"><input type="color" name="wel_avatarBorderHex" value="<%= config.welcomeSystem?.avatarBorderHex || '#ffffff' %>" class="w-full h-12 bg-dark-900 p-1 rounded-xl cursor-pointer"></div></div>

                <div id="section-protection" class="settings-section max-w-5xl mx-auto"><h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุงูุญูุงูุฉ ๐ก๏ธ</h2><div class="glass-card rounded-3xl p-8 mb-8"><div class="flex justify-between mb-4"><span>ููุน ุงูุฑูุงุจุท</span><input type="checkbox" name="prot_antiLinkEnabled" <%= config.protection?.antiLinkEnabled ? 'checked' : '' %>></div><div class="flex justify-between mb-4"><span>ููุน ุงูุณุจุงู</span><input type="checkbox" name="prot_antiSpamEnabled" <%= config.protection?.antiSpamEnabled ? 'checked' : '' %>></div><div class="flex justify-between"><span>Anti-Nuke</span><input type="checkbox" name="prot_antiNukeEnabled" <%= config.protection?.antiNukeEnabled ? 'checked' : '' %>></div></div></div>

                <div id="section-auto_roles" class="settings-section max-w-5xl mx-auto"><h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุงูุฑุฏ ูุงูุฑุชุจ ๐ค</h2><div class="glass-card rounded-3xl p-8 mb-8"><select name="autoRoles" multiple class="w-full h-24 bg-dark-900 rounded-xl p-3 text-white mb-6"><% serverRoles.forEach(r => { %><option value="<%= r.id %>" <%= (config.autoRoles || []).includes(r.id) ? 'selected' : '' %>><%= r.name %></option><% }) %></select><div class="flex justify-between items-center mb-4"><span class="font-bold">ุงูุฑุฏูุฏ ุงูุชููุงุฆูุฉ</span><button type="button" onclick="addAutoResponderUI()" class="px-3 py-1 bg-emerald-600 text-white rounded">โ</button></div><input type="hidden" name="autoRespondersData" id="autoRespondersData" value="<%= JSON.stringify(config.autoResponders || []) %>"><div id="auto-responders-container" class="space-y-3"></div></div></div>

                <div id="section-leveling" class="settings-section max-w-5xl mx-auto"><h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุงููููุงุช ูุงูุงูุชุตุงุฏ ๐</h2><div class="glass-card rounded-3xl p-8 mb-8"><div class="flex justify-between items-center mb-4"><span class="font-bold">ุฌูุงุฆุฒ ุงูุฑุชุจ ูููุณุชููุงุช</span><button type="button" onclick="addLevelRewardUI()" class="px-3 py-1 bg-blue-600 text-white rounded">โ</button></div><input type="hidden" name="lvl_roleRewardsData" id="lvl_roleRewardsData" value="<%= JSON.stringify(config.leveling?.roleRewards || []) %>"><div id="level-rewards-container" class="space-y-3"></div></div></div>

            </form>
        </div>
    </main>

    <script>
        function switchSection(target) {
            document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + target).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('bg-brand','text-white'); b.classList.add('text-slate-400'); });
            document.querySelector(`[data-target="${target}"]`).classList.add('bg-brand','text-white');
            document.querySelector(`[data-target="${target}"]`).classList.remove('text-slate-400');
        }

        // ๐๏ธ ุฐูุงุก ุฃุฒุฑุงุฑ ุงูุชูุช (ููุน ุงูุฅุฎูุงุก ูุงููุฑุงุกุฉ ูุนุงู)
        const hideBtn = document.getElementById('tc_hideTicketOnClaim');
        const readBtn = document.getElementById('tc_readOnlyStaffOnClaim');
        function syncTicketToggles() {
            if (hideBtn.checked) { readBtn.checked = false; document.getElementById('read_claim_container').style.opacity = '0.5'; }
            else { document.getElementById('read_claim_container').style.opacity = '1'; }
            if (readBtn.checked) { hideBtn.checked = false; document.getElementById('hide_claim_container').style.opacity = '0.5'; }
            else if (!readBtn.checked && !hideBtn.checked) { document.getElementById('hide_claim_container').style.opacity = '1'; }
        }
        hideBtn.addEventListener('change', syncTicketToggles);
        readBtn.addEventListener('change', syncTicketToggles);
        syncTicketToggles();

        // ๐ ุตุงูุน ุงูุฅููุจุฏ
        async function sendLiveEmbed(guildId) {
            const ch = document.getElementById('live_embed_channel').value;
            const t = document.getElementById('live_embed_title').value;
            const d = document.getElementById('live_embed_desc').value;
            const c = document.getElementById('live_embed_color').value;
            const i = document.getElementById('live_embed_image').value;
            const st = document.getElementById('live_embed_status');
            if(!ch || (!t&&!d)){ st.className='mb-4 p-3 rounded bg-red-500/20 text-red-400'; st.innerText='โ ุงุฎุชุฑ ุฑูู ูุงูุชุจ ูุญุชูู.'; st.classList.remove('hidden'); return; }
            st.className='mb-4 p-3 rounded bg-blue-500/20 text-blue-400'; st.innerText='โณ ุฌุงุฑู ุงูุฅุฑุณุงู...'; st.classList.remove('hidden');
            try {
                const res = await fetch(`/api/send-embed/${guildId}`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({channelId:ch, title:t, description:d, color:c, imageUrl:i}) });
                const data = await res.json();
                if(data.success) { st.className='mb-4 p-3 rounded bg-emerald-500/20 text-emerald-400'; st.innerText='โ ุชู ุงูุฅุฑุณุงู!'; document.getElementById('live_embed_desc').value=''; }
                else { st.className='mb-4 p-3 rounded bg-red-500/20 text-red-400'; st.innerText=data.error; }
            } catch(e){ st.className='mb-4 p-3 rounded bg-red-500/20 text-red-400'; st.innerText='โ ุฎุทุฃ.'; }
        }

        // ==========================================================
        // ๐งฑ ุงููุญุฑูุงุช ุงูุฏููุงููููุฉ (ุงูุฒุฑุงูุฑ ูุงูููุงูุฐ ูุงูุฃุณุจุงุจ)
        // ==========================================================
        let panelsArray = JSON.parse(document.getElementById('ticketPanelsData').value || '[]');
        let mmFields = JSON.parse(document.getElementById('mm_modalFieldsData').value || '[]');
        let autoRes = JSON.parse(document.getElementById('autoRespondersData').value || '[]');
        let roleRewards = JSON.parse(document.getElementById('lvl_roleRewardsData').value || '[]');
        
        let warnAr = <%- JSON.stringify(config.warnings?.presetReasonsAr || []) %>;
        if(warnAr.length===0) warnAr = ['ุณุจ ูุดุชู', 'ูุดุฑ ุฑูุงุจุท', 'ุฅุฒุนุงุฌ ุงูุฅุฏุงุฑุฉ'];
        let warnEn = <%- JSON.stringify(config.warnings?.presetReasonsEn || []) %>;
        if(warnEn.length===0) warnEn = ['Swearing', 'Posting Links', 'Spam'];

        function renderWarns(lang) {
            const arr = lang === 'ar' ? warnAr : warnEn;
            const container = document.getElementById(`warn-${lang}-container`);
            container.innerHTML = '';
            arr.forEach((w, i) => {
                container.innerHTML += `
                    <div class="flex items-center space-x-2 space-x-reverse bg-dark-800 p-2 rounded-lg border border-dark-600">
                        <input type="text" class="flex-1 bg-transparent text-white text-sm outline-none ${lang==='en'?'text-left':''}" dir="${lang==='en'?'ltr':'rtl'}" value="${w}" onchange="${lang==='ar'?'warnAr':'warnEn'}[${i}]=this.value">
                        <button type="button" onclick="${lang==='ar'?'warnAr':'warnEn'}.splice(${i},1); renderWarns('${lang}');" class="text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white px-2 py-1 rounded text-xs transition">X</button>
                    </div>`;
            });
        }
        function addWarnReason(lang) { if(lang==='ar') warnAr.push('ุณุจุจ ุฌุฏูุฏ'); else warnEn.push('New Reason'); renderWarns(lang); }

        function renderMmFields() {
            const c = document.getElementById('mm-fields-ui-container'); c.innerHTML = '';
            mmFields.forEach((f, i) => {
                c.innerHTML += `<div class="bg-dark-800 p-4 rounded-lg border border-dark-600 mb-2 relative">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" class="bg-dark-900 rounded p-2 text-white text-sm" placeholder="ุงูุณุคุงู" value="${f.label||''}" onchange="mmFields[${i}].label=this.value">
                        <input type="text" class="bg-dark-900 rounded p-2 text-white text-sm" placeholder="ูุซุงู ููุนููู" value="${f.placeholder||''}" onchange="mmFields[${i}].placeholder=this.value">
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <div class="flex space-x-4 space-x-reverse text-xs text-slate-300">
                            <label><input type="radio" name="mm_s_${i}" value="Short" ${f.style!=='Paragraph'?'checked':''} onchange="mmFields[${i}].style=this.value"> ุฅุฌุงุจุฉ ูุตูุฑุฉ</label>
                            <label><input type="radio" name="mm_s_${i}" value="Paragraph" ${f.style==='Paragraph'?'checked':''} onchange="mmFields[${i}].style=this.value"> ุฅุฌุงุจุฉ ุทูููุฉ</label>
                        </div>
                        <button type="button" onclick="mmFields.splice(${i},1); renderMmFields();" class="text-xs bg-red-600 text-white px-2 py-1 rounded">ุญุฐู</button>
                    </div>
                </div>`;
            });
        }
        function addMmFieldUI() { mmFields.push({label:'', placeholder:'', style:'Short'}); renderMmFields(); }

        function renderAllPanels() {
            const c = document.getElementById('dynamic-panels-container'); c.innerHTML = '';
            panelsArray.forEach((p, pIdx) => {
                let btns = '';
                (p.buttons||[]).forEach((b, bIdx) => {
                    let mHTML = '';
                    if(b.requireModal) {
                        mHTML += `<div class="mt-3 p-3 bg-dark-900/50 rounded-lg border border-dark-700">
                            <div class="flex justify-between items-center mb-2"><span class="text-xs text-brand-light font-bold">ุฃุณุฆูุฉ ุงููุงูุฐุฉ</span><button type="button" onclick="panelsArray[${pIdx}].buttons[${bIdx}].modalFields.push({label:'',placeholder:''}); renderAllPanels();" class="text-[10px] bg-brand text-white px-2 rounded">โ ุฅุถุงูุฉ ุณุคุงู</button></div>`;
                        (b.modalFields||[]).forEach((mf, mIdx) => {
                            mHTML += `<div class="flex space-x-2 space-x-reverse mt-1"><input type="text" class="w-1/2 bg-dark-900 text-xs text-white rounded p-1" placeholder="ุงูุณุคุงู" value="${mf.label}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].modalFields[${mIdx}].label=this.value"><input type="text" class="flex-1 bg-dark-900 text-xs text-white rounded p-1" placeholder="ูุซุงู" value="${mf.placeholder}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].modalFields[${mIdx}].placeholder=this.value"><button type="button" onclick="panelsArray[${pIdx}].buttons[${bIdx}].modalFields.splice(${mIdx},1); renderAllPanels();" class="bg-red-500 text-white px-2 rounded">X</button></div>`;
                        });
                        mHTML += `</div>`;
                    }

                    btns += `<div class="bg-dark-800 p-4 rounded-xl border border-dark-600 mt-2 relative">
                        <button type="button" onclick="panelsArray[${pIdx}].buttons.splice(${bIdx},1); renderAllPanels();" class="absolute top-2 left-2 text-red-500 text-xs bg-red-500/10 px-2 rounded">ุญุฐู</button>
                        <div class="grid grid-cols-2 gap-4 mt-4">
                            <div><label class="text-[10px] text-slate-400">ุงุณู ุงูุฒุฑ</label><input type="text" class="w-full bg-dark-900 text-sm text-white rounded p-2" value="${b.label}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].label=this.value"></div>
                            <div><label class="text-[10px] text-slate-400">ููู ุงูุฒุฑ (Discord)</label><select class="w-full bg-dark-900 text-sm text-white rounded p-2" onchange="panelsArray[${pIdx}].buttons[${bIdx}].buttonStyle=this.value"><option value="Primary" ${b.buttonStyle==='Primary'?'selected':''}>ุฃุฒุฑู</option><option value="Success" ${b.buttonStyle==='Success'?'selected':''}>ุฃุฎุถุฑ</option><option value="Danger" ${b.buttonStyle==='Danger'?'selected':''}>ุฃุญูุฑ</option><option value="Secondary" ${b.buttonStyle==='Secondary'?'selected':''}>ุฑูุงุฏู</option></select></div>
                        </div>
                        <div class="mt-3 flex space-x-4 space-x-reverse text-xs font-bold text-slate-300">
                            <label><input type="checkbox" ${b.isMiddleman?'checked':''} onchange="panelsArray[${pIdx}].buttons[${bIdx}].isMiddleman=this.checked" class="mr-1 ml-1"> ๐ค ุฒุฑ ูุณุงุทุฉ</label>
                            <label class="text-emerald-400"><input type="checkbox" ${b.requireModal?'checked':''} onchange="panelsArray[${pIdx}].buttons[${bIdx}].requireModal=this.checked; if(this.checked && !panelsArray[${pIdx}].buttons[${bIdx}].modalFields) panelsArray[${pIdx}].buttons[${bIdx}].modalFields=[]; renderAllPanels();" class="mr-1 ml-1"> ๐ ุชูุนูู ูุงูุฐุฉ (Modal)</label>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-3 pt-3 border-t border-dark-700">
                            <div><label class="text-[10px] text-amber-400">ููู ุฅููุจุฏ ุงูุฅุฌุงุจุงุช (ููููุงูุฐ)</label><input type="color" class="w-full h-8 bg-dark-900 rounded p-1 cursor-pointer" value="${b.insideEmbedColor || '#2b2d31'}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].insideEmbedColor=this.value"></div>
                            <div><label class="text-[10px] text-slate-400">ูุตู ุงูุฅููุจุฏ ุงูุฏุงุฎูู</label><input type="text" class="w-full bg-dark-900 text-xs text-white rounded p-2" value="${b.insideEmbedDesc||''}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].insideEmbedDesc=this.value"></div>
                        </div>
                        ${mHTML}
                    </div>`;
                });

                c.innerHTML += `<div class="bg-dark-900/80 border border-dark-600 rounded-2xl p-6 relative">
                    <button type="button" onclick="panelsArray.splice(${pIdx},1); renderAllPanels();" class="absolute top-4 left-4 bg-red-600 text-white px-3 py-1 rounded text-xs">ุญุฐู ุงูุจุงูู</button>
                    <input type="text" class="bg-transparent text-xl font-bold text-white border-b border-dark-600 pb-1 mb-4 w-1/2" value="${p.panelTitle}" onchange="panelsArray[${pIdx}].panelTitle=this.value">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div><label class="text-xs text-slate-400 block">ุฑูู ุงูุจุงูู</label><select class="w-full bg-dark-800 text-white text-sm rounded p-2" onchange="panelsArray[${pIdx}].channelId=this.value"><option value="">- ุงูุฑูู -</option><%- textChannels.map(ch=>`<option value="${ch.id}">${ch.name}</option>`).join('') %></select></div>
                        <div><label class="text-xs text-slate-400 block">ุงููุณู</label><select class="w-full bg-dark-800 text-white text-sm rounded p-2" onchange="panelsArray[${pIdx}].categoryId=this.value"><option value="">- ุงููุณู -</option><%- categories.map(cat=>`<option value="${cat.id}">${cat.name}</option>`).join('') %></select></div>
                    </div>
                    <div class="p-4 bg-dark-800 rounded-xl border border-dark-700"><h5 class="text-sm font-bold text-brand-light mb-2">ุฃุฒุฑุงุฑ ุงูุจุงูู</h5>${btns}
                    <button type="button" onclick="panelsArray[${pIdx}].buttons.push({id:'b_'+Math.random().toString(36).substr(2,6),label:'ุฒุฑ ุฌุฏูุฏ',buttonStyle:'Primary',requireModal:false,insideEmbedColor:'#2b2d31'}); renderAllPanels();" class="w-full mt-2 py-2 border border-dashed border-slate-500 rounded text-slate-300 text-xs hover:bg-dark-700">โ ุฅุถุงูุฉ ุฒุฑ</button></div>
                </div>`;
                // Set correct selects after render
                const selects = c.querySelectorAll('select');
                if(selects.length >= 2) {
                    selects[selects.length-2].value = p.channelId || "";
                    selects[selects.length-1].value = p.categoryId || "";
                }
            });
        }
        function addNewPanelUI() { panelsArray.push({panelId:'p_'+Math.random().toString(36).substr(2,6), panelTitle:'ุจุงูู ุฌุฏูุฏ', buttons:[]}); renderAllPanels(); }

        // ==========================================================
        // ๐ ุฏุงูุฉ ุงูุญูุธ ุงูุณุญุฑูุฉ (ุชุฌูุน ูู ุงูุฏุงุชุง ูุจู ุงูุฅุฑุณุงู)
        // ==========================================================
        function syncAllDataBeforeSave() {
            document.getElementById('hidden_warn_ar').value = warnAr.join('\n');
            document.getElementById('hidden_warn_en').value = warnEn.join('\n');
            document.getElementById('mm_modalFieldsData').value = JSON.stringify(mmFields);
            document.getElementById('ticketPanelsData').value = JSON.stringify(panelsArray);
            
            // ุชุญุฐูุฑ ุจุณูุท ูููุณุชุฎุฏู ูู ูุณู ูููู ุญุงุฌุฉ
            const sb = document.querySelector('button[type="submit"]');
            sb.innerHTML = '<span class="mr-3 ml-2 text-2xl animate-spin">โณ</span> ุฌุงุฑู ุงูุญูุธ...';
            sb.classList.replace('bg-emerald-500', 'bg-emerald-600');
            return true; 
        }

        window.onload = () => { renderWarns('ar'); renderWarns('en'); renderMmFields(); renderAllPanels(); };
    </script>
</body>
</html>


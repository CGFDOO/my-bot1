<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅุนุฏุงุฏุงุช MNC | ููุญุฉ ุงูุชุญูู ุงูุดุงููุฉ</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #121212; color: #ffffff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .mobile-header { display: none; background-color: #1e1e24; padding: 15px 20px; align-items: center; justify-content: space-between; border-bottom: 2px solid #5865F2; }
        .menu-btn { background: #5865F2; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        .sidebar { width: 260px; background-color: #1e1e24; padding: 20px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; z-index: 1000; border-left: 1px solid #333; }
        .sidebar h2 { color: #5865F2; font-size: 22px; text-align: center; margin-bottom: 15px; }
        .tab-btn { background: #2b2b36; color: white; border: none; padding: 12px; text-align: right; font-size: 15px; border-radius: 8px; cursor: pointer; transition: 0.3s; font-family: 'Tajawal', sans-serif; }
        .tab-btn:hover { background: #3b3b4f; }
        .tab-btn.active { background: #5865F2; font-weight: bold; }
        .content { flex: 1; padding: 30px; overflow-y: auto; background-color: #18181b; }
        .tab-content { display: none; background: #23232a; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #b9bbbe; font-weight: bold; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; background: #2f3136; border: 1px solid #202225; color: white; border-radius: 5px; box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        .save-btn { background: #3ba55d; color: white; padding: 15px; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; width: 100%; font-weight: bold; font-family: 'Tajawal', sans-serif; margin-top: 20px; }
        .save-btn:hover { background: #2d7d46; }
        .builder-box { border: 1px solid #5865F2; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #1e1e24; }
        .add-btn { background: #5865F2; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-family: 'Tajawal', sans-serif; }
        .help-box { background: #2b2b36; border-right: 4px solid #f2a658; padding: 10px; margin-bottom: 15px; font-size: 14px; color: #ccc; }
        hr { border-color: #333; margin: 20px 0; }
        @media (max-width: 768px) { body { flex-direction: column; overflow: auto; } .mobile-header { display: flex; } .sidebar { position: fixed; right: -300px; top: 0; height: 100%; width: 250px; } .sidebar.open { right: 0; } .content { padding: 15px; } }
    </style>
</head>
<body>

    <div class="mobile-header">
        <h2 style="margin: 0; color: white;">ุฅุนุฏุงุฏุงุช MNC</h2>
        <button class="menu-btn" onclick="toggleSidebar()">โฐ ุงููุงุฆูุฉ</button>
    </div>

    <div class="sidebar" id="sidebar">
        <h2>๐๏ธ ููุญุฉ ุงูุชุญูู</h2>
        <button class="tab-btn active" onclick="openTab(event, 'general')">โ๏ธ ุงูุฅุนุฏุงุฏุงุช ูุงูุชุฑุญูุจ</button>
        <button class="tab-btn" onclick="openTab(event, 'warns_games')">โ๏ธ ุงูุชุญุฐูุฑุงุช ูุงูุฃูุนุงุจ</button>
        <button class="tab-btn" onclick="openTab(event, 'tickets_panel')">๐๏ธ ุจุงูุฑ ุงูุชูุชุงุช ุงูุฎุงุฑุฌู</button>
        <button class="tab-btn" onclick="openTab(event, 'tickets_builder')" style="border: 1px solid #f2a658;">๐๏ธ ุตุงูุน ุงูุชูุช ูุงูููุงูุฐ</button>
        <button class="tab-btn" onclick="openTab(event, 'roles')">๐จโโ๏ธ ุงูุฑุชุจ ูุงูุชุญูู</button>
        <button class="tab-btn" onclick="openTab(event, 'commands')">โจ๏ธ ุงูุฃูุงูุฑ ุงูุดุงููุฉ</button>
        <button class="tab-btn" onclick="openTab(event, 'logs')">๐ ุฌููุน ุงูููุฌุงุช</button>
        <button class="tab-btn" onclick="openTab(event, 'embedBuilder')" style="border: 1px solid #5865F2;">๐จ ุตุงูุน ุงูุฅููุจุฏ ุงูุญุฑ</button>
        <a href="/dashboard" style="color: #ff4d4d; text-align: center; text-decoration: none; margin-top: 10px;">โฌ๏ธ ุงูุนูุฏุฉ</a>
    </div>

    <div class="content">
        <% if (success === 'saved') { %> <div style="background: #3ba55d; padding: 10px; border-radius: 5px; text-align: center; margin-bottom: 20px; font-weight: bold;">โ ุชู ุญูุธ ุงูุชุนุฏููุงุช ุจูุฌุงุญ!</div> <% } %>
        
        <form action="/settings/<%= guild.id %>" method="POST" id="mainForm">
            <input type="hidden" name="customButtonsData" id="customButtonsData">
            <input type="hidden" name="warnReasonsData" id="warnReasonsData">

            <div id="general" class="tab-content active">
                <h3>โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูุงูุญูุงูุฉ</h3>
                <div class="form-group"><label>ุงูุจุฑูููุณ (Prefix):</label><input type="text" name="prefix" value="<%= config.prefix %>"></div>
                <div class="form-group"><label>๐ก๏ธ ุงูุญูุงูุฉ:</label>
                    <input type="checkbox" name="antiLinks" <%= config.antiLinks ? 'checked' : '' %>> ููุน ุงูุฑูุงุจุท | 
                    <input type="checkbox" name="antiSpam" <%= config.antiSpam ? 'checked' : '' %>> ููุน ุงูุณุจุงู
                </div>
                <div class="form-group"><label>ุฑุชุจุฉ ุงูุฏุฎูู ุงูุชููุงุฆูุฉ:</label><select name="autoRoleId"><option value="">-- ูุนุทู --</option><% roles.forEach(r => { %><option value="<%= r.id %>" <%= config.autoRoleId === r.id ? 'selected' : '' %>><%= r.name %></option><% }) %></select></div>
                
                <hr>
                <h3>๐ผ๏ธ ูุธุงู ุงูุชุฑุญูุจ ุงููุชุทูุฑ (Welcome)</h3>
                <div class="help-box">
                    ๐ก <b>ุงููุชุบูุฑุงุช ุงููุชุงุญุฉ ููุฑุณุงุฆู:</b><br>
                    <code>[user]</code> = ููุดู ููุนุถู | <code>[server]</code> = ุงุณู ุงูุณูุฑูุฑ | <code>[memberCount]</code> = ุฑูู ุงูุนุถู<br>
                    <i>ููุงุญุธุฉ: ุงูุจูุช ุณูููู ุชููุงุฆูุงู ุจุฏูุฌ ุตูุฑุฉ ุงูุนุถู ูุน ุตูุฑุฉ ุงูุณูุฑูุฑ ูู ุงูุชุฑุญูุจ!</i>
                </div>
                <div class="form-group"><label>ุฑูู ุงูุชุฑุญูุจ:</label><select name="welcomeChannelId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c => { %><option value="<%= c.id %>" <%= config.welcomeChannelId === c.id ? 'selected' : '' %>><%= c.name %></option><% }) %></select></div>
                <div class="form-group"><label>ุงูุฑุณุงูุฉ ุงููุตูุฉ (ุฎุงุฑุฌ ุงูุตูุฑุฉ):</label><textarea name="welcomeMessage"><%= config.welcomeMessage %></textarea></div>
                <div class="form-group"><label>ุฑุงุจุท ุตูุฑุฉ ุงูุฎูููุฉ (Background URL):</label><input type="text" name="welcomeBgImage" value="<%= config.welcomeBgImage %>" placeholder="https://..."></div>
                <div class="form-group"><label>ููู ุฅุทุงุฑ ุตูุฑุฉ ุงูุนุถู (Hex Color):</label><input type="color" name="welcomeAvatarBorderColor" value="<%= config.welcomeAvatarBorderColor || '#ffffff' %>" style="height: 40px; padding:0;"></div>
            </div>

            <div id="warns_games" class="tab-content">
                <h3>โ๏ธ ููุญุฉ ุงูุชุญูู ุจุงูุชุญุฐูุฑุงุช (Warn Panel)</h3>
                <div class="form-group"><label>ุฑูู ุฅุฑุณุงู ููุญุฉ ุงูุชุญุฐูุฑุงุช (ุงูุฒุฑุงูุฑ):</label><select name="warnPanelChannelId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c => { %><option value="<%= c.id %>" <%= config.warnPanelChannelId === c.id ? 'selected' : '' %>><%= c.name %></option><% }) %></select></div>
                <div class="form-group"><label>ุฑูู ุณุฌู ุงูุชุญุฐูุฑุงุช (ุงูููุฌ):</label><select name="warnLogChannelId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c => { %><option value="<%= c.id %>" <%= config.warnLogChannelId === c.id ? 'selected' : '' %>><%= c.name %></option><% }) %></select></div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group"><label>ุนููุงู ุฅููุจุฏ ุงูุชุญุฐูุฑ:</label><input type="text" name="warnPanelTitle" value="<%= config.warnPanelTitle %>"></div>
                    <div class="form-group"><label>ููู ุงูุฅููุจุฏ:</label><input type="color" name="warnPanelColor" value="<%= config.warnPanelColor %>" style="height:40px; padding:0;"></div>
                </div>
                <div class="form-group"><label>ูุตู ุงูุฅููุจุฏ:</label><textarea name="warnPanelDesc"><%= config.warnPanelDesc %></textarea></div>
                
                <div class="form-group"><label>ุงูุนูุงุจ ุงูุชููุงุฆู ุจุนุฏ ุชุฌุงูุฒ ุงูุญุฏ:</label>
                    <select name="warnAction">
                        <option value="timeout" <%= config.warnAction === 'timeout' ? 'selected' : '' %>>Timeout (ูุชู)</option>
                        <option value="kick" <%= config.warnAction === 'kick' ? 'selected' : '' %>>Kick (ุทุฑุฏ)</option>
                        <option value="ban" <%= config.warnAction === 'ban' ? 'selected' : '' %>>Ban (ุญุธุฑ)</option>
                    </select>
                </div>
                <div class="form-group"><label>ุงูุญุฏ ุงูุฃูุตู ููุชุญุฐูุฑุงุช (ุฑูู):</label><input type="number" name="warnMax" value="<%= config.warnMax %>"></div>

                <div class="builder-box">
                    <h4 style="margin-top:0; color:#ed4245;">๐ ุงูุฃุณุจุงุจ ุงูุฌุงูุฒุฉ ููุชุญุฐูุฑ (ุชุธูุฑ ูู ุงููุงูุฐุฉ)</h4>
                    <div id="warnReasonsContainer"></div>
                    <button type="button" class="add-btn" onclick="addWarnReason()" style="background:#ed4245; margin-top:10px;">+ ุฅุถุงูุฉ ุณุจุจ</button>
                </div>

                <hr>
                <h3>๐ฎ ูุธุงู ุงูุฃูุนุงุจ (Games)</h3>
                <div class="form-group"><label>ุชูุนูู ุงูุฃูุนุงุจ (ุฑูููุชุ ุฎููุ ุฑูุจูููุง.. ุงูุฎ):</label>
                    <input type="checkbox" name="gamesEnabled" style="width: 20px; height: 20px;" <%= config.gamesEnabled ? 'checked' : '' %>>
                </div>
                <div class="form-group"><label>ุฑูู ุงูุฃูุนุงุจ (ุงุฎุชูุงุฑูุ ูุชุญุฏูุฏ ุฑูู ูุนููุฉ):</label><select name="gamesChannelId"><option value="">-- ูู ุงูุฑููุงุช --</option><% channels.filter(c=>c.type===0).forEach(c => { %><option value="<%= c.id %>" <%= config.gamesChannelId === c.id ? 'selected' : '' %>><%= c.name %></option><% }) %></select></div>
            </div>

            <div id="tickets_panel" class="tab-content">
                <h3>๐๏ธ ุจุงูุฑ ุงูุชูุชุงุช ุงูุฎุงุฑุฌู (ุงููู ุจูุธูุฑ ูููุงุณ)</h3>
                <div class="form-group"><label>ุงูุฑูู ุงูุชู ุณููุฑุณู ุจูุง ุงูุจุงูุฑ:</label><select name="panelChannelId"><option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option><% channels.filter(c=>c.type===0).forEach(c => { %><option value="<%= c.id %>" <%= config.panelChannelId === c.id ? 'selected' : '' %>><%= c.name %></option><% }) %></select></div>
                <div class="form-group"><label>ุงููุงุชูุฌูุฑู ุงูุงุญุชูุงุทู (Default Category):</label><select name="defaultCategoryId"><option value="">-- ุงุฎุชุฑ ูุณู --</option><% channels.filter(c=>c.type===4).forEach(c => { %><option value="<%= c.id %>" <%= config.defaultCategoryId === c.id ? 'selected' : '' %>><%= c.name %></option><% }) %></select></div>
                <div class="form-group"><label>ุนููุงู ุงูุฅููุจุฏ ุงูุฎุงุฑุฌู:</label><input type="text" name="ticketEmbedTitle" value="<%= config.ticketEmbedTitle %>"></div>
                <div class="form-group"><label>ุงูููุงููู / ุงููุตู ุงูุฎุงุฑุฌู:</label><textarea name="ticketEmbedDesc"><%= config.ticketEmbedDesc %></textarea></div>
                <div class="form-group"><label>ููู ุงูุฅููุจุฏ:</label><input type="color" name="ticketEmbedColor" value="<%= config.ticketEmbedColor %>" style="height:40px; padding:0;"></div>
                <div class="form-group"><label>ุงูุญุฏ ุงูุฃูุตู ููุชูุชุงุช ุงูููุชูุญุฉ ููุนุถู:</label><input type="number" name="maxTicketsPerUser" value="<%= config.maxTicketsPerUser %>"></div>
            </div>

            <div id="tickets_builder" class="tab-content">
                <h3>๐๏ธ ุตุงูุน ุงูุชูุชุงุช ูุงูููุงูุฐ</h3>
                <div id="buttonsContainer"></div>
                <button type="button" class="add-btn" onclick="addNewButton()" style="width: 100%; margin-top: 15px; background: #f2a658;">โ ุฅุถุงูุฉ ุฒุฑ ุชูุช ุฌุฏูุฏ</button>
            </div>

            <div id="roles" class="tab-content">
                <h3>๐จโโ๏ธ ูุธุงู ุงูุฑุชุจ ุงูููุตูู</h3>
                <div class="form-group"><label>๐ฎ ุฅุฏุงุฑุฉ ุตุบุฑู:</label><select name="adminRoleId"><option value="">-- ุบูุฑ ูุญุฏุฏ --</option><% roles.forEach(r => { %><option value="<%= r.id %>" <%= config.adminRoleId === r.id ? 'selected' : '' %>><%= r.name %></option><% }) %></select></div>
                <div class="form-group"><label>๐ ุฅุฏุงุฑุฉ ุนููุง:</label><select name="highAdminRoles" multiple style="height:80px;"><% roles.forEach(r => { %><option value="<%= r.id %>" <%= config.highAdminRoles.includes(r.id) ? 'selected' : '' %>><%= r.name %></option><% }) %></select></div>
                <div class="form-group"><label>๐ค ูุณุงุทุฉ ุตุบุฑู:</label><select name="mediatorRoleId"><option value="">-- ุบูุฑ ูุญุฏุฏ --</option><% roles.forEach(r => { %><option value="<%= r.id %>" <%= config.mediatorRoleId === r.id ? 'selected' : '' %>><%= r.name %></option><% }) %></select></div>
                <div class="form-group"><label>๐ ูุณุงุทุฉ ุนููุง:</label><select name="highMediatorRoles" multiple style="height:80px;"><% roles.forEach(r => { %><option value="<%= r.id %>" <%= config.highMediatorRoles.includes(r.id) ? 'selected' : '' %>><%= r.name %></option><% }) %></select></div>
                
                <hr>
                <div class="form-group" style="background: #2b2b36; padding: 15px; border-radius: 8px;"><label>๐ต๏ธโโ๏ธ ุฅุฎูุงุก ุงูุชูุช ุนูุฏ ุงูุงุณุชูุงู (Claim):</label><input type="checkbox" id="hideToggle" name="hideTicketOnClaim" style="width: 20px; height: 20px;" <%= config.hideTicketOnClaim ? 'checked' : '' %>></div>
                <div class="form-group" style="background: #2b2b36; padding: 15px; border-radius: 8px;"><label>๐ ูุถุน ุงููุฑุงูุจุฉ (ุงูุฅุฏุงุฑุฉ ุชุฑู ููุง ุชูุชุจ):</label><input type="checkbox" id="readOnlyToggle" name="readOnlyStaffOnClaim" style="width: 20px; height: 20px;" <%= config.readOnlyStaffOnClaim ? 'checked' : '' %>></div>
            </div>

            <div id="commands" class="tab-content">
                <h3>โจ๏ธ ุชุฎุตูุต ุงูุฃูุงูุฑ (ุชุฃูุฏ ุฃููุง ุชุจุฏุฃ ุจู !)</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group"><label>ุชูููู ุงููุณูุท:</label><input type="text" name="cmdDone" value="<%= config.cmdDone %>"></div>
                    <div class="form-group"><label>ุงุณุชุฏุนุงุก ูุณุงุทุฉ ุนููุง:</label><input type="text" name="cmdReqHigh" value="<%= config.cmdReqHigh %>"></div>
                    <div class="form-group"><label>ุชูุงุตูู ุงูุชุฑูุฏ:</label><input type="text" name="cmdTrade" value="<%= config.cmdTrade %>"></div>
                    <div class="form-group"><label>ุณุญุจ ุงูุฅุฏุงุฑุฉ:</label><input type="text" name="cmdCome" value="<%= config.cmdCome %>"></div>
                    <div class="form-group"><label>ูุณุญ ุงูุดุงุช:</label><input type="text" name="cmdClear" value="<%= config.cmdClear %>"></div>
                    <div class="form-group"><label>ููู ุงูุดุงุช:</label><input type="text" name="cmdLock" value="<%= config.cmdLock %>"></div>
                    <div class="form-group"><label>ูุชุญ ุงูุดุงุช:</label><input type="text" name="cmdUnlock" value="<%= config.cmdUnlock %>"></div>
                    <div class="form-group"><label>ุณุญุจ ูููุณ:</label><input type="text" name="cmdVmove" value="<%= config.cmdVmove %>"></div>
                    <div class="form-group"><label>ุจุงูุฏ:</label><input type="text" name="cmdBan" value="<%= config.cmdBan %>"></div>
                    <div class="form-group"><label>ุชุงูู ุฃูุช:</label><input type="text" name="cmdTimeout" value="<%= config.cmdTimeout %>"></div>
                </div>
            </div>

            <div id="logs" class="tab-content">
                <h3>๐ ุงูุณุฌูุงุช ุจุฏูุฉ (Logs)</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group"><label>ุชุฑุงูุณูุฑูุจุช ุงูุชูุช:</label><select name="transcriptChannelId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c=>{ %><option value="<%= c.id %>" <%= config.transcriptChannelId===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div>
                    <div class="form-group"><label>ููุฌ ุงูุชูุชุงุช ุงูุฃุณุงุณู:</label><select name="ticketLogChannelId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c=>{ %><option value="<%= c.id %>" <%= config.ticketLogChannelId===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div>
                    <div class="form-group"><label>ุชูููู ุงูุฅุฏุงุฑุฉ (ุชููุงุฆู):</label><select name="staffRatingChannelId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c=>{ %><option value="<%= c.id %>" <%= config.staffRatingChannelId===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div>
                    <div class="form-group"><label>ุชูููู ุงููุณุทุงุก:</label><select name="mediatorRatingChannelId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c=>{ %><option value="<%= c.id %>" <%= config.mediatorRatingChannelId===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div>
                    <div class="form-group"><label>ููุฌ ุงูุฑุชุจ:</label><select name="logMemberRoleUpdateId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c=>{ %><option value="<%= c.id %>" <%= config.logMemberRoleUpdateId===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div>
                    <div class="form-group"><label>ููุฌ ุฏุฎูู/ุฎุฑูุฌ:</label><select name="logJoinLeaveId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c=>{ %><option value="<%= c.id %>" <%= config.logJoinLeaveId===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div>
                    <div class="form-group"><label>ููุฌ ุญุฐู ุงูุฑุณุงุฆู:</label><select name="logMsgDeleteId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c=>{ %><option value="<%= c.id %>" <%= config.logMsgDeleteId===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div>
                    <div class="form-group"><label>ููุฌ ุชุนุฏูู ุงูุฑุณุงุฆู:</label><select name="logMsgUpdateId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c=>{ %><option value="<%= c.id %>" <%= config.logMsgUpdateId===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div>
                    <div class="form-group"><label>ููุฌ ุญุฐู ุงูุตูุฑ ููุท:</label><select name="logImgDeleteId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c=>{ %><option value="<%= c.id %>" <%= config.logImgDeleteId===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div>
                    <div class="form-group"><label>ููุฌ ุบุฑู ุงูุตูุช:</label><select name="logVoiceId"><option value="">-- ูุนุทู --</option><% channels.filter(c=>c.type===0).forEach(c=>{ %><option value="<%= c.id %>" <%= config.logVoiceId===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div>
                </div>
            </div>

            <button type="submit" class="save-btn" id="mainSaveBtn" onclick="prepareData()">๐พ ุญูุธ ุฌููุน ุงูุฅุนุฏุงุฏุงุช ุงูุดุงููุฉ</button>
        </form>

        <div id="embedBuilder" class="tab-content">
            <h3 style="color: #5865F2;">๐จ ุตุงูุน ุงูุฅููุจุฏ ุงูุญุฑ ููุฑููุงุช</h3>
            <form action="/settings/<%= guild.id %>/send-embed" method="POST">
                <div class="form-group"><label>ุงูุฑูู:</label><select name="embedChannelId" required><option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option><% channels.filter(c=>c.type===0).forEach(c => { %><option value="<%= c.id %>"><%= c.name %></option><% }) %></select></div>
                <div class="form-group"><label>ุงูุนููุงู:</label><input type="text" name="embedTitle"></div>
                <div class="form-group"><label>ุงููุตู (ุงูููุงููู):</label><textarea name="embedDesc"></textarea></div>
                <div class="form-group"><label>ุงูููู:</label><input type="color" name="embedColor" value="#5865F2" style="height:40px; padding:0;"></div>
                <div class="form-group"><label>ุฑุงุจุท ุตูุฑุฉ:</label><input type="text" name="embedImage"></div>
                <button type="submit" class="save-btn" style="background: #5865F2;">๐ ุฅุฑุณุงู ุงูุฅููุจุฏ ุงูุขู!</button>
            </form>
        </div>
    </div>

    <script>
        function toggleSidebar() { document.getElementById("sidebar").classList.toggle("open"); }
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) tabcontent[i].style.display = "none";
            tablinks = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tablinks.length; i++) tablinks[i].className = tablinks[i].className.replace(" active", "");
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            if (window.innerWidth <= 768) toggleSidebar();
            document.getElementById("mainSaveBtn").style.display = (tabName === 'embedBuilder') ? "none" : "block";
        }

        const hideToggle = document.getElementById('hideToggle');
        const readOnlyToggle = document.getElementById('readOnlyToggle');
        function checkToggles() {
            if (hideToggle.checked) { readOnlyToggle.disabled = true; readOnlyToggle.checked = false; } else { readOnlyToggle.disabled = false; }
        }
        checkToggles(); hideToggle.addEventListener('change', checkToggles);

        // --- ูุธุงู ุงูุชุญุฐูุฑุงุช (ุงูุฃุณุจุงุจ ุงูุฌุงูุฒุฉ) ---
        let warnReasons = <%- JSON.stringify(config.warnReasons || []) %>;
        function renderWarnReasons() {
            const container = document.getElementById('warnReasonsContainer');
            container.innerHTML = '';
            warnReasons.forEach((reason, index) => {
                container.innerHTML += `
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <input type="text" value="${reason}" onchange="warnReasons[${index}] = this.value" placeholder="ุณุจุจ ุงูุชุญุฐูุฑ...">
                        <button type="button" onclick="warnReasons.splice(${index}, 1); renderWarnReasons();" style="background:red; border:none; color:white; padding:10px; border-radius:5px; cursor:pointer;">โ</button>
                    </div>
                `;
            });
        }
        function addWarnReason() { warnReasons.push('ุณุจุจ ุฌุฏูุฏ'); renderWarnReasons(); }
        renderWarnReasons();

        // --- ูุธุงู ุงูุชูุชุงุช ---
        let buttonsData = <%- JSON.stringify(config.customButtons || []) %>;
        const categoriesHTML = `<option value="">-- ุงุชุจุน ุงููุงุชูุฌูุฑู ุงูุงุญุชูุงุทู --</option><%- channels.filter(c=>c.type===4).map(c => `<option value="${c.id}">${c.name}</option>`).join('') %>`;

        function renderButtons() {
            const container = document.getElementById('buttonsContainer');
            container.innerHTML = '';
            buttonsData.forEach((btn, btnIndex) => {
                let fieldsHTML = '';
                btn.modalFields.forEach((field, fieldIndex) => {
                    fieldsHTML += `
                        <div style="background: #23232a; padding: 10px; margin-top: 10px; border-right: 3px solid #f2a658;">
                            <label>ุงูุณุคุงู ุงููู ููุธูุฑ ูููุงุณ:</label>
                            <input type="text" value="${field.label}" onchange="updateField(${btnIndex}, ${fieldIndex}, 'label', this.value)">
                            <button type="button" onclick="removeField(${btnIndex}, ${fieldIndex})" style="background:red; color:white; border:none; padding:5px; margin-top:5px; cursor:pointer;">ูุณุญ</button>
                        </div>
                    `;
                });

                container.innerHTML += `
                    <div class="builder-box">
                        <h4 style="color:#5865F2; margin-top:0;">๐ ุฒุฑุงุฑ (${btn.label})</h4>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                            <div><label>ุงูู ID:</label><input type="text" value="${btn.id}" onchange="updateBtn(${btnIndex}, 'id', this.value)"></div>
                            <div><label>ุงุณู ุงูุฒุฑุงุฑ:</label><input type="text" value="${btn.label}" onchange="updateBtn(${btnIndex}, 'label', this.value)"></div>
                            <div><label>ุงููุณู ุงููุฎุตุต ููุฒุฑุงุฑ (Category):</label><select onchange="updateBtn(${btnIndex}, 'categoryId', this.value)">${categoriesHTML.replace(`value="${btn.categoryId}"`, `value="${btn.categoryId}" selected`)}</select></div>
                        </div>
                        <h4 style="color:#3ba55d;">๐จ ุงูุฅููุจุฏ ุงูุฏุงุฎูู</h4>
                        <div><label>ุงูุนููุงู:</label><input type="text" value="${btn.insideEmbedTitle}" onchange="updateBtn(${btnIndex}, 'insideEmbedTitle', this.value)"></div>
                        <div><label>ุงููุตู:</label><textarea onchange="updateBtn(${btnIndex}, 'insideEmbedDesc', this.value)">${btn.insideEmbedDesc}</textarea></div>
                        <div><label>๐ช ุชูุนูู ุงููุงูุฐุฉ:</label><input type="checkbox" ${btn.requireModal?'checked':''} onchange="updateBtn(${btnIndex}, 'requireModal', this.checked)"></div>
                        <div style="display: ${btn.requireModal ? 'block' : 'none'}; background: #18181b; padding: 15px; border-radius: 5px;">
                            <label>ุนููุงู ุงููุงูุฐุฉ:</label><input type="text" value="${btn.modalTitle}" onchange="updateBtn(${btnIndex}, 'modalTitle', this.value)">
                            ${fieldsHTML}
                            <button type="button" class="add-btn" onclick="addField(${btnIndex})" style="margin-top:10px;">+ ุณุคุงู ูููุงูุฐุฉ</button>
                        </div>
                        <button type="button" onclick="removeBtn(${btnIndex})" style="background:red; color:white; border:none; padding:10px; width:100%; margin-top:15px; border-radius:5px; cursor:pointer;">๐๏ธ ุญุฐู ุงูุฒุฑ</button>
                    </div>
                `;
            });
        }
        function updateBtn(index, key, val) { buttonsData[index][key] = val; if(key === 'requireModal') renderButtons(); }
        function updateField(btnIdx, fieldIdx, key, val) { buttonsData[btnIdx].modalFields[fieldIdx][key] = val; }
        function addNewButton() { buttonsData.push({ id: 'btn_' + Math.floor(Math.random()*1000), label: 'ุฒุฑ ุฌุฏูุฏ', categoryId: '', insideEmbedTitle: 'ูุฑุญุจุงู', insideEmbedDesc: 'ูุตู...', requireModal: false, modalTitle: 'ุงูุจูุงูุงุช', modalFields: [], isMediator: false }); renderButtons(); }
        function removeBtn(index) { buttonsData.splice(index, 1); renderButtons(); }
        function addField(index) { buttonsData[index].modalFields.push({ label: 'ุณุคุงู', placeholder: '', required: true }); renderButtons(); }
        function removeField(btnIdx, fieldIdx) { buttonsData[btnIdx].modalFields.splice(fieldIdx, 1); renderButtons(); }
        renderButtons();

        // 9. ุชุญุถูุฑ ุงูุจูุงูุงุช ููุญูุธ
        function prepareData() {
            document.getElementById('customButtonsData').value = JSON.stringify(buttonsData);
            document.getElementById('warnReasonsData').value = JSON.stringify(warnReasons);
        }
    </script>
</body>
</html>

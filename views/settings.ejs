<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅุนุฏุงุฏุงุช ุงูุฅูุจุฑุงุทูุฑูุฉ | MNC System</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Tajawal', sans-serif; 
            background-color: #121212; 
            color: #ffffff; 
            margin: 0; 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
        }
        
        .mobile-header { 
            display: none; 
            background-color: #1e1e24; 
            padding: 15px 20px; 
            align-items: center; 
            justify-content: space-between; 
            border-bottom: 2px solid #5865F2; 
        }
        
        .menu-btn { 
            background: #5865F2; 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            border-radius: 5px; 
            cursor: pointer; 
            font-family: 'Tajawal', sans-serif; 
            font-weight: bold;
        }
        
        .sidebar { 
            width: 320px; 
            background-color: #1e1e24; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            overflow-y: auto; 
            z-index: 1000; 
            border-left: 1px solid #333; 
        }
        
        .sidebar-header {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid #333; 
            padding-bottom: 10px; 
            margin-bottom: 15px;
        }
        
        .sidebar h2 { 
            color: #5865F2; 
            font-size: 22px; 
            margin: 0; 
        }

        .close-sidebar-btn {
            background: transparent;
            border: none;
            color: #ff4d4d;
            font-size: 20px;
            cursor: pointer;
            display: none;
        }
        
        .tab-btn { 
            background: #2b2b36; 
            color: white; 
            border: none; 
            padding: 15px; 
            text-align: right; 
            font-size: 16px; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: 0.3s; 
            font-family: 'Tajawal', sans-serif; 
        }
        
        .tab-btn:hover { 
            background: #3b3b4f; 
        }
        
        .tab-btn.active { 
            background: #5865F2; 
            font-weight: bold; 
            border-right: 5px solid #ffffff; 
        }
        
        .content { 
            flex: 1; 
            padding: 30px; 
            overflow-y: auto; 
            background-color: #18181b; 
        }
        
        .tab-content { 
            display: none; 
            background: #23232a; 
            padding: 25px; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
            animation: fadeIn 0.4s; 
        }
        
        .tab-content.active { 
            display: block; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            color: #b9bbbe; 
            font-weight: bold; 
        }
        
        .form-group input[type="text"], 
        .form-group input[type="number"], 
        .form-group select, 
        .form-group textarea { 
            width: 100%; 
            padding: 12px; 
            background: #2f3136; 
            border: 1px solid #202225; 
            color: white; 
            border-radius: 5px; 
            box-sizing: border-box; 
            font-family: 'Tajawal', sans-serif; 
            font-size: 15px;
        }
        
        .save-btn { 
            background: #3ba55d; 
            color: white; 
            padding: 15px; 
            border: none; 
            border-radius: 5px; 
            font-size: 18px; 
            cursor: pointer; 
            width: 100%; 
            font-weight: bold; 
            font-family: 'Tajawal', sans-serif; 
            margin-top: 20px; 
            transition: 0.3s; 
            box-shadow: 0 4px 10px rgba(59, 165, 93, 0.4);
        }
        
        .save-btn:hover { 
            background: #2d7d46; 
            transform: translateY(-2px);
        }
        
        .builder-box { 
            border: 1px solid #5865F2; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            background: #1e1e24; 
        }
        
        .cmd-box { 
            background: #1e1e24; 
            border: 1px solid #444; 
            padding: 15px; 
            border-radius: 8px; 
        }
        
        hr { 
            border-color: #333; 
            margin: 20px 0; 
        }
        
        .section-title { 
            color: #f2a658; 
            border-bottom: 2px solid #333; 
            padding-bottom: 10px; 
            margin-top: 30px; 
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) { 
            body { flex-direction: column; overflow: auto; } 
            .mobile-header { display: flex; } 
            .sidebar { display: none; width: 100%; height: auto;} 
            .sidebar.open { display: flex; } 
            .close-sidebar-btn { display: block; }
            .content { padding: 15px; } 
        }
    </style>
</head>
<body>

    <div class="mobile-header">
        <h2 style="margin: 0; color: white;">MNC Control</h2>
        <button class="menu-btn" onclick="document.getElementById('sidebar').classList.toggle('open')">โฐ ุงููุงุฆูุฉ ุงููุชูุฏูุฉ</button>
    </div>

    <div class="sidebar" id="sidebar">
        
        <div class="sidebar-header">
            <h2>๐ Control Panel</h2>
            <button class="close-sidebar-btn" onclick="document.getElementById('sidebar').classList.remove('open')">โ</button>
        </div>

        <button class="tab-btn active" onclick="openTab(event, 'general')">โ๏ธ ุงูุฅุนุฏุงุฏุงุช ูุงูุชุฑุญูุจ</button>
        <button class="tab-btn" onclick="openTab(event, 'warns_games')">โ๏ธ ุงูุชุญุฐูุฑุงุช ูุงูุฃูุนุงุจ</button>
        <button class="tab-btn" onclick="openTab(event, 'multi_panels')" style="border-right: 3px solid #f2a658;">๐๏ธ ูุธุงู ุงูุจุงููุงุช ุงููุชุนุฏุฏุฉ</button>
        <button class="tab-btn" onclick="openTab(event, 'roles')">๐จโโ๏ธ ุงูุฑุชุจ ูุงุณุชูุงู ุงูุชูุช</button>
        <button class="tab-btn" onclick="openTab(event, 'trade_approvals')" style="border-right: 3px solid #3ba55d;">โ๏ธ ุงูููุงููุงุช ุงูุนููุง ููุชุฑูุฏ</button>
        <button class="tab-btn" onclick="openTab(event, 'commands')">โจ๏ธ ุงูุฃูุงูุฑ ุงูุฏููุงููููุฉ ูููู</button>
        <button class="tab-btn" onclick="openTab(event, 'punishments')" style="border-right: 3px solid #e74c3c;">๐จ ุชุญูู ุงูุนููุจุงุช ูุงูุฅููุจุฏุงุช</button>
        <button class="tab-btn" onclick="openTab(event, 'logs')">๐ ุฌููุน ุณุฌูุงุช ุงูููุฌ</button>
        <button class="tab-btn" onclick="openTab(event, 'embeds_control')" style="border-right: 3px solid #ed4245;">๐จ ุชุญูู ุงูุฃููุงู ุงูุดุงูู</button>
        <button class="tab-btn" onclick="openTab(event, 'ratings_system')" style="border-right: 3px solid #f1c40f;">โญ ูุธุงู ุงูุชููููุงุช</button>
        <button class="tab-btn" onclick="openTab(event, 'embedBuilder')" style="border-right: 3px solid #9b59b6;">๐ ุตุงูุน ุงูุฅููุจุฏ ุงูุญุฑ</button>
        
        <a href="/dashboard" style="color: #ff4d4d; text-align: center; margin-top: auto; padding-top:20px; text-decoration: none; font-weight: bold;">โฌ๏ธ ุงูุนูุฏุฉ ููุณูุฑูุฑุงุช</a>
    </div>

    <div class="content">
        
        <% if (success === 'saved') { %> 
            <div style="background: #3ba55d; padding: 15px; text-align: center; border-radius: 5px; margin-bottom: 20px; font-weight: bold; font-size: 18px; color: white;">
                โ ุชูุช ูุฒุงููุฉ ุงูุชุนุฏููุงุช ูุน ุงูุฏูุณููุฑุฏ ุจูุฌุงุญ!
            </div> 
        <% } %>
        
        <form action="/settings/<%= guild.id %>" method="POST" id="mainForm">
            
            <input type="hidden" name="ticketPanelsData" id="ticketPanelsData">
            <input type="hidden" name="warnReasonsARData" id="warnReasonsARData">
            <input type="hidden" name="warnReasonsENData" id="warnReasonsENData">

            <div id="general" class="tab-content active">
                <h3 class="section-title">โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูุงูุญูุงูุฉ</h3>
                <div class="form-group">
                    <label>ุงูุจุฑูููุณ (Prefix):</label>
                    <input type="text" name="prefix" value="<%= config.prefix || '!' %>">
                </div>
                
                <div class="form-group" style="background: #2b2b36; padding: 15px; border-radius: 8px;">
                    <label style="display:inline-block; margin:0; color:#f2a658;">๐ก๏ธ ุงูุญูุงูุฉ (ุชูุนูู ุงูุฅููุงู ุงูุชููุงุฆู):</label><br><br>
                    <input type="checkbox" name="antiLinks" style="width:20px; height:20px;" <%= config.antiLinks ? 'checked' : '' %>> <span style="font-size: 16px;">ููุน ูุดุฑ ุงูุฑูุงุจุท</span> <br>
                    <input type="checkbox" name="antiSpam" style="width:20px; height:20px; margin-top: 10px;" <%= config.antiSpam ? 'checked' : '' %>> <span style="font-size: 16px;">ููุน ุงูุณุจุงู ูุงูุชูุฑุงุฑ</span>
                </div>
                
                <div class="form-group">
                    <label>ุฑุชุจุฉ ุงูุฏุฎูู ุงูุชููุงุฆูุฉ (Auto-Role):</label>
                    <select name="autoRoleId">
                        <option value="">-- ูุนุทู --</option>
                        <% roles.forEach(r => { %>
                            <option value="<%= r.id %>" <%= config.autoRoleId === r.id ? 'selected' : '' %>><%= r.name %></option>
                        <% }) %>
                    </select>
                </div>
                
                <h3 class="section-title">๐ผ๏ธ ูุธุงู ุงูุชุฑุญูุจ ุงููุชุทูุฑ</h3>
                <div class="form-group">
                    <label>ุฑูู ุงูุชุฑุญูุจ:</label>
                    <select name="welcomeChannelId">
                        <option value="">-- ูุนุทู --</option>
                        <% channels.filter(c=>c.type===0).forEach(c => { %>
                            <option value="<%= c.id %>" <%= config.welcomeChannelId === c.id ? 'selected' : '' %>><%= c.name %></option>
                        <% }) %>
                    </select>
                </div>
                <div class="form-group">
                    <label>ุฑุณุงูุฉ ุงูุชุฑุญูุจ ุงููุตูุฉ:</label>
                    <textarea name="welcomeMessage" rows="3"><%= config.welcomeMessage || 'ุญูุงู ุงููู ูุง [user] ูู [server]! ุฃูุช ุงูุนุถู ุฑูู [memberCount].' %></textarea>
                </div>
                <div class="form-group">
                    <label>ุฑุงุจุท ุตูุฑุฉ ุงูุฎูููุฉ (ุฑุงุจุท ูุจุงุดุฑ):</label>
                    <input type="text" name="welcomeBgImage" value="<%= config.welcomeBgImage || '' %>">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>ููู ุฅุทุงุฑ ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ:</label>
                        <input type="color" name="welcomeAvatarBorderColor" value="<%= config.welcomeAvatarBorderColor || '#ffffff' %>" style="height: 40px; padding:0;">
                    </div>
                    <div class="form-group">
                        <label>ููู ุฅููุจุฏ ุงูุชุฑุญูุจ:</label>
                        <input type="color" name="welcomeEmbedColor" value="<%= config.welcomeEmbedColor || '#5865F2' %>" style="height: 40px; padding:0;">
                    </div>
                </div>
            </div>

            <div id="warns_games" class="tab-content">
                <h3 class="section-title">โ๏ธ ููุญุฉ ุงูุชุญูู ุจุงูุชุญุฐูุฑุงุช ุงููุฒุฏูุฌุฉ</h3>
                <div class="form-group">
                    <label>ุฑูู ุฅุฑุณุงู ููุญุฉ ุงูุชุญุฐูุฑุงุช:</label>
                    <select name="warnPanelChannelId">
                        <option value="">-- ูุนุทู --</option>
                        <% channels.filter(c=>c.type===0).forEach(c => { %>
                            <option value="<%= c.id %>" <%= config.warnPanelChannelId === c.id ? 'selected' : '' %>><%= c.name %></option>
                        <% }) %>
                    </select>
                </div>
                <div class="form-group">
                    <label>ุฑูู ุณุฌู ุงูุชุญุฐูุฑุงุช (ุงูููุฌ):</label>
                    <select name="warnLogChannelId">
                        <option value="">-- ุงุชุจุน ุงูููุฌ ุงูุนุงู --</option>
                        <% channels.filter(c=>c.type===0).forEach(c => { %>
                            <option value="<%= c.id %>" <%= config.warnLogChannelId === c.id ? 'selected' : '' %>><%= c.name %></option>
                        <% }) %>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>ุนููุงู ููุญุฉ ุงูุชุญุฐูุฑ:</label>
                        <input type="text" name="warnPanelTitle" value="<%= config.warnPanelTitle || 'ููุญุฉ ุชุญูู ุงูุชุญุฐูุฑ' %>">
                    </div>
                    <div class="form-group">
                        <label>ููู ุงูุฅููุจุฏ:</label>
                        <input type="color" name="warnPanelColor" value="<%= config.warnPanelColor || '#ed4245' %>" style="height:40px; padding:0;">
                    </div>
                </div>
                <div class="form-group">
                    <label>ูุตู ุงูุฅููุจุฏ (ุงูุชุนูููุงุช):</label>
                    <textarea name="warnPanelDesc" rows="2"><%= config.warnPanelDesc || 'ุงุณุชุฎุฏู ุงูุฃุฒุฑุงุฑ ุฃุฏูุงู ูุฅุฏุงุฑุฉ ุชุญุฐูุฑุงุช ุงูุฃุนุถุงุก.' %></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>ุงูุญุฏ ุงูุฃูุตู ููุชุญุฐูุฑุงุช (ููุนุงูุจ ุจุนุฏูุง):</label>
                        <input type="number" name="warnMax" value="<%= config.warnMax || 3 %>">
                    </div>
                    <div class="form-group">
                        <label>ุงูุนูุงุจ ุงูุชููุงุฆู ุจุนุฏ ุชุฌุงูุฒ ุงูุญุฏ:</label>
                        <select name="warnAction">
                            <option value="timeout" <%= config.warnAction === 'timeout' ? 'selected' : '' %>>Timeout (ูุชู)</option>
                            <option value="kick" <%= config.warnAction === 'kick' ? 'selected' : '' %>>Kick (ุทุฑุฏ)</option>
                            <option value="ban" <%= config.warnAction === 'ban' ? 'selected' : '' %>>Ban (ุญุธุฑ)</option>
                        </select>
                    </div>
                </div>
                
                <div class="builder-box" style="border-color: #3ba55d;">
                    <h4 style="margin-top:0; color:#3ba55d;">๐ธ๐ฆ ุงูุฃุณุจุงุจ ุงูุฌุงูุฒุฉ ููุชุญุฐูุฑ (ุจุงููุบุฉ ุงูุนุฑุจูุฉ)</h4>
                    <div id="warnReasonsARContainer"></div>
                    <button type="button" onclick="warnReasonsARArrayData.push('ุณุจุจ ุฌุฏูุฏ');renderWarnReasonsAR();" style="background:#3ba55d; border:none; color:white; padding:10px 20px; border-radius:5px; margin-top:10px; cursor:pointer; font-weight:bold;">โ ุฅุถุงูุฉ ุณุจุจ ุนุฑุจู</button>
                </div>

                <div class="builder-box" style="border-color: #5865F2;">
                    <h4 style="margin-top:0; color:#5865F2;">๐บ๐ธ ุงูุฃุณุจุงุจ ุงูุฌุงูุฒุฉ ููุชุญุฐูุฑ (ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ)</h4>
                    <div id="warnReasonsENContainer"></div>
                    <button type="button" onclick="warnReasonsENArrayData.push('New Reason');renderWarnReasonsEN();" style="background:#5865F2; border:none; color:white; padding:10px 20px; border-radius:5px; margin-top:10px; cursor:pointer; font-weight:bold;">โ Add English Reason</button>
                </div>

                <h3 class="section-title">๐ฎ ุงูุฃูุนุงุจ ูุงููุณุชููุงุช</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div class="form-group" style="background:#2b2b36; padding:15px; border-radius:8px;">
                        <label>ุชูุนูู ุงูุฃูุนุงุจ:</label>
                        <input type="checkbox" name="gamesEnabled" style="width: 20px; height: 20px;" <%= config.gamesEnabled ? 'checked' : '' %>>
                    </div>
                    <div class="form-group" style="background:#2b2b36; padding:15px; border-radius:8px;">
                        <label>ุชูุนูู ูุธุงู ุงููุณุชููุงุช:</label>
                        <input type="checkbox" name="levelingEnabled" style="width: 20px; height: 20px;" <%= config.levelingEnabled ? 'checked' : '' %>>
                    </div>
                </div>
            </div>

            <div id="multi_panels" class="tab-content">
                <h3 class="section-title">๐๏ธ ุฅุนุฏุงุฏุงุช ุงูุจุงููุงุช (ุงูุชูุชุงุช ุงููุชุนุฏุฏุฉ)</h3>
                <p style="color: #a3a6aa;">ููููู ุฅูุดุงุก ุนุฏุฏ ูุง ููุงุฆู ูู ุจุงููุงุช ุงูุชูุชุงุชุ ูู ุจุงูู ูู ุฑูู ูููุตูุฉ ููู ุฒุฑุงูุฑู ูุฃูุณุงูู ุงูุฎุงุตุฉุ ูุน ุงูุญูุงุธ ุนูู ุงูุชุฑููู ุงูููุญุฏ ูุฌููุน ุงูุชูุชุงุช ูู ุงูุณูุฑูุฑ.</p>
                
                <div class="form-group" style="background: #2b2b36; padding: 15px; border-radius: 8px;">
                    <label style="color:#f2a658;">ุงูุญุฏ ุงูุฃูุตู ููุชูุชุงุช ุงูููุชูุญุฉ ููุนุถู ุงููุงุญุฏ (ุนูู ูุณุชูู ุงูุณูุฑูุฑ ููู):</label>
                    <input type="number" name="maxTicketsPerUser" value="<%= config.maxTicketsPerUser || 1 %>">
                </div>
                
                <div id="panelsContainer"></div>
                
                <button type="button" onclick="addNewPanel()" style="background:#5865F2; color:white; border:none; padding:15px; width:100%; font-size:18px; font-weight:bold; border-radius:8px; cursor:pointer; margin-top:20px; box-shadow: 0 4px 10px rgba(88, 101, 242, 0.4);">โ ุฅุถุงูุฉ ุจุงูู ุชูุช ุฌุฏูุฏ (New Panel)</button>
            </div>

            <div id="roles" class="tab-content">
                <h3 class="section-title">๐จโโ๏ธ ูุธุงู ุงูุฑุชุจ ุงูููุญุฏ</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>๐ฎ ุฑุชุจุฉ ุงูุฅุฏุงุฑุฉ ุงูุตุบุฑู (Staff):</label>
                        <select name="adminRoleId">
                            <option value="">-- ุบูุฑ ูุญุฏุฏ --</option>
                            <% roles.forEach(r => { %>
                                <option value="<%= r.id %>" <%= config.adminRoleId === r.id ? 'selected' : '' %>><%= r.name %></option>
                            <% }) %>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>๐ ุฑุชุจ ุงูุฅุฏุงุฑุฉ ุงูุนููุง (ูุชุนุฏุฏ):</label>
                        <select name="highAdminRoles" multiple style="height:100px;">
                            <% roles.forEach(r => { %>
                                <option value="<%= r.id %>" <%= config.highAdminRoles && config.highAdminRoles.includes(r.id) ? 'selected' : '' %>><%= r.name %></option>
                            <% }) %>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>๐ค ุฑุชุจุฉ ุงูู MiddleMan (ุงููุณุงุทุฉ ุงูุตุบุฑู):</label>
                        <select name="middlemanRoleId">
                            <option value="">-- ุบูุฑ ูุญุฏุฏ --</option>
                            <% roles.forEach(r => { %>
                                <option value="<%= r.id %>" <%= config.middlemanRoleId === r.id ? 'selected' : '' %>><%= r.name %></option>
                            <% }) %>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>๐ ุฑุชุจ ุงูู High MiddleMan (ุงููุณุงุทุฉ ุงูุนููุง - ูุชุนุฏุฏ):</label>
                        <select name="highMiddlemanRoles" multiple style="height:100px;">
                            <% roles.forEach(r => { %>
                                <option value="<%= r.id %>" <%= config.highMiddlemanRoles && config.highMiddlemanRoles.includes(r.id) ? 'selected' : '' %>><%= r.name %></option>
                            <% }) %>
                        </select>
                    </div>
                </div>
                <hr>
                
                <h3 class="section-title">๐ต๏ธโโ๏ธ ุชุญูู ุงุณุชูุงู ุงูุชูุช (Claim Toggles)</h3>
                <div class="form-group" style="background: #2b2b36; padding: 20px; border-radius: 8px; border-left: 4px solid #f2a658;">
                    <p style="color: #a3a6aa; margin-top: 0;">ุงุฎุชุฑ ููู ุณูุชุนุงูู ุงูุจูุช ูุน ุจุงูู ุงูุฅุฏุงุฑุฉ ุนูุฏ ุงุณุชูุงู ุฃุญุฏ ุงูุฅุฏุงุฑููู ููุชูุช:</p>
                    
                    <div style="margin-bottom: 15px;">
                        <input type="checkbox" id="hideToggle" name="hideTicketOnClaim" style="width: 20px; height: 20px; vertical-align: middle;" <%= config.hideTicketOnClaim ? 'checked' : '' %>>
                        <label style="display:inline-block; font-size: 16px; margin-right: 10px; color: #ed4245;">ุฅุฎูุงุก ุงูุชูุช ุชูุงูุงู ุนู ุจุงูู ุงูุฅุฏุงุฑุฉ ุจูุฌุฑุฏ ุงูุงุณุชูุงู.</label>
                    </div>
                    
                    <div>
                        <input type="checkbox" id="readOnlyToggle" name="readOnlyStaffOnClaim" style="width: 20px; height: 20px; vertical-align: middle;" <%= config.readOnlyStaffOnClaim ? 'checked' : '' %>>
                        <label style="display:inline-block; font-size: 16px; margin-right: 10px; color: #3ba55d;">ุฌุนู ุงูุชูุช "ูุฑุงุกุฉ ููุท" ูุจุงูู ุงูุฅุฏุงุฑุฉ (ูุฑูู ุงููุญุงุฏุซุฉ ููุง ูููููู ุงููุชุงุจุฉ).</label>
                    </div>
                    
                    <p style="color: #f2a658; font-size: 13px; margin-bottom: 0;">* ููุงุญุธุฉ: ุฅุฐุง ููุช ุจุชูุนูู "ุงูุฅุฎูุงุก"ุ ุณูุชู ุชุนุทูู "ุงููุฑุงุกุฉ ููุท" ุชููุงุฆูุงู.</p>
                </div>
            </div>

            <div id="trade_approvals" class="tab-content">
                <h3 class="section-title">โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุชุฑูุฏ ูุงูููุงููุงุช ูุงููุฏุงุก</h3>
                
                <div class="builder-box" style="border-color:#3ba55d;">
                    <h4 style="color:#3ba55d; margin-top:0;">1. ุฃูุฑ ูุชุงุจุฉ ุงูุชุฑูุฏ (!trade)</h4>
                    <p style="color:#a3a6aa; font-size: 14px;">ููุธูุฑ ุฒุฑุงุฑ ููุชุงุจุฉ ุชูุงุตูู ุงูุญุณุงุจ ูุงูุณุนุฑุ ุซู ููุฒู ุทูุจ ููููุงููุฉ.</p>
                    <div class="form-group">
                        <label>ุงูุฃูุฑ:</label>
                        <input type="text" name="cmdTrade" value="<%= config.cmdTrade || '!trade' %>">
                    </div>
                    <div class="form-group">
                        <label>ุงูุฑุชุจ ุงููุณููุญ ููุง ุจูุชุงุจุฉ ุงูุฃูุฑ (ูู ูุธูุฑ ูู ุงูุฒุฑ):</label>
                        <select name="cmdTradeRoles" multiple style="height:100px;">
                            <% roles.forEach(r => { %>
                                <option value="<%= r.id %>" <%= config.cmdTradeRoles && config.cmdTradeRoles.includes(r.id) ? 'selected' : '' %>><%= r.name %></option>
                            <% }) %>
                        </select>
                    </div>
                </div>

                <div class="builder-box" style="border-color:#f2a658;">
                    <h4 style="color:#f2a658; margin-top:0;">2. ุตูุงุญูุงุช ุงูููุงููุฉ ุงูุนููุง (Approve / Reject)</h4>
                    <p style="color:#a3a6aa; font-size: 14px;">ุญุฏุฏ ูู ููููู ุงูุถุบุท ุนูู ุฒุฑุงูุฑ (ููุงููุฉโ / ุฑูุถโ) ุจุนุฏ ูุชุงุจุฉ ุงูุชุฑูุฏ.</p>
                    <div class="form-group">
                        <label>ุฑุชุจ ุงูููุงููุฉ ุงูุนููุง:</label>
                        <select name="tradeApproveRoles" multiple style="height:100px;">
                            <% roles.forEach(r => { %>
                                <option value="<%= r.id %>" <%= config.tradeApproveRoles && config.tradeApproveRoles.includes(r.id) ? 'selected' : '' %>><%= r.name %></option>
                            <% }) %>
                        </select>
                    </div>
                </div>

                <div class="builder-box" style="border-color:#ed4245;">
                    <h4 style="color:#ed4245; margin-top:0;">3. ูุธุงู ุงูููุดู ูุงููุฏุงุก (!req-high)</h4>
                    <p style="color:#a3a6aa; font-size: 14px;">ุนูุฏ ูุฒูู ุทูุจ ุงูุชุฑูุฏุ ุฃู ูุชุงุจุฉ ุฃูุฑ ุงููุฏุงุกุ ุณูููู ุงูุจูุช ุจุนูู ููุดู ููุฐู ุงูุฑุชุจ.</p>
                    <div class="form-group">
                        <label>ุฃูุฑ ุงููุฏุงุก ุงููุจุงุดุฑ:</label>
                        <input type="text" name="cmdReqHigh" value="<%= config.cmdReqHigh || '!req-high' %>">
                    </div>
                    <div class="form-group">
                        <label>ุฑุชุจ ุงูููุดู (ุงูุชู ุณูุชู ููุดูุชูุง):</label>
                        <select name="tradeMentionRoles" multiple style="height:100px;">
                            <% roles.forEach(r => { %>
                                <option value="<%= r.id %>" <%= config.tradeMentionRoles && config.tradeMentionRoles.includes(r.id) ? 'selected' : '' %>><%= r.name %></option>
                            <% }) %>
                        </select>
                    </div>
                </div>
            </div>

            <div id="commands" class="tab-content">
                <h3 class="section-title">โจ๏ธ ุงูุฃูุงูุฑ ุงูุฏููุงููููุฉ ููุบุฑู ูุงููู</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <% 
                    const cmdsList = [
                        {id: 'cmdDone', label: 'ุชูููู ุงูู MiddleMan (!done)'}, 
                        {id: 'cmdUnban', label: 'ูู ุงูุจุงูุฏ (!unban)'},
                        {id: 'cmdUntimeout', label: 'ูู ุงูุชุงูู ุฃูุช (!untimeout)'},
                        {id: 'cmdVmove', label: 'ุณุญุจ ุนุถู ููููุณู (!vmove)'}, 
                        {id: 'cmdMove', label: 'ููู ุนุถู ูุฑูู ูุญุฏุฏุฉ (!move)'},
                        {id: 'cmdCome', label: 'ุงุณุชุฏุนุงุก ููุฑูู (DM) (!come)'}, 
                        {id: 'cmdClear', label: 'ูุณุญ ุงูุดุงุช (!clear)'}, 
                        {id: 'cmdLock', label: 'ููู ุงูุดุงุช (!lock)'}, 
                        {id: 'cmdUnlock', label: 'ูุชุญ ุงูุดุงุช (!unlock)'}
                    ]; 
                    cmdsList.forEach(cmdObj => { 
                    %>
                        <div class="cmd-box">
                            <label style="color:#5865F2; font-size:16px;">๐ฅ ุฃูุฑ <%= cmdObj.label %>:</label>
                            <input type="text" name="<%= cmdObj.id %>" value="<%= config[cmdObj.id] %>" style="margin-bottom:15px;">
                            <label style="font-size:14px; color:#a3a6aa;">ุงูุฑุชุจ ุงููุณููุญ ููุง:</label>
                            <select name="<%= cmdObj.id %>Roles" multiple style="height:80px;">
                                <% roles.forEach(r => { %>
                                    <option value="<%= r.id %>" <%= config[cmdObj.id+'Roles'] && config[cmdObj.id+'Roles'].includes(r.id) ? 'selected' : '' %>><%= r.name %></option>
                                <% }) %>
                            </select>
                        </div>
                    <% }) %>
                </div>
            </div>

            <div id="punishments" class="tab-content">
                <h3 class="section-title">๐จ ุชุญูู ุฅููุจุฏุงุช ุงูุนููุจุงุช ุจุงูุดุงุช</h3>
                
                <div class="form-group" style="background:#2b2b36; padding:15px; border-radius:8px;">
                    <label style="color:#e74c3c; font-size:18px;">ููุน ุงูุฅููุจุฏ ุงูููุฑุณู ุจุงูุดุงุช (ุงูุนุงู):</label>
                    <select name="punishmentStyle" onchange="toggleCustomPunishment(this.value)">
                        <option value="basic" <%= config.punishmentStyle === 'basic' ? 'selected' : '' %>>ุงูุฃุณุงุณู (ุดูู ูุจูุฑ ูููุณู)</option>
                        <option value="custom" <%= config.punishmentStyle === 'custom' ? 'selected' : '' %>>ูุฎุตุต (ุฃูุช ุชูุชุจ ุงูุฑุณุงูุฉ)</option>
                    </select>
                </div>

                <div id="customPunishmentBox" style="display: <%= config.punishmentStyle === 'custom' ? 'block' : 'none' %>; background:#1e1e24; padding:20px; border-radius:8px; border:1px solid #e74c3c;">
                    <p style="color:#a3a6aa; margin-bottom: 20px;">
                        ุงููุชุบูุฑุงุช ุงููุชุงุญุฉ: <code>[user]</code>, <code>[moderator]</code>, <code>[reason]</code>, <code>[duration]</code>
                    </p>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="cmd-box">
                            <label style="color:#ed4245;">ุฃูุฑ ุงูุจุงูุฏ (!ban):</label>
                            <input type="text" name="cmdBan" value="<%= config.cmdBan || '!ban' %>" style="margin-bottom:10px;">
                            <label>ุฑุชุจ ุงูุจุงูุฏ:</label>
                            <select name="cmdBanRoles" multiple style="height:60px; margin-bottom:15px;">
                                <% roles.forEach(r => { %>
                                    <option value="<%= r.id %>" <%= config.cmdBanRoles && config.cmdBanRoles.includes(r.id) ? 'selected' : '' %>><%= r.name %></option>
                                <% }) %>
                            </select>
                            <h4 style="color:#ed4245; margin-top:0;">ุฅููุจุฏ ุงูุฅุนุทุงุก ุงููุฎุตุต</h4>
                            <input type="text" name="customBanTitle" value="<%= config.customBanTitle || '๐จ ุชู ุญุธุฑ ุนุถู' %>" placeholder="ุงูุนููุงู">
                            <textarea name="customBanDesc" rows="3" style="margin-top:10px;"><%= config.customBanDesc || 'ุชู ุญุธุฑ [user] ุจูุงุณุทุฉ [moderator].\nุงูุณุจุจ: [reason]' %></textarea>
                        </div>

                        <div class="cmd-box">
                            <label style="color:#f2a658;">ุฃูุฑ ุงูุชุงูู ุฃูุช (!timeout):</label>
                            <input type="text" name="cmdTimeout" value="<%= config.cmdTimeout || '!timeout' %>" style="margin-bottom:10px;">
                            <label>ุฑุชุจ ุงูุชุงูู ุฃูุช:</label>
                            <select name="cmdTimeoutRoles" multiple style="height:60px; margin-bottom:15px;">
                                <% roles.forEach(r => { %>
                                    <option value="<%= r.id %>" <%= config.cmdTimeoutRoles && config.cmdTimeoutRoles.includes(r.id) ? 'selected' : '' %>><%= r.name %></option>
                                <% }) %>
                            </select>
                            <h4 style="color:#f2a658; margin-top:0;">ุฅููุจุฏ ุงูุฅุนุทุงุก ุงููุฎุตุต</h4>
                            <input type="text" name="customTimeoutTitle" value="<%= config.customTimeoutTitle || 'โณ ุชู ุฅุนุทุงุก ุชุงูู ุฃูุช' %>" placeholder="ุงูุนููุงู">
                            <textarea name="customTimeoutDesc" rows="3" style="margin-top:10px;"><%= config.customTimeoutDesc || 'ุชู ูุนุงูุจุฉ [user] ุจูุงุณุทุฉ [moderator] ููุฏุฉ [duration].\nุงูุณุจุจ: [reason]' %></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div id="logs" class="tab-content">
                <h3 class="section-title">๐ ุงูุณุฌูุงุช ูุงูููุฌุงุช ุงูุดุงููุฉ</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <% 
                    const logList = [
                        {id: 'transcriptChannelId', label: 'ุฑูู ุงูุชุฑุงูุณูุฑูุจุช (ุงููููุงุช)'}, 
                        {id: 'ticketLogChannelId', label: 'ููุฌ ุญุฑูุงุช ุงูุชูุช'}, 
                        {id: 'staffRatingChannelId', label: 'ููุฌ ุชููููุงุช ุงูุฅุฏุงุฑุฉ'}, 
                        {id: 'middlemanRatingChannelId', label: 'ููุฌ ุชููููุงุช ุงูู MiddleMan (!done)'}, 
                        {id: 'logBanId', label: 'ููุฌ ุงูุจุงูุฏ ููู ุงูุจุงูุฏ'}, 
                        {id: 'logTimeoutId', label: 'ููุฌ ุงูุชุงูู ุฃูุช ูููู'},
                        {id: 'logMsgDeleteId', label: 'ููุฌ ุญุฐู ุงูุฑุณุงุฆู'}, 
                        {id: 'logMsgUpdateId', label: 'ููุฌ ุชุนุฏูู ุงูุฑุณุงุฆู'}, 
                        {id: 'logVoiceId', label: 'ููุฌ ุงููููุณ'}, 
                        {id: 'logJoinLeaveId', label: 'ููุฌ ุงูุฏุฎูู ูุงูุฎุฑูุฌ'},
                        {id: 'logRoleCreateDeleteId', label: 'ููุฌ ุงูุฑุชุจ'}, 
                        {id: 'logMemberRoleUpdateId', label: 'ููุฌ ุชุญุฏูุซุงุช ุงูุฃุนุถุงุก'}, 
                        {id: 'logInviteId', label: 'ููุฌ ุงูุฏุนูุงุช'}, 
                        {id: 'logChannelThreadId', label: 'ููุฌ ุงูุฑููุงุช ูุงูุซุฑูุฏ'}
                    ]; 
                    logList.forEach(logObj => { 
                    %>
                        <div class="form-group" style="background:#23232a; padding:15px; border-radius:8px; margin-bottom:0;">
                            <label style="color:#f2a658;"><%= logObj.label %>:</label>
                            <select name="<%= logObj.id %>">
                                <option value="">-- ูุนุทู --</option>
                                <% channels.filter(c=>c.type===0).forEach(c=>{ %>
                                    <option value="<%= c.id %>" <%= config[logObj.id]===c.id?'selected':'' %>><%= c.name %></option>
                                <% }) %>
                            </select>
                        </div>
                    <% }) %>
                </div>
            </div>

            <div id="embeds_control" class="tab-content">
                <h3 class="section-title">๐จ ุชุญูู ุฃููุงู ุงูุฅููุจุฏุงุช ุงูุดุงูู</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group cmd-box"><label style="color:white;">ุฅููุจุฏ ุฅุฌุงุจุงุช ุงูููุงูุฐ (ูู ุงูุชูุช):</label><input type="color" name="answersEmbedColor" value="<%= config.answersEmbedColor || '#2b2d31' %>" style="height:50px; padding:0; cursor:pointer;"></div>
                    <div class="form-group cmd-box"><label style="color:white;">ุฅููุจุฏ ุงูููู (Close):</label><input type="color" name="closeEmbedColor" value="<%= config.closeEmbedColor || '#2b2d31' %>" style="height:50px; padding:0; cursor:pointer;"></div>
                    <div class="form-group cmd-box"><label style="color:white;">ุฅููุจุฏ ุทูุจ ุงูุชุฑูุฏ (!trade):</label><input type="color" name="tradeEmbedColor" value="<%= config.tradeEmbedColor || '#f2a658' %>" style="height:50px; padding:0; cursor:pointer;"></div>
                    <div class="form-group cmd-box"><label style="color:white;">ููุฌ ุงูุชูุชุงุช ุงูุฃุณุงุณู (Ticket Logs):</label><input type="color" name="logEmbedColor" value="<%= config.logEmbedColor || '#ed4245' %>" style="height:50px; padding:0; cursor:pointer;"></div>
                    <div class="form-group cmd-box"><label style="color:white;">ุฅููุจุฏ ุงูุชุฑุงูุณูุฑูุจุช (Transcript):</label><input type="color" name="transcriptEmbedColor" value="<%= config.transcriptEmbedColor || '#2b2d31' %>" style="height:50px; padding:0; cursor:pointer;"></div>
                    <div class="form-group cmd-box"><label style="color:#ed4245;">ุฅููุจุฏ ุฅุนุทุงุก ุงูุจุงูุฏ (!ban):</label><input type="color" name="banEmbedColor" value="<%= config.banEmbedColor || '#ed4245' %>" style="height:50px; padding:0; cursor:pointer;"></div>
                    <div class="form-group cmd-box"><label style="color:#3ba55d;">ุฅููุจุฏ ูู ุงูุจุงูุฏ (!unban):</label><input type="color" name="unbanEmbedColor" value="<%= config.unbanEmbedColor || '#3ba55d' %>" style="height:50px; padding:0; cursor:pointer;"></div>
                    <div class="form-group cmd-box"><label style="color:#f2a658;">ุฅููุจุฏ ุงูุชุงูู ุฃูุช (!timeout):</label><input type="color" name="timeoutEmbedColor" value="<%= config.timeoutEmbedColor || '#f2a658' %>" style="height:50px; padding:0; cursor:pointer;"></div>
                    <div class="form-group cmd-box"><label style="color:#3ba55d;">ุฅููุจุฏ ูู ุงูุชุงูู (!untimeout):</label><input type="color" name="untimeoutEmbedColor" value="<%= config.untimeoutEmbedColor || '#3ba55d' %>" style="height:50px; padding:0; cursor:pointer;"></div>
                </div>
            </div>

            <div id="ratings_system" class="tab-content">
                <h3 class="section-title">โญ ุงูุชุญูู ูู ุฑุณุงุฆู ุงูุชูููู</h3>
                <div class="form-group" style="background:#2b2b36; padding:15px; border-radius:8px;">
                    <label style="color:#5865F2; font-size:18px;">ููุน ุงูุชูููู ุงูููุฑุณู:</label>
                    <select name="ratingStyle" onchange="toggleCustomRating(this.value)">
                        <option value="basic" <%= config.ratingStyle === 'basic' ? 'selected' : '' %>>ุงูุฃุณุงุณู ุงูุนุฑุจู</option>
                        <option value="custom" <%= config.ratingStyle === 'custom' ? 'selected' : '' %>>ุชูููู ูุฏูู ูุฎุตุต</option>
                    </select>
                </div>

                <div id="customRatingBox" style="display: <%= config.ratingStyle === 'custom' ? 'block' : 'none' %>; background:#1e1e24; padding:20px; border-radius:8px; border:1px solid #f2a658;">
                    <p style="color:#a3a6aa;">ุงููุชุบูุฑุงุช ุงููุชุงุญุฉ: <code>[user]</code> ููุนูููุ <code>[staff]</code> ููุฅุฏุงุฑู/ุงููุณูุทุ <code>[server]</code> ูุงุณู ุงูุณูุฑูุฑ.</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="cmd-box">
                            <h4 style="color:#3ba55d; margin-top:0;">ุชูููู ุงูุฏุนู ุงูููู ูุงูุฅุฏุงุฑุฉ</h4>
                            <div class="form-group"><label>ุงูุนููุงู:</label><input type="text" name="customRatingTitle" value="<%= config.customRatingTitle || 'ุชูููู ูุฑูู ุงูุนูู' %>"></div>
                            <div class="form-group"><label>ุงููุตู:</label><textarea name="customRatingText" rows="4"><%= config.customRatingText || 'ูุฑุญุจุงู [user]ุ ูุฑุฌู ุชูููู ุฎุฏูุฉ ุงูุฅุฏุงุฑู [staff].' %></textarea></div>
                            <div class="form-group"><label>ููู ุงูุฅููุจุฏ:</label><input type="color" name="staffRatingColor" value="<%= config.staffRatingColor || '#3ba55d' %>" style="height:40px; padding:0;"></div>
                        </div>
                        <div class="cmd-box">
                            <h4 style="color:#f2a658; margin-top:0;">ุชูููู ุงูู MiddleMan (!done)</h4>
                            <div class="form-group"><label>ุงูุนููุงู:</label><input type="text" name="customMiddlemanRatingTitle" value="<%= config.customMiddlemanRatingTitle || 'ุชูููู ุงููุณุงุทุฉ' %>"></div>
                            <div class="form-group"><label>ุงููุตู:</label><textarea name="customMiddlemanRatingText" rows="4"><%= config.customMiddlemanRatingText || 'ูุฑุญุจุงู [user]ุ ูุฑุฌู ุชูููู ุฎุฏูุฉ ุงููุณูุท [staff].' %></textarea></div>
                            <div class="form-group"><label>ููู ุงูุฅููุจุฏ:</label><input type="color" name="basicRatingColor" value="<%= config.basicRatingColor || '#f2a658' %>" style="height:40px; padding:0;"></div>
                        </div>
                    </div>
                </div>
                
                <div id="basicRatingColors" style="display: <%= config.ratingStyle === 'basic' ? 'block' : 'none' %>; margin-top: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group cmd-box"><label style="color:#3ba55d;">ููู ุชูููู ุงูุฅุฏุงุฑุฉ (ุงูุจูุณู):</label><input type="color" name="staffRatingColor_basic" value="<%= config.staffRatingColor || '#3ba55d' %>" onchange="document.getElementsByName('staffRatingColor')[0].value = this.value;" style="height:40px; padding:0;"></div>
                        <div class="form-group cmd-box"><label style="color:#f2a658;">ููู ุชูููู ุงูู MiddleMan (ุงูุจูุณู):</label><input type="color" name="basicRatingColor_basic" value="<%= config.basicRatingColor || '#f2a658' %>" onchange="document.getElementsByName('basicRatingColor')[0].value = this.value;" style="height:40px; padding:0;"></div>
                    </div>
                </div>
            </div>

            <button type="submit" class="save-btn" id="mainSaveBtn" onclick="prepareData()">๐พ ุญูุธ ุฌููุน ุงูุฅุนุฏุงุฏุงุช ูุชุญุฏูุซ ุงูุจูุช ููุฑุงู!</button>
        </form>
        
        <div id="embedBuilder" class="tab-content">
            <h3 class="section-title" style="color: #9b59b6;">๐ ุตุงูุน ุงูุฅููุจุฏ ุงูุญุฑ ููุฑููุงุช</h3>
            <form action="/settings/<%= guild.id %>/send-embed" method="POST">
                <div class="form-group">
                    <label>ุงูุฑูู ุงููุฑุงุฏ ุงูุฅุฑุณุงู ุฅูููุง:</label>
                    <select name="embedChannelId" required>
                        <option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option>
                        <% channels.filter(c=>c.type===0).forEach(c => { %>
                            <option value="<%= c.id %>"><%= c.name %></option>
                        <% }) %>
                    </select>
                </div>
                <div class="form-group"><label>ุงูุนููุงู:</label><input type="text" name="embedTitle"></div>
                <div class="form-group"><label>ุงููุตู (ุงููุต ุงูุฑุฆูุณู):</label><textarea name="embedDesc" rows="5"></textarea></div>
                <div class="form-group"><label>ุงูููู:</label><input type="color" name="embedColor" value="#5865F2" style="height:40px; padding:0;"></div>
                <div class="form-group"><label>ุฑุงุจุท ุตูุฑุฉ ูุจูุฑุฉ (ุงุฎุชูุงุฑู):</label><input type="text" name="embedImage"></div>
                <div class="form-group"><label>ุงููุต ุงูุณููู Footer (ุงุฎุชูุงุฑู):</label><input type="text" name="embedFooter"></div>
                <button type="submit" class="save-btn" style="background: #9b59b6;">ุงุฑุณุงู ุงูุฅููุจุฏ ุงูุขู!</button>
            </form>
        </div>
    </div>

    <script>
        function openTab(eventObj, tabName) {
            const allContents = document.querySelectorAll(".tab-content");
            for (let i = 0; i < allContents.length; i++) {
                allContents[i].style.display = "none";
            }
            const allButtons = document.querySelectorAll(".tab-btn");
            for (let i = 0; i < allButtons.length; i++) {
                allButtons[i].classList.remove("active");
            }
            document.getElementById(tabName).style.display = "block"; 
            eventObj.currentTarget.classList.add("active");
            
            if (tabName === 'embedBuilder') {
                document.getElementById("mainSaveBtn").style.display = "none";
            } else {
                document.getElementById("mainSaveBtn").style.display = "block";
            }
            
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        }
        
        function toggleCustomRating(val) { 
            document.getElementById('customRatingBox').style.display = (val === 'custom') ? 'block' : 'none';
            document.getElementById('basicRatingColors').style.display = (val === 'custom') ? 'none' : 'block';
        }
        
        function toggleCustomPunishment(val) { 
            document.getElementById('customPunishmentBox').style.display = (val === 'custom') ? 'block' : 'none'; 
        }

        // ๐ฅ ุจุฑูุฌุฉ ุฃุฒุฑุงุฑ ุงุณุชูุงู ุงูุชูุช (ุงูููุน ุงููุชุจุงุฏู)
        const hideToggleElement = document.getElementById('hideToggle'); 
        const readOnlyToggleElement = document.getElementById('readOnlyToggle');
        
        function checkClaimTogglesLogic() { 
            if(hideToggleElement && readOnlyToggleElement) {
                if(hideToggleElement.checked === true) {
                    readOnlyToggleElement.disabled = true;
                    readOnlyToggleElement.checked = false;
                } else {
                    readOnlyToggleElement.disabled = false;
                }
            } 
        }
        
        if(hideToggleElement) {
            checkClaimTogglesLogic(); 
            hideToggleElement.addEventListener('change', checkClaimTogglesLogic);
        }

        // ==========================================
        // ๐ฅ ูุญุฑู ุจูุงุก ุงูุชุญุฐูุฑุงุช (ุนุฑุจู ูุฅูุฌููุฒู)
        // ==========================================
        let warnReasonsARArrayData = <%- JSON.stringify(config.warnReasonsAR || []) %>;
        function renderWarnReasonsAR() {
            const containerDivElement = document.getElementById('warnReasonsARContainer'); 
            containerDivElement.innerHTML = '';
            
            for (let i = 0; i < warnReasonsARArrayData.length; i++) {
                const reasonTextString = warnReasonsARArrayData[i];
                
                const wrapperDivObject = document.createElement('div');
                wrapperDivObject.style.display = 'flex';
                wrapperDivObject.style.gap = '10px';
                wrapperDivObject.style.marginBottom = '10px';
                
                const inputElementObject = document.createElement('input');
                inputElementObject.type = 'text';
                inputElementObject.value = reasonTextString;
                inputElementObject.placeholder = 'ุณุจุจ ุงูุชุญุฐูุฑ...';
                inputElementObject.onchange = function() { 
                    warnReasonsARArrayData[i] = this.value; 
                };
                
                const deleteButtonObject = document.createElement('button');
                deleteButtonObject.type = 'button';
                deleteButtonObject.innerText = 'โ';
                deleteButtonObject.style.background = 'red';
                deleteButtonObject.style.border = 'none';
                deleteButtonObject.style.color = 'white';
                deleteButtonObject.style.padding = '10px 15px';
                deleteButtonObject.style.borderRadius = '5px';
                deleteButtonObject.style.cursor = 'pointer';
                deleteButtonObject.onclick = function() { 
                    warnReasonsARArrayData.splice(i, 1); 
                    renderWarnReasonsAR(); 
                };
                
                wrapperDivObject.appendChild(inputElementObject);
                wrapperDivObject.appendChild(deleteButtonObject);
                containerDivElement.appendChild(wrapperDivObject);
            }
        } 
        renderWarnReasonsAR();

        let warnReasonsENArrayData = <%- JSON.stringify(config.warnReasonsEN || []) %>;
        function renderWarnReasonsEN() {
            const containerDivElement = document.getElementById('warnReasonsENContainer'); 
            containerDivElement.innerHTML = '';
            
            for (let i = 0; i < warnReasonsENArrayData.length; i++) {
                const reasonTextString = warnReasonsENArrayData[i];
                
                const wrapperDivObject = document.createElement('div');
                wrapperDivObject.style.display = 'flex';
                wrapperDivObject.style.gap = '10px';
                wrapperDivObject.style.marginBottom = '10px';
                
                const inputElementObject = document.createElement('input');
                inputElementObject.type = 'text';
                inputElementObject.value = reasonTextString;
                inputElementObject.placeholder = 'Warn Reason...';
                inputElementObject.onchange = function() { 
                    warnReasonsENArrayData[i] = this.value; 
                };
                
                const deleteButtonObject = document.createElement('button');
                deleteButtonObject.type = 'button';
                deleteButtonObject.innerText = 'โ';
                deleteButtonObject.style.background = 'red';
                deleteButtonObject.style.border = 'none';
                deleteButtonObject.style.color = 'white';
                deleteButtonObject.style.padding = '10px 15px';
                deleteButtonObject.style.borderRadius = '5px';
                deleteButtonObject.style.cursor = 'pointer';
                deleteButtonObject.onclick = function() { 
                    warnReasonsENArrayData.splice(i, 1); 
                    renderWarnReasonsEN(); 
                };
                
                wrapperDivObject.appendChild(inputElementObject);
                wrapperDivObject.appendChild(deleteButtonObject);
                containerDivElement.appendChild(wrapperDivObject);
            }
        } 
        renderWarnReasonsEN();

        // ==========================================
        // ๐ฅ ูุญุฑู ุจูุงุก ุงูุจุงููุงุช ุงููุชุนุฏุฏุฉ (Multi-Panels Engine)
        // ==========================================
        
        let panelsDataArrayList = <%- JSON.stringify(config.ticketPanels && config.ticketPanels.length > 0 ? config.ticketPanels : []) %>;

        if (panelsDataArrayList.length === 0) {
            const defaultPanelObject = {
                id: 'panel_' + Date.now(),
                name: 'ุงูุจุงูู ุงูุฃุณุงุณู',
                panelChannelId: '',
                ticketCategoryId: '',
                embedTitle: 'ุงูุฏุนู ุงูููู',
                embedDesc: 'ุงุถุบุท ุนูู ุงูุฒุฑ ููุชุญ ุชุฐูุฑุฉ.',
                embedColor: '#0099ff',
                embedImage: '',
                buttons: []
            };
            panelsDataArrayList.push(defaultPanelObject);
        }

        const serverRolesArrayData = <%- JSON.stringify(roles || []) %>;
        
        const textChannelsHTMLString = `<option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option><%- channels.filter(c=>c.type===0).map(c=>`<option value="${c.id}">${c.name}</option>`).join('') %>`;
        const categoryChannelsHTMLString = `<option value="">-- ุงุฎุชุฑ ูุณู ุงูุชูุชุงุช --</option><%- channels.filter(c=>c.type===4).map(c=>`<option value="${c.id}">${c.name}</option>`).join('') %>`;
        
        function renderPanels() {
            const containerDivElement = document.getElementById('panelsContainer'); 
            containerDivElement.innerHTML = '';
            
            for (let pIndex = 0; pIndex < panelsDataArrayList.length; pIndex++) {
                
                const panelObjectData = panelsDataArrayList[pIndex];
                let buttonsHTMLString = '';
                
                if (panelObjectData.buttons && panelObjectData.buttons.length > 0) {
                    
                    for (let bIndex = 0; bIndex < panelObjectData.buttons.length; bIndex++) {
                        
                        const buttonObjectData = panelObjectData.buttons[bIndex];
                        let fieldsHTMLString = ''; 
                        
                        if (buttonObjectData.modalFields) {
                            for (let fIndex = 0; fIndex < buttonObjectData.modalFields.length; fIndex++) {
                                
                                const fieldObjectData = buttonObjectData.modalFields[fIndex];
                                
                                fieldsHTMLString += `
                                <div style="background:#23232a; padding:10px; margin-top:10px; border-right:3px solid #f2a658;">
                                    <label>ุณุคุงู (Label) ${fIndex + 1}:</label>
                                    <input type="text" value="${fieldObjectData.label}" onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].modalFields[${fIndex}].label=this.value">
                                    <button type="button" onclick="panelsDataArrayList[${pIndex}].buttons[${bIndex}].modalFields.splice(${fIndex},1);renderPanels();" style="background:red; color:white; border:none; padding:5px 10px; margin-top:5px; border-radius:3px; cursor:pointer;">ุญุฐู ุงูุณุคุงู</button>
                                </div>`;
                            }
                        }

                        let rolesOptionsHTMLString = '';
                        for (let rIndex = 0; rIndex < serverRolesArrayData.length; rIndex++) {
                            const roleObjectData = serverRolesArrayData[rIndex];
                            
                            let isRoleSelectedString = '';
                            if (buttonObjectData.allowedClaimRoles && buttonObjectData.allowedClaimRoles.includes(roleObjectData.id)) {
                                isRoleSelectedString = 'selected';
                            }
                            
                            rolesOptionsHTMLString += `<option value="${roleObjectData.id}" ${isRoleSelectedString}>${roleObjectData.name}</option>`;
                        }

                        const requireModalChecked = buttonObjectData.requireModal ? 'checked' : '';
                        const isMiddleManChecked = buttonObjectData.isMiddleMan ? 'checked' : '';
                        const enableRatingChecked = (buttonObjectData.enableRating !== false) ? 'checked' : '';

                        buttonsHTMLString += `
                        <div class="builder-box" style="border-color:#f2a658; margin-top:20px; margin-left: 20px;">
                            <h4 style="color:#f2a658; margin-top:0;">๐ ุฒุฑ: ${buttonObjectData.label}</h4>
                            
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                                <div>
                                    <label>ุงูู ID ุงูุจุฑูุฌู ููุฒุฑ:</label>
                                    <input type="text" value="${buttonObjectData.id}" onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].id=this.value">
                                </div>
                                <div>
                                    <label>ุงุณู ุงูุฒุฑุงุฑ:</label>
                                    <input type="text" value="${buttonObjectData.label}" onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].label=this.value">
                                </div>
                                <div>
                                    <label>ููู ุงูุฒุฑุงุฑ:</label>
                                    <select onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].color=this.value">
                                        <option value="Primary" ${buttonObjectData.color=='Primary'?'selected':''}>ุฃุฒุฑู</option>
                                        <option value="Success" ${buttonObjectData.color=='Success'?'selected':''}>ุฃุฎุถุฑ</option>
                                        <option value="Danger" ${buttonObjectData.color=='Danger'?'selected':''}>ุฃุญูุฑ</option>
                                        <option value="Secondary" ${buttonObjectData.color=='Secondary'?'selected':''}>ุฑูุงุฏู</option>
                                    </select>
                                </div>
                            </div>

                            <h5 style="color:#3ba55d; margin-top:15px;">๐จ ุงูุฅููุจุฏ ุงูุฏุงุฎูู ููุชูุช (ุงูุชุฑุญูุจ)</h5>
                            <div style="display:grid; grid-template-columns: 1fr; gap:10px;">
                                <div>
                                    <label>ุงูุนููุงู:</label>
                                    <input type="text" value="${buttonObjectData.insideEmbedTitle}" onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].insideEmbedTitle=this.value">
                                </div>
                                <div>
                                    <label>ุงููุตู:</label>
                                    <textarea rows="2" onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].insideEmbedDesc=this.value">${buttonObjectData.insideEmbedDesc}</textarea>
                                </div>
                                <div>
                                    <label>ุงูููู:</label>
                                    <input type="color" value="${buttonObjectData.insideEmbedColor}" onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].insideEmbedColor=this.value" style="height:40px; padding:0; width:100px;">
                                </div>
                            </div>

                            <h5 style="color:#f2a658; margin-top:15px;">๐ต๏ธโโ๏ธ ุฑุชุจ ุงูุงุณุชูุงู ุงููุฎุตุตุฉ ููุฐุง ุงูุฒุฑ (Claim)</h5>
                            <select multiple style="height:80px; width:100%;" onchange="const selectedOptsArray = Array.from(this.selectedOptions).map(opt=>opt.value); panelsDataArrayList[${pIndex}].buttons[${bIndex}].allowedClaimRoles = selectedOptsArray;">
                                ${rolesOptionsHTMLString}
                            </select>

                            <h5 style="color:#9b59b6; margin-top:15px;">๐ช ุงููุงูุฐุฉ ูุงูุชูููู</h5>
                            <div style="margin-bottom:15px; background: #18181b; padding: 15px; border-radius: 8px;">
                                <input type="checkbox" ${requireModalChecked} onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].requireModal=this.checked;renderPanels();" style="width:18px;height:18px;"> 
                                <label style="display:inline;">ุชูุนูู ูุงูุฐุฉ ุงูุฃุณุฆูุฉ</label>
                                
                                <span style="margin:0 10px;">|</span>
                                
                                <input type="checkbox" ${isMiddleManChecked} onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].isMiddleMan=this.checked;" style="width:18px;height:18px;"> 
                                <label style="display:inline;">ุชูุช MiddleMan (!done)</label>
                                
                                <span style="margin:0 10px;">|</span>
                                
                                <input type="checkbox" ${enableRatingChecked} onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].enableRating=this.checked;" style="width:18px;height:18px;"> 
                                <label style="display:inline;">ุฅุฑุณุงู ุชูููู ุชููุงุฆู ููุฅุฏุงุฑุฉ</label>
                            </div>

                            <div style="display:${buttonObjectData.requireModal?'block':'none'}; background:#2f3136; padding:15px; border-radius:5px;">
                                <label>ุนููุงู ุงููุงูุฐุฉ (Modal Title):</label>
                                <input type="text" value="${buttonObjectData.modalTitle}" onchange="panelsDataArrayList[${pIndex}].buttons[${bIndex}].modalTitle=this.value">
                                ${fieldsHTMLString}
                                <button type="button" onclick="if(!panelsDataArrayList[${pIndex}].buttons[${bIndex}].modalFields) panelsDataArrayList[${pIndex}].buttons[${bIndex}].modalFields=[]; panelsDataArrayList[${pIndex}].buttons[${bIndex}].modalFields.push({label:'ุณุคุงู ุฌุฏูุฏ',required:true});renderPanels();" style="background:#3ba55d; color:white; border:none; padding:10px; margin-top:10px; border-radius:5px; cursor:pointer;">โ ุฅุถุงูุฉ ุณุคุงู ูููุงูุฐุฉ</button>
                            </div>
                            
                            <button type="button" onclick="panelsDataArrayList[${pIndex}].buttons.splice(${bIndex},1);renderPanels();" style="background:#ed4245; color:white; border:none; padding:10px; width:100%; margin-top:15px; font-weight:bold; border-radius:5px; cursor:pointer;">๐๏ธ ุญุฐู ูุฐุง ุงูุฒุฑ ูู ุงูุจุงูู</button>
                        </div>`;
                    }
                }

                const replacedTextChannels = textChannelsHTMLString.replace(`value="${panelObjectData.panelChannelId}"`, `value="${panelObjectData.panelChannelId}" selected`);
                const replacedCatChannels = categoryChannelsHTMLString.replace(`value="${panelObjectData.ticketCategoryId}"`, `value="${panelObjectData.ticketCategoryId}" selected`);

                let panelHtmlContainerString = `
                    <div class="builder-box" style="border: 2px solid #5865F2; padding: 25px; margin-top: 30px; background: #1e1e24;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h3 style="color:#ffffff; margin:0; font-size: 22px;">๐๏ธ ุจุงูู: <input type="text" value="${panelObjectData.name}" onchange="panelsDataArrayList[${pIndex}].name=this.value" style="width: 200px; display:inline-block; font-size:18px; padding:5px; background:transparent; border-bottom:1px solid #5865F2; border-top:none; border-left:none; border-right:none; color:white;"></h3>
                            <button type="button" onclick="panelsDataArrayList.splice(${pIndex},1);renderPanels();" style="background:#ed4245; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; font-weight:bold;">๐๏ธ ุญุฐู ุงูุจุงูู ุจุงููุงูู</button>
                        </div>
                        <hr style="border-color:#333;">
                        
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                            <div>
                                <label>ุงูุฑูู ุงูุชู ุณูุฑุณู ูููุง ุงูุจุงูู:</label>
                                <select onchange="panelsDataArrayList[${pIndex}].panelChannelId=this.value">${replacedTextChannels}</select>
                            </div>
                            <div>
                                <label>ุงููุณู ุงูุฐู ุณุชูุชุญ ููู ุชูุชุงุช ูุฐุง ุงูุจุงูู:</label>
                                <select onchange="panelsDataArrayList[${pIndex}].ticketCategoryId=this.value">${replacedCatChannels}</select>
                            </div>
                        </div>

                        <h4 style="color:#0099ff; margin-top:20px;">๐ผ๏ธ ุชุตููู ุฅููุจุฏ ุงูุจุงูู ุงูุฎุงุฑุฌู</h4>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                            <div>
                                <label>ุงูุนููุงู:</label>
                                <input type="text" value="${panelObjectData.embedTitle}" onchange="panelsDataArrayList[${pIndex}].embedTitle=this.value">
                            </div>
                            <div>
                                <label>ุงูููู:</label>
                                <input type="color" value="${panelObjectData.embedColor}" onchange="panelsDataArrayList[${pIndex}].embedColor=this.value" style="height:40px; padding:0;">
                            </div>
                            <div style="grid-column: span 2;">
                                <label>ุงููุตู:</label>
                                <textarea rows="3" onchange="panelsDataArrayList[${pIndex}].embedDesc=this.value">${panelObjectData.embedDesc}</textarea>
                            </div>
                            <div style="grid-column: span 2;">
                                <label>ุฑุงุจุท ุตูุฑุฉ ูุจูุฑุฉ (ุงุฎุชูุงุฑู):</label>
                                <input type="text" value="${panelObjectData.embedImage}" onchange="panelsDataArrayList[${pIndex}].embedImage=this.value">
                            </div>
                        </div>

                        <h4 style="color:#f2a658; margin-top:25px; border-bottom: 1px solid #333; padding-bottom:10px;">๐ ุฒุฑุงูุฑ ุงูุชูุชุงุช ุงูุฎุงุตุฉ ุจูุฐุง ุงูุจุงูู</h4>
                        
                        ${buttonsHTMLString}
                        
                        <button type="button" onclick="if(!panelsDataArrayList[${pIndex}].buttons) panelsDataArrayList[${pIndex}].buttons=[]; panelsDataArrayList[${pIndex}].buttons.push({id: 'btn_'+Date.now(), label:'ุฒุฑ ุฌุฏูุฏ', color:'Primary', insideEmbedTitle:'ุชุฐูุฑุฉ ุฌุฏูุฏุฉ', insideEmbedDesc:'ูุฑุฌู ูุชุงุจุฉ ุทูุจู...', insideEmbedColor:'#2b2d31', requireModal:false, modalTitle:'ุจูุงูุงุช ูุทููุจุฉ', modalFields:[], isMiddleMan:false, enableRating:true, allowedClaimRoles:[]}); renderPanels();" style="background:#2b2b36; border: 1px dashed #f2a658; color:#f2a658; padding:15px; width:100%; margin-top:15px; font-weight:bold; border-radius:5px; cursor:pointer;">โ ุฅุถุงูุฉ ุฒุฑ ุฌุฏูุฏ ููุฐุง ุงูุจุงูู</button>
                    </div>`;
                
                containerDivElement.innerHTML += panelHtmlContainerString;
            }
        } 
        
        renderPanels();

        function addNewPanel() { 
            const newPanelDataObject = {
                id: 'panel_' + Date.now(),
                name: 'ุจุงูู ุฌุฏูุฏ',
                panelChannelId: '',
                ticketCategoryId: '',
                embedTitle: 'ุงูุฏุนู ุงูููู',
                embedDesc: 'ุงุถุบุท ุนูู ุงูุฒุฑ ููุชุญ ุชุฐูุฑุฉ.',
                embedColor: '#0099ff',
                embedImage: '',
                buttons: []
            };
            panelsDataArrayList.push(newPanelDataObject); 
            renderPanels(); 
        }

        // ==========================================
        // ุชุฌููุฒ ุงูุฏุงุชุง ููุฅุฑุณุงู ูุญูุธูุง ูู ุงูู Hidden Inputs
        // ==========================================
        function prepareData() { 
            const stringifiedPanelsData = JSON.stringify(panelsDataArrayList);
            document.getElementById('ticketPanelsData').value = stringifiedPanelsData; 
            
            const stringifiedWarnsARData = JSON.stringify(warnReasonsARArrayData);
            document.getElementById('warnReasonsARData').value = stringifiedWarnsARData; 
            
            const stringifiedWarnsENData = JSON.stringify(warnReasonsENArrayData);
            document.getElementById('warnReasonsENData').value = stringifiedWarnsENData; 
        }
    </script>
</body>
</html>

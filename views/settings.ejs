<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MNC Ultimate Control | ุฅุนุฏุงุฏุงุช ุงูุฅูุจุฑุงุทูุฑูุฉ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Tajawal', 'sans-serif'] 
                    },
                    colors: { 
                        brand: { 
                            DEFAULT: '#5865F2', 
                            dark: '#4752C4', 
                            light: '#7289DA' 
                        }, 
                        dark: { 
                            900: '#0b0f19', 
                            800: '#151b2b', 
                            700: '#1f2937', 
                            600: '#334155' 
                        } 
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #0b0f19; 
            color: #f8fafc; 
            overflow-x: hidden; 
            scroll-behavior: smooth; 
        }
        
        ::-webkit-scrollbar { 
            width: 8px; 
            height: 8px; 
        }
        
        ::-webkit-scrollbar-track { 
            background: #0b0f19; 
        }
        
        ::-webkit-scrollbar-thumb { 
            background: #1f2937; 
            border-radius: 10px; 
        }
        
        ::-webkit-scrollbar-thumb:hover { 
            background: #5865F2; 
        }
        
        .glass-card { 
            background: rgba(21, 27, 43, 0.8); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.6); 
        }
        
        .input-glow:focus { 
            box-shadow: 0 0 0 3px rgba(88, 101, 242, 0.3); 
            border-color: #5865F2; 
            outline: none; 
        }
        
        .settings-section { 
            display: none; 
            animation: fadeIn 0.4s ease forwards; 
        }
        
        .settings-section.active { 
            display: block; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(15px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* ุฃุฒุฑุงุฑ ุงูุชูุนูู (Toggles) */
        .switch { 
            position: relative; 
            display: inline-block; 
            width: 54px; 
            height: 28px; 
        }
        
        .switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; left: 0; right: 0; bottom: 0; 
            background-color: #374151; 
            transition: .4s; 
            border-radius: 34px; 
        }
        
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 20px; 
            width: 20px; 
            right: 4px; 
            bottom: 4px; 
            background-color: white; 
            transition: .4s; 
            border-radius: 50%; 
        }
        
        input:checked + .slider { 
            background-color: #10B981; 
        }
        
        input:checked + .slider:before { 
            transform: translateX(-26px); 
        }
    </style>
</head>

<% 
    let textChannels = []; 
    let voiceChannels = []; 
    let categories = []; 
    let serverRoles = [];
    let guildName = "Unknown Server"; 
    let guildIconUrl = "https://cdn.discordapp.com/embed/avatars/0.png";

    if (bot && guildId) {
        const currentGuild = bot.guilds.cache.get(guildId);
        if (currentGuild) {
            guildName = currentGuild.name;
            if (currentGuild.icon) {
                guildIconUrl = `https://cdn.discordapp.com/icons/${guildId}/${currentGuild.icon}.png`;
            }
            textChannels = currentGuild.channels.cache.filter(c => c.type === 0 || c.type === 5 || c.type === 15).sort((a,b) => a.position - b.position).map(c => ({ id: c.id, name: c.name }));
            categories = currentGuild.channels.cache.filter(c => c.type === 4).sort((a,b) => a.position - b.position).map(c => ({ id: c.id, name: c.name }));
            serverRoles = currentGuild.roles.cache.filter(r => r.id !== guildId).sort((a,b) => b.position - a.position).map(r => ({ id: r.id, name: r.name }));
        }
    }
%>

<body class="flex h-screen overflow-hidden selection:bg-brand selection:text-white">

    <aside class="w-72 flex-shrink-0 border-l border-dark-700 bg-dark-800 flex flex-col z-20 shadow-[5px_0_20px_rgba(0,0,0,0.5)]">
        <div class="h-24 flex flex-col items-center justify-center border-b border-dark-700 bg-dark-900/60 relative overflow-hidden">
            <h1 class="text-2xl font-black text-white tracking-wider relative z-10">
                MNC <span class="text-brand">CONTROL</span>
            </h1>
        </div>
        
        <nav class="flex-1 overflow-y-auto py-6 px-4 space-y-2 custom-scrollbar" id="sidebar-nav">
            
            <div class="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-3 px-2">ุงูุฃุณุงุณูุงุช ูุงูุฐูุงุก</div>
            
            <button onclick="switchSection('general')" class="nav-btn active-nav w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all bg-brand text-white font-bold" data-target="general">
                <span class="text-lg">โ๏ธ</span> 
                <span>ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูุงูุฃููุงู</span>
            </button>
            
            <button onclick="switchSection('ai_system')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-amber-400 hover:bg-dark-700 font-bold" data-target="ai_system">
                <span class="text-lg">โจ</span> 
                <span>ุงูุฐูุงุก ุงูุงุตุทูุงุนู (AI)</span>
            </button>
            
            <button onclick="switchSection('live_embed')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="live_embed">
                <span class="text-lg">๐จ</span> 
                <span>ุตุงูุน ุงูุฅููุจุฏ ุงูููุฑู</span>
            </button>

            <div class="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-3 mt-8 px-2">ุงูุชุฐุงูุฑ ูุงููุณุงุทุฉ</div>
            
            <button onclick="switchSection('middleman')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="middleman">
                <span class="text-lg">โ๏ธ</span> 
                <span>ูุธุงู ุงููุณุงุทุฉ (ุงููุนุฒูู)</span>
            </button>
            
            <button onclick="switchSection('custom_panels')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="custom_panels">
                <span class="text-lg">๐ซ</span> 
                <span>ุงูุจุงููุงุช ุงูุฏููุงููููุฉ</span>
            </button>
            
            <button onclick="switchSection('ticket_controls')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="ticket_controls">
                <span class="text-lg">๐๏ธ</span> 
                <span>ุงูุชุญูู ุงูุฏุงุฎูู ููุชูุช</span>
            </button>

            <div class="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-3 mt-8 px-2">ุงูุฅุฏุงุฑุฉ ูุงูุนููุจุงุช</div>
            
            <button onclick="switchSection('warnings')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-orange-400 hover:bg-dark-700 font-bold" data-target="warnings">
                <span class="text-lg">โ๏ธ</span> 
                <span>ูุธุงู ุงูุชุญุฐูุฑุงุช ูุงูุฅุฏุงุฑุฉ</span>
            </button>
            
            <button onclick="switchSection('commands')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="commands">
                <span class="text-lg">โจ๏ธ</span> 
                <span>ุชุฎุตูุต ุงูุฃูุงูุฑ</span>
            </button>
            
            <button onclick="switchSection('logs')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="logs">
                <span class="text-lg">๐</span> 
                <span>ุงูุณุฌูุงุช ุงูุฏูููุฉ ูุงูุฃููุงู</span>
            </button>
            
            <button onclick="switchSection('roles')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="roles">
                <span class="text-lg">๐</span> 
                <span>ุงูุฑุชุจ ูุงูุตูุงุญูุงุช ุงูุนููุง</span>
            </button>
            
            <button onclick="switchSection('ratings')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="ratings">
                <span class="text-lg">โญ</span> 
                <span>ุงูุชููููุงุช ุงููุฒุฏูุฌุฉ</span>
            </button>

            <div class="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-3 mt-8 px-2">ุงูุญูุงูุฉ ูุงูุชูุงุนู</div>
            
            <button onclick="switchSection('protection')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="protection">
                <span class="text-lg">๐ก๏ธ</span> 
                <span>ุงูุญูุงูุฉ ูุงูู Anti-Nuke</span>
            </button>
            
            <button onclick="switchSection('welcome')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="welcome">
                <span class="text-lg">๐</span> 
                <span>ุงูุชุฑุญูุจ ูุงููุบุงุฏุฑุฉ</span>
            </button>
            
            <button onclick="switchSection('economy')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="economy">
                <span class="text-lg">๐ฐ</span> 
                <span>ุงูุงูุชุตุงุฏ ูุงูุถุฑูุจุฉ</span>
            </button>
            
            <button onclick="switchSection('leveling')" class="nav-btn w-full flex items-center space-x-3 space-x-reverse px-4 py-3.5 rounded-xl transition-all text-slate-400 hover:bg-dark-700 hover:text-white font-bold" data-target="leveling">
                <span class="text-lg">๐</span> 
                <span>ูุธุงู ุงููููุงุช (Leveling)</span>
            </button>

        </nav>
    </aside>

    <main class="flex-1 flex flex-col h-screen relative bg-dark-900">
        
        <header class="h-24 flex-shrink-0 border-b border-dark-700 bg-dark-800/80 backdrop-blur-xl flex items-center px-10 z-10 shadow-md">
            <div class="flex items-center space-x-5 space-x-reverse z-10">
                <img src="<%= guildIconUrl %>" class="w-14 h-14 rounded-xl border border-dark-600 shadow-lg object-cover">
                <div>
                    <h2 class="text-2xl font-black text-white tracking-wide"><%= guildName %></h2>
                </div>
            </div>
        </header>

        <button type="submit" form="mega-settings-form" onclick="return syncAllDataBeforeSave()" class="fixed bottom-8 left-8 z-[100] flex items-center px-8 py-5 bg-emerald-500 hover:bg-emerald-400 text-dark-900 text-xl font-black rounded-2xl shadow-[0_0_40px_rgba(16,185,129,0.4)] transition-all transform hover:-translate-y-2 hover:scale-105 border border-emerald-400/50">
            <span class="mr-3 ml-2 text-3xl">๐พ</span> 
            ุญูุธ ุงูุชุนุฏููุงุช ุงูุขู
        </button>

        <div class="flex-1 overflow-y-auto p-6 md:p-10 z-10 custom-scrollbar relative" id="main-scroll-area">
            
            <% if (typeof success !== 'undefined' && success) { %>
                <div class="mb-8 bg-emerald-500/10 border-r-4 border-emerald-500 text-emerald-400 px-6 py-5 rounded-xl flex items-center shadow-lg mx-auto max-w-5xl">
                    <span class="text-2xl ml-4">โ</span>
                    <div>
                        <h4 class="font-bold text-lg">ุชู ุงูุญูุธ ุจูุฌุงุญ!</h4>
                    </div>
                </div>
            <% } %>

            <form action="/settings/<%= guildId %>/save" method="POST" id="mega-settings-form">
                
                <div id="section-general" class="settings-section active max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูุงูุฃููุงู โ๏ธ</h2>
                    
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-brand">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-3">ุงูุจุงุฏุฆุฉ (Prefix)</label>
                                <input type="text" name="prefix" value="<%= config.prefix || '!' %>" required class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-5 text-white input-glow font-mono text-2xl text-center font-black">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-3">ูุบุฉ ุงููุธุงู ุงูุฃุณุงุณูุฉ</label>
                                <select name="language" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-4 px-5 text-white input-glow font-bold text-lg cursor-pointer">
                                    <option value="ar" <%= config.language === 'ar' ? 'selected' : '' %>>๐ธ๐ฆ ุงูุนุฑุจูุฉ (Arabic)</option>
                                    <option value="en" <%= config.language === 'en' ? 'selected' : '' %>>๐บ๐ธ ุงูุฅูุฌููุฒูุฉ (English)</option>
                                </select>
                            </div>
                        </div>

                        <h3 class="text-2xl font-bold text-white mb-6">๐จ ุชูุญูุฏ ุฃุดูุงู ุงูุฅููุจุฏ (Global Embeds)</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-dark-900/50 p-5 rounded-2xl border border-dark-700">
                                <label class="block text-sm font-bold text-brand-light mb-3">โน๏ธ ุงูููู ุงูุฃุณุงุณู</label>
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <input type="color" id="emb_primaryColor_picker" value="<%= config.embedSetup?.primaryColor || '#5865F2' %>" class="w-14 h-12 rounded-xl bg-dark-900 border border-dark-600 p-1 cursor-pointer" onchange="document.getElementById('emb_primaryColor').value = this.value">
                                    <input type="text" id="emb_primaryColor" name="emb_primaryColor" value="<%= config.embedSetup?.primaryColor || '#5865F2' %>" class="flex-1 bg-dark-800 border border-dark-600 rounded-xl py-3 px-3 text-white font-mono uppercase text-center" oninput="document.getElementById('emb_primaryColor_picker').value = this.value">
                                </div>
                            </div>
                            <div class="bg-dark-900/50 p-5 rounded-2xl border border-dark-700">
                                <label class="block text-sm font-bold text-emerald-400 mb-3">โ ููู ุงููุฌุงุญ</label>
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <input type="color" id="emb_successColor_picker" value="<%= config.embedSetup?.successColor || '#3ba55d' %>" class="w-14 h-12 rounded-xl bg-dark-900 border border-dark-600 p-1 cursor-pointer" onchange="document.getElementById('emb_successColor').value = this.value">
                                    <input type="text" id="emb_successColor" name="emb_successColor" value="<%= config.embedSetup?.successColor || '#3ba55d' %>" class="flex-1 bg-dark-800 border border-dark-600 rounded-xl py-3 px-3 text-white font-mono uppercase text-center" oninput="document.getElementById('emb_successColor_picker').value = this.value">
                                </div>
                            </div>
                            <div class="bg-dark-900/50 p-5 rounded-2xl border border-dark-700">
                                <label class="block text-sm font-bold text-red-400 mb-3">โ ููู ุงูุฎุทุฃ</label>
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <input type="color" id="emb_errorColor_picker" value="<%= config.embedSetup?.errorColor || '#ed4245' %>" class="w-14 h-12 rounded-xl bg-dark-900 border border-dark-600 p-1 cursor-pointer" onchange="document.getElementById('emb_errorColor').value = this.value">
                                    <input type="text" id="emb_errorColor" name="emb_errorColor" value="<%= config.embedSetup?.errorColor || '#ed4245' %>" class="flex-1 bg-dark-800 border border-dark-600 rounded-xl py-3 px-3 text-white font-mono uppercase text-center" oninput="document.getElementById('emb_errorColor_picker').value = this.value">
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-bold text-slate-300 mb-2">ูุต ุงูููุชุฑ ุงูููุญุฏ (Footer Text)</label>
                                <input type="text" name="emb_footerText" value="<%= config.embedSetup?.footerText || 'Enterprise System ยฉ' %>" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow font-bold">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุฑุงุจุท ุฃููููุฉ ุงูููุชุฑ (Footer Icon)</label>
                                <input type="text" name="emb_footerIconUrl" value="<%= config.embedSetup?.footerIconUrl || '' %>" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow text-left font-mono text-sm" dir="ltr" placeholder="https://...">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุฑุงุจุท ุงูุตูุฑุฉ ุงูุฌุงูุจูุฉ (Thumbnail)</label>
                                <input type="text" name="emb_thumbnailUrl" value="<%= config.embedSetup?.thumbnailUrl || '' %>" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow text-left font-mono text-sm" dir="ltr" placeholder="https://...">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="section-ai_system" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-amber-400 mb-6 border-b border-dark-700 pb-4">ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุชูุฏู โจ</h2>
                    
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-amber-400">
                        <div class="flex flex-col md:flex-row items-center justify-between bg-dark-900/80 p-5 rounded-2xl border border-amber-500/30 mb-8 gap-4">
                            <div>
                                <h3 class="text-xl font-bold text-white mb-1">๐ค ุชูุนูู ูุธุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุจุงููุญุงุฏุซุงุช</h3>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="ai_enabled" id="ai_enabled" <%= config.aiSystem?.enabled !== false ? 'checked' : '' %>>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="flex items-center justify-between p-5 bg-dark-800 rounded-2xl border border-dark-600 mb-8">
                            <div>
                                <h3 class="text-lg font-bold text-brand-light">ุงูุณูุงุญ ููุนุถู ุจุงุฎุชูุงุฑ ุงูุดุฎุตูุฉ (Hybrid Mode)</h3>
                                <p class="text-xs text-slate-400 mt-1">ูุณูุญ ููุนุถู ุจุงุฎุชูุงุฑ ุงูุชุญุฏุซ ูุน ุงูููุฏ ุฃู ุงูุจูุช ุนู ุทุฑูู ุงูุฃูุงูุฑ.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="ai_allowUserChoice" id="ai_allowUserChoice" <%= config.aiSystem?.allowUserChoice !== false ? 'checked' : '' %>>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div class="bg-dark-900/50 p-5 rounded-2xl border border-dark-700">
                                <h4 class="text-blue-400 font-bold mb-4">๐ฆ ุฅุนุฏุงุฏุงุช ุดุฎุตูุฉ ุงูููุฏ</h4>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุงุณู ุงูุจูุช</label>
                                <input type="text" name="ai_defaultBoyName" value="<%= config.aiSystem?.defaultBoyName || 'ุฒูุฒู' %>" class="w-full bg-dark-800 border border-dark-600 rounded-xl py-3 px-4 text-white input-glow font-bold">
                            </div>
                            
                            <div class="bg-dark-900/50 p-5 rounded-2xl border border-dark-700">
                                <h4 class="text-pink-400 font-bold mb-4">๐ง ุฅุนุฏุงุฏุงุช ุดุฎุตูุฉ ุงูุจูุช</h4>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุงุณู ุงูุจูุช</label>
                                <input type="text" name="ai_defaultGirlName" value="<%= config.aiSystem?.defaultGirlName || 'ุณูุณู' %>" class="w-full bg-dark-800 border border-dark-600 rounded-xl py-3 px-4 text-white input-glow font-bold">
                            </div>
                        </div>

                        <div class="bg-dark-900/80 p-5 rounded-2xl border border-dark-700">
                            <label class="block text-sm font-bold text-slate-300 mb-3 text-lg">ุฑูู ุงูุฏุฑุฏุดุฉ ูุน ุงูุฐูุงุก ุงูุงุตุทูุงุนู</label>
                            <select name="ai_chatChannelId" class="w-full bg-dark-800 border border-dark-600 rounded-xl py-4 px-4 text-amber-50 input-glow cursor-pointer font-bold text-lg">
                                <option value="">-- ุงุฎุชุฑ ุงูุฑูู ููุชุญุฏุซ ูููุง ุงูุฃุนุถุงุก --</option>
                                <% textChannels.forEach(ch => { %> 
                                    <option value="<%= ch.id %>" <%= config.aiSystem?.chatChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option> 
                                <% }) %>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="section-live_embed" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ุตุงูุน ุงูุฅููุจุฏ ุงูููุฑู ๐จ</h2>
                    
                    <div class="glass-card rounded-3xl p-8 border-t-4 border-t-fuchsia-500">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-6">
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-3">ุงุฎุชุฑ ุงูุฑูู ููุฅุฑุณุงู</label>
                                <select id="live_embed_channel" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3.5 px-4 text-white input-glow font-bold cursor-pointer">
                                    <option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option>
                                    <% textChannels.forEach(ch => { %>
                                        <option value="<%= ch.id %>">๐ฌ <%= ch.name %></option>
                                    <% }) %>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-3">ููู ุงูุฅููุจุฏ</label>
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <input type="color" id="live_embed_color_picker" value="#5865F2" class="w-14 h-12 rounded-xl cursor-pointer bg-dark-900 border border-dark-700 p-1" onchange="document.getElementById('live_embed_color').value = this.value">
                                    <input type="text" id="live_embed_color" value="#5865F2" class="flex-1 bg-dark-900 border border-dark-700 rounded-xl py-3.5 px-4 text-white input-glow font-mono uppercase text-center">
                                </div>
                            </div>
                        </div>

                        <label class="block text-sm font-bold text-slate-300 mb-2">ุงูุนููุงู (Title)</label>
                        <input type="text" id="live_embed_title" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow font-bold text-lg mb-6" placeholder="ุงูุชุจ ุนููุงู ุงูุฅููุจุฏ...">
                        
                        <label class="block text-sm font-bold text-slate-300 mb-2">ุงููุตู / ุงูููุงููู (ูุฏุนู ุงูุฒุฎุงุฑู)</label>
                        <textarea id="live_embed_desc" rows="6" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-4 px-5 text-white input-glow resize-y mb-6" placeholder="ุงูุชุจ ูุญุชูู ุงูุฅููุจุฏ ููุง..."></textarea>
                        
                        <label class="block text-sm font-bold text-slate-300 mb-2">ุฑุงุจุท ุตูุฑุฉ (ุงุฎุชูุงุฑู)</label>
                        <input type="text" id="live_embed_image" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white input-glow text-left font-mono mb-8" dir="ltr" placeholder="https://...">
                        
                        <div id="live_embed_status" class="hidden mb-6 px-5 py-4 rounded-xl font-bold text-center"></div>
                        
                        <button type="button" onclick="sendLiveEmbed('<%= guildId %>')" class="w-full py-4 bg-fuchsia-600 hover:bg-fuchsia-500 text-white font-black text-xl rounded-xl transition-all shadow-lg">
                            ๐ ุฅุฑุณุงู ุงูุฅููุจุฏ ููุฏูุณููุฑุฏ ุงูุขู!
                        </button>
                    </div>
                </div>

                <div id="section-middleman" class="settings-section max-w-5xl mx-auto">
                    <h2 class="text-4xl font-black text-white mb-6 border-b border-dark-700 pb-4">ูุธุงู ุงููุณุงุทุฉ ุงููุนุฒูู โ๏ธ</h2>
                    
                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-amber-500">
                        <div class="flex items-center justify-between bg-dark-900/50 p-6 rounded-2xl border border-dark-700 mb-8">
                            <div>
                                <h3 class="text-xl font-bold text-white">ุชูุนูู ูุธุงู ุงููุณุงุทุฉ</h3>
                                <p class="text-sm text-slate-400 mt-1">ูุนุชูุฏ ุนูู ุงูุชูููู ุจุฃูุฑ !done ุจุดูู ูููุตู.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="mm_enabled" <%= config.middlemanSystem?.enabled ? 'checked' : '' %>>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ูุณู ุงูุชุฐุงูุฑ (Category)</label>
                                <select name="mm_categoryId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3.5 px-4 text-white font-bold">
                                    <option value="">-- ุงุฎุชุฑ ุงููุณู --</option>
                                    <% categories.forEach(cat => { %> 
                                        <option value="<%= cat.id %>" <%= config.middlemanSystem?.categoryId === cat.id ? 'selected' : '' %>>๐ <%= cat.name %></option> 
                                    <% }) %>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุฑูู ุฅุฑุณุงู ุงูุจุงูู ุงูุฎุงุฑุฌู</label>
                                <select name="mm_panelChannelId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3.5 px-4 text-white font-bold">
                                    <option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option>
                                    <% textChannels.forEach(ch => { %> 
                                        <option value="<%= ch.id %>" <%= config.middlemanSystem?.panelChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option> 
                                    <% }) %>
                                </select>
                            </div>
                        </div>

                        <h3 class="text-xl font-bold text-white mb-4">๐ผ๏ธ ุชุตููู ุงูุจุงูู ุงูุฎุงุฑุฌู</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุนููุงู ุงูุฅููุจุฏ ุงูุฎุงุฑุฌู</label>
                                <input type="text" name="mm_panelTitle" value="<%= config.middlemanSystem?.panelTitle || 'ุชุฐูุฑุฉ ูุณุงุทุฉ ุขููุฉ' %>" class="w-full bg-dark-900 rounded-xl py-3 px-4 text-white font-bold">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ููู ุงูุฅููุจุฏ ุงูุฎุงุฑุฌู</label>
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <input type="color" id="mm_panelColor_picker" value="<%= config.middlemanSystem?.panelColor || '#f2a658' %>" class="w-14 h-12 rounded-xl bg-dark-900 p-1 cursor-pointer" onchange="document.getElementById('mm_panelColor').value = this.value">
                                    <input type="text" id="mm_panelColor" name="mm_panelColor" value="<%= config.middlemanSystem?.panelColor || '#f2a658' %>" class="flex-1 bg-dark-900 rounded-xl py-3 px-4 text-white font-mono uppercase text-center">
                                </div>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-bold text-slate-300 mb-2">ูุตู ุงูุฅููุจุฏ ุงูุฎุงุฑุฌู</label>
                                <textarea name="mm_panelDescription" rows="2" class="w-full bg-dark-900 rounded-xl py-3 px-4 text-white resize-y"><%= config.middlemanSystem?.panelDescription || 'ูุทูุจ ูุณูุท ูุนุชูุฏุ ูุฑุฌู ูุชุญ ุชุฐูุฑุฉ ูู ููุง.' %></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุงุณู ุงูุฒุฑ (Button Label)</label>
                                <input type="text" name="mm_buttonLabel" value="<%= config.middlemanSystem?.buttonLabel || 'ุทูุจ ูุณูุท ๐ก๏ธ' %>" class="w-full bg-dark-900 rounded-xl py-3 px-4 text-white font-bold">
                            </div>
                        </div>
                        
                        <h3 class="text-xl font-bold text-white mb-4">๐ ุงููุงูุฐุฉ (Modal) ูุงูุฅููุจุฏ ุงูุฏุงุฎูู</h3>
                        <label class="block text-sm font-bold text-slate-300 mb-2">ุนููุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ</label>
                        <input type="text" name="mm_modalTitle" value="<%= config.middlemanSystem?.modalTitle || 'ุจูุงูุงุช ุงููุณุงุทุฉ' %>" class="w-full bg-dark-900 rounded-xl py-3 px-4 text-white font-bold mb-6">
                        
                        <div class="bg-dark-900/50 p-6 rounded-2xl border border-dark-700 mb-6">
                            <h4 class="text-lg font-bold text-brand-light mb-4">ุฃุณุฆูุฉ ุงููุงูุฐุฉ</h4>
                            <input type="hidden" name="mm_modalFieldsData" id="mm_modalFieldsData" value="<%= JSON.stringify(config.middlemanSystem?.modalFields || []) %>">
                            <div id="mm-fields-ui-container" class="space-y-4 mb-6">
                                </div>
                            <button type="button" onclick="addMmFieldUI()" class="w-full py-4 bg-emerald-600/20 text-emerald-400 font-bold rounded-xl border border-dashed border-emerald-500">
                                โ ุฅุถุงูุฉ ุณุคุงู ูููุงูุฐุฉ
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุนููุงู ุงูุฅููุจุฏ ุงูุฏุงุฎูู ููุชุฐูุฑุฉ</label>
                                <input type="text" name="mm_insideTicketTitle" value="<%= config.middlemanSystem?.insideTicketTitle || 'ุชุฐูุฑุฉ ุงููุณุงุทุฉ' %>" class="w-full bg-dark-900 rounded-xl py-3 px-4 text-white font-bold">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ููู ุงูุฅููุจุฏ ุงูุฏุงุฎูู ููุชุฐูุฑุฉ</label>
                                <input type="color" name="mm_insideTicketColor" value="<%= config.middlemanSystem?.insideTicketColor || '#f2a658' %>" class="w-full h-12 bg-dark-900 rounded-xl p-1 cursor-pointer">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-bold text-slate-300 mb-2">ูุตู ุงูุฅููุจุฏ ุงูุฏุงุฎูู (ูุฏุนู {user})</label>
                                <textarea name="mm_insideTicketDescription" rows="2" class="w-full bg-dark-900 rounded-xl py-3 px-4 text-white resize-y"><%= config.middlemanSystem?.insideTicketDescription || 'ุฃููุงู ุจู {user}ุ ูุฑุฌู ุงูุชุธุงุฑ ุงููุณูุท.' %></textarea>
                            </div>
                            <div class="md:col-span-2 bg-dark-800 p-4 rounded-xl border border-dark-600">
                                <label class="block text-sm font-bold text-amber-400 mb-2">๐จ ููู ุฅููุจุฏ ุฅุฌุงุจุงุช ุงููุงูุฐุฉ ุงููุฎุตุต (Code Blocks)</label>
                                <input type="color" name="mm_modalAnswersEmbedColor" value="<%= config.middlemanSystem?.modalAnswersEmbedColor || '#f2a658' %>" class="w-full h-10 bg-dark-900 rounded p-1 cursor-pointer">
                                <p class="text-xs text-slate-400 mt-2">ุงูุฅููุจุฏ ุงูุฐู ุณุชุธูุฑ ุจุฏุงุฎูู ุงููุฑุจุนุงุช ุงูุฎุงุตุฉ ุจุฅุฌุงุจุงุช ุงูุนุถู.</p>
                            </div>
                        </div>
                    </div>
                </div>

<div id="section-ticket_controls" class="settings-section max-w-5xl mx-auto">
                    <div class="mb-8 border-b border-dark-700 pb-4">
                        <h2 class="text-4xl font-black text-white mb-2">ุงูุชุญูู ุงูุฏุงุฎูู ููุชูุช ๐๏ธ</h2>
                        <p class="text-slate-400">ุงูุชุฑุงูุณูุฑูุจุชุ ุฃุฒุฑุงุฑ ุงูุงุณุชูุงูุ ููุธุงู ุฅุบูุงู ุงูุชุฐุงูุฑ ุงููุฒุฏูุฌ.</p>
                    </div>

                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-indigo-500">
                        
                        <div class="flex flex-col md:flex-row items-center justify-between p-6 bg-dark-900/80 rounded-2xl border border-indigo-500/30 mb-8 shadow-inner gap-4">
                            <div>
                                <h3 class="text-xl font-bold text-white mb-1">๐ ุงูุฅุบูุงู ุจุฎุทูุชูู (Two-Step Close)</h3>
                                <p class="text-sm text-slate-400">ุนูุฏ ุงูุถุบุท ุนูู Closeุ ูุง ุชูุญุฐู ุงูุชุฐูุฑุฉ ููุฑุงูุ ุจู ุชุธูุฑ ุฃุฒุฑุงุฑ (Reopen / Delete / Delete With Reason) ููุฅุฏุงุฑู.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="tc_twoStepClose" id="tc_twoStepClose" <%= config.ticketControls?.twoStepClose !== false ? 'checked' : '' %>>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div class="bg-dark-900/50 p-6 rounded-2xl border border-dark-700 relative overflow-hidden">
                                <div class="absolute top-0 right-0 bg-brand text-[12px] font-bold px-3 py-1 rounded-bl-xl text-white">Counter</div>
                                <label class="block text-sm font-bold text-white mb-3">ุฑูู ุงูุชูุช ุงููุงุฏู (ูุฅููุงู ุงูุนุฏ ุงููุฏูู)</label>
                                <input type="number" name="tc_ticketCounter" value="<%= config.ticketControls?.ticketCounter || 1 %>" min="1" class="w-full bg-dark-800 border border-dark-600 rounded-xl py-4 px-4 text-brand-light font-mono text-3xl text-center font-black outline-none focus:border-brand">
                            </div>

                            <div class="bg-dark-900/50 p-6 rounded-2xl border border-dark-700">
                                <label class="block text-sm font-bold text-white mb-3">ุฑูู ุญูุธ ุงูุชุฑุงูุณูุฑูุจุช (ุฑุณุงุฆู ุงูุชุฐูุฑุฉ)</label>
                                <select name="tc_transcriptChannelId" class="w-full bg-dark-800 border border-dark-600 rounded-xl py-4 px-4 text-white input-glow cursor-pointer font-bold">
                                    <option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option>
                                    <% textChannels.forEach(ch => { %> 
                                        <option value="<%= ch.id %>" <%= config.ticketControls?.transcriptChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option> 
                                    <% }) %>
                                </select>
                            </div>

                            <div class="md:col-span-2 bg-dark-900/50 p-6 rounded-2xl border border-blue-500/30">
                                <label class="block text-sm font-bold text-blue-400 mb-3">๐ ุฑูู ููุฌ ุงูุชุฐุงูุฑ (ูุชุญุ ุฅุบูุงูุ ุงุณุชูุงู Claim)</label>
                                <select name="tc_ticketLogChannelId" class="w-full bg-dark-800 border border-dark-600 rounded-xl py-4 px-4 text-white input-glow cursor-pointer font-bold mb-4">
                                    <option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option>
                                    <% textChannels.forEach(ch => { %> 
                                        <option value="<%= ch.id %>" <%= config.ticketControls?.ticketLogChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option> 
                                    <% }) %>
                                </select>
                                <p class="text-xs text-slate-400">ุณูุชู ุฅุฑุณุงู ุณุฌูุงุช ููุตูุฉ ููู ุชุฐูุฑุฉ (ูู ูุงู ุจูุชุญูุงุ ุฅุบูุงููุงุ ุฃู ุงุณุชูุงููุง) ุฅูู ูุฐุง ุงูุฑูู.</p>
                            </div>
                        </div>

                        <h3 class="text-2xl font-bold text-amber-400 mb-6">๐ต๏ธ ุฅุนุฏุงุฏุงุช ุฒุฑ ุงูุงุณุชูุงู (Claim Settings)</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-5 bg-dark-900/50 rounded-2xl border border-dark-700 transition-all" id="hide_claim_container">
                                <div>
                                    <h3 class="text-lg font-bold text-white">ุฅุฎูุงุก ุงูุชุฐูุฑุฉ ุนูุฏ ุงูุงุณุชูุงู</h3>
                                    <p class="text-xs text-slate-400 mt-1">ูุฎูู ุงูุชูุช ุนู ุจุงูู ุทุงูู ุงูุฅุฏุงุฑุฉ ุจูุฌุฑุฏ ุถุบุท ุงูุฅุฏุงุฑู ุนูู Claim.</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" name="tc_hideTicketOnClaim" id="tc_hideTicketOnClaim" <%= config.ticketControls?.hideTicketOnClaim ? 'checked' : '' %>>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between p-5 bg-dark-900/50 rounded-2xl border border-dark-700 transition-all" id="read_claim_container">
                                <div>
                                    <h3 class="text-lg font-bold text-white">ููุน ุงูุฅุฏุงุฑููู ุงูุขุฎุฑูู ูู ุงููุชุงุจุฉ (Read-Only)</h3>
                                    <p class="text-xs text-slate-400 mt-1">ูุณูุญ ููุฅุฏุงุฑุฉ ุจุฑุคูุฉ ุงูุชูุช ูููู ูููุนูู ูู ุงููุชุงุจุฉ ููู ุจุนุฏ ุงูุงุณุชูุงู.</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" name="tc_readOnlyStaffOnClaim" id="tc_readOnlyStaffOnClaim" <%= config.ticketControls?.readOnlyStaffOnClaim ? 'checked' : '' %>>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="section-welcome" class="settings-section max-w-5xl mx-auto">
                    <div class="mb-8 border-b border-dark-700 pb-4">
                        <h2 class="text-4xl font-black text-white mb-2">ุงูุชุฑุญูุจ ูุงููุบุงุฏุฑุฉ ๐</h2>
                        <p class="text-slate-400">ุชุญูู ูุงูู ูู ุฑุณุงุฆู ุงูุชุฑุญูุจ ูุน ุฏุนู ุงููุชุบูุฑุงุช ุงูุฌุงูุฒุฉ.</p>
                    </div>

                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-pink-500">
                        <div class="flex justify-between items-center mb-8 bg-dark-900/50 p-6 rounded-2xl border border-dark-700">
                            <div>
                                <span class="font-bold text-2xl text-white block mb-1">ุชูุนูู ูุธุงู ุงูุชุฑุญูุจ</span>
                                <span class="text-sm text-slate-400">ูุฑุณู ุฑุณุงูุฉ ูุตูุฑุฉ ูุฎุตุตุฉ ุนูุฏ ุฏุฎูู ุฃู ุนุถู ุฌุฏูุฏ.</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="wel_enabled" <%= config.welcomeSystem?.enabled ? 'checked' : '' %>>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุฑูู ุฅุฑุณุงู ุงูุชุฑุญูุจ</label>
                                <select name="wel_channelId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-4 px-4 text-white font-bold cursor-pointer">
                                    <option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option>
                                    <% textChannels.forEach(ch => { %>
                                        <option value="<%= ch.id %>" <%= config.welcomeSystem?.channelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option>
                                    <% }) %>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-2">ุฑุงุจุท ุตูุฑุฉ ุงูุฎูููุฉ (Background URL)</label>
                                <input type="text" name="wel_backgroundUrl" value="<%= config.welcomeSystem?.backgroundUrl || '' %>" placeholder="https://..." dir="ltr" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-4 px-4 text-white text-left font-mono">
                            </div>
                        </div>

                        <div class="bg-dark-900/80 p-6 rounded-2xl border border-dark-700 mb-8 shadow-inner">
                            <label class="block text-xl font-bold text-brand-light mb-3">๐ ูุต ุฑุณุงูุฉ ุงูุชุฑุญูุจ ุงููุฎุตุตุฉ</label>
                            <p class="text-sm text-slate-400 mb-4 leading-relaxed">
                                ุงููุชุบูุฑุงุช ุงููุชุงุญุฉ ููุงุณุชุฎุฏุงู:<br>
                                <code class="text-amber-400 bg-dark-800 px-2 py-1 rounded inline-block mt-2 mr-1">{user}</code> ูููุดู ุงูุนุถู.<br>
                                <code class="text-amber-400 bg-dark-800 px-2 py-1 rounded inline-block mt-2 mr-1">{server}</code> ูุงุณู ุงูุณูุฑูุฑ.<br>
                                <code class="text-amber-400 bg-dark-800 px-2 py-1 rounded inline-block mt-2 mr-1">{memberCount}</code> ูุฑูู ุงูุนุถู (ุชุฑุชูุจ ุฏุฎููู).
                            </p>
                            <textarea name="wel_messageText" rows="5" class="w-full bg-dark-800 border border-dark-600 rounded-xl py-4 px-5 text-white font-bold resize-y text-lg" placeholder="ูุฑุญุจุงู ุจู {user} ูู ุณูุฑูุฑ {server}. ุฃูุช ุงูุนุถู ุฑูู {memberCount} !"><%= config.welcomeSystem?.messageText || 'ูุฑุญุจุงู ุจู {user} ูู ุณูุฑูุฑ {server}. ุฃูุช ุงูุนุถู ุฑูู {memberCount} !' %></textarea>
                        </div>

                        <div class="flex items-center justify-between bg-dark-900/30 p-6 rounded-xl border border-dark-700">
                            <div class="w-1/2 pr-2">
                                <label class="text-sm font-bold text-slate-400 block mb-3">ููู ุฅุทุงุฑ ุงูุตูุฑุฉ (Avatar Border):</label>
                                <input type="color" name="wel_avatarBorderHex" value="<%= config.welcomeSystem?.avatarBorderHex || '#ffffff' %>" class="w-full h-12 rounded-xl bg-dark-900 p-1 cursor-pointer border border-dark-600">
                            </div>
                            <div class="w-1/2 pl-2">
                                <label class="text-sm font-bold text-slate-400 block mb-3">ููู ุงููุต ุฏุงุฎู ุงูุตูุฑุฉ:</label>
                                <input type="color" name="wel_textColorHex" value="<%= config.welcomeSystem?.textColorHex || '#ffffff' %>" class="w-full h-12 rounded-xl bg-dark-900 p-1 cursor-pointer border border-dark-600">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="section-leveling" class="settings-section max-w-5xl mx-auto">
                    <div class="mb-8 border-b border-dark-700 pb-4">
                        <h2 class="text-4xl font-black text-white mb-2">ูุธุงู ุงููููุงุช (Leveling) ๐</h2>
                        <p class="text-slate-400">ุฅุนุฏุงุฏุงุช ูุณุชูู ุงูุฃุนุถุงุกุ ุฑุณุงุฆู ุงูุชููููุ ูุงูุฌูุงุฆุฒ ุงูุชููุงุฆูุฉ (ุงูุฑุชุจ).</p>
                    </div>

                    <div class="glass-card rounded-3xl p-8 mb-8 border-t-4 border-t-blue-400">
                        <div class="flex items-center justify-between bg-dark-900/50 p-6 rounded-2xl border border-dark-700 mb-8">
                            <div>
                                <h3 class="text-xl font-bold text-white mb-1">ุชูุนูู ูุธุงู ุงูุชูููู</h3>
                                <p class="text-sm text-slate-400">ููุชุณุจ ุงูุฃุนุถุงุก ุฎุจุฑุฉ (XP) ุนูุฏ ุงูุชุญุฏุซ ูู ุงูุณูุฑูุฑ.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="lvl_enabled" id="lvl_enabled" <%= config.leveling?.enabled !== false ? 'checked' : '' %>>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-3">ุฑูู ุฅุฑุณุงู ุฑุณุงุฆู ุงูุชูููู</label>
                                <select name="lvl_levelUpChannelId" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-4 px-4 text-white font-bold cursor-pointer">
                                    <option value="">-- ููุณ ุงูุฑูู ุงูุชู ูุชุญุฏุซ ุจูุง ุงูุนุถู --</option>
                                    <% textChannels.forEach(ch => { %>
                                        <option value="<%= ch.id %>" <%= config.leveling?.levelUpChannelId === ch.id ? 'selected' : '' %>>๐ฌ <%= ch.name %></option>
                                    <% }) %>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-300 mb-3">ุฑุณุงูุฉ ุงูุชูููู (ูุฏุนู ุงููุชุบูุฑุงุช)</label>
                                <textarea name="lvl_levelUpMessage" rows="2" class="w-full bg-dark-900 border border-dark-700 rounded-xl py-3 px-4 text-white resize-y font-bold" placeholder="ูุจุฑูู {user} ูุตูุช ูููู {level}!"><%= config.leveling?.levelUpMessage || '๐ ูุจุฑูู {user}ุ ููุฏ ูุตูุช ุฅูู ุงููุณุชูู **{level}**!' %></textarea>
                            </div>
                        </div>

                        <div class="bg-dark-900/80 p-8 rounded-2xl border border-blue-500/30 shadow-inner">
                            <div class="flex justify-between items-center mb-6 border-b border-dark-700 pb-4">
                                <div>
                                    <h3 class="text-2xl font-bold text-brand-light">๐๏ธ ุฌูุงุฆุฒ ุงูุฑุชุจ (Role Rewards)</h3>
                                    <p class="text-xs text-slate-400 mt-2">ุณูุญุตู ุงูุนุถู ุนูู ุงูุฑุชุจุฉ ุงููุญุฏุฏุฉ ุชููุงุฆูุงู ุนูุฏ ูุตููู ูููุณุชูู ุงููุทููุจ.</p>
                                </div>
                                <button type="button" onclick="addLevelRewardUI()" class="px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-black text-sm rounded-xl transition-all shadow-lg">
                                    โ ุฅุถุงูุฉ ุฌุงุฆุฒุฉ ุฑุชุจุฉ
                                </button>
                            </div>
                            
                            <input type="hidden" name="lvl_roleRewardsData" id="lvl_roleRewardsData" value="<%= JSON.stringify(config.leveling?.roleRewards || []) %>">
                            <div id="level-rewards-container" class="space-y-4">
                                </div>
                        </div>
                    </div>
                </div>

                </form>
        </div>
    </main>

    <script>
        // -----------------------------------------------------------
        // ูุธุงู ุงูุชููู ุจูู ุงูุฃูุณุงู
        // -----------------------------------------------------------
        function switchSection(target) {
            document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + target).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(b => { 
                b.classList.remove('bg-brand','text-white'); 
                b.classList.add('text-slate-400'); 
            });
            
            const activeBtn = document.querySelector(`[data-target="${target}"]`);
            if(activeBtn) { 
                activeBtn.classList.add('bg-brand','text-white'); 
                activeBtn.classList.remove('text-slate-400'); 
            }
        }

        // -----------------------------------------------------------
        // ุฐูุงุก ุฒุฑุงูุฑ ุงูุชูุช (ููุน ุชุนุงุฑุถ ุงูุฅุฎูุงุก ูุน ุงููุฑุงุกุฉ ููุท)
        // -----------------------------------------------------------
        const hideBtn = document.getElementById('tc_hideTicketOnClaim');
        const readBtn = document.getElementById('tc_readOnlyStaffOnClaim');
        
        if (hideBtn && readBtn) {
            function syncTicketToggles() {
                if (hideBtn.checked) { 
                    readBtn.checked = false; 
                    document.getElementById('read_claim_container').style.opacity = '0.4'; 
                    readBtn.disabled = true; 
                } else { 
                    document.getElementById('read_claim_container').style.opacity = '1'; 
                    readBtn.disabled = false; 
                }
                
                if (readBtn.checked) { 
                    hideBtn.checked = false; 
                    document.getElementById('hide_claim_container').style.opacity = '0.4'; 
                    hideBtn.disabled = true; 
                } else if (!readBtn.checked && !hideBtn.checked) { 
                    document.getElementById('hide_claim_container').style.opacity = '1'; 
                    hideBtn.disabled = false; 
                }
            }
            hideBtn.addEventListener('change', syncTicketToggles);
            readBtn.addEventListener('change', syncTicketToggles);
            syncTicketToggles(); // ุชุดุบูู ุฃููู
        }

        // -----------------------------------------------------------
        // ุงูุจูุงูุงุช ุงููุฎููุฉ ูููุญุฑูุงุช ุงูุฏููุงููููุฉ
        // -----------------------------------------------------------
        let panelsArray = JSON.parse(document.getElementById('ticketPanelsData').value || '[]');
        let mmFields = JSON.parse(document.getElementById('mm_modalFieldsData').value || '[]');
        let roleRewards = JSON.parse(document.getElementById('lvl_roleRewardsData').value || '[]');
        
        let warnAr = <%- JSON.stringify(config.warnings?.presetReasonsAr || ['ุณุจ ูุดุชู', 'ูุดุฑ ุฑูุงุจุท']) %>;
        let warnEn = <%- JSON.stringify(config.warnings?.presetReasonsEn || ['Swearing', 'Posting Links']) %>;

        // -----------------------------------------------------------
        // ูุญุฑู ุฌูุงุฆุฒ ุงููููุงุช
        // -----------------------------------------------------------
        const sRolesHTML = `<%- serverRoles.map(r=>`<option value="${r.id}">${r.name}</option>`).join('') %>`;
        
        function renderLvlRewards() {
            const container = document.getElementById('level-rewards-container'); 
            container.innerHTML = '';
            
            if(roleRewards.length === 0){ 
                container.innerHTML = '<div class="text-center text-slate-500 text-sm p-6 border-2 border-dashed border-dark-600 rounded-xl font-bold">ูุง ุชูุฌุฏ ุฌูุงุฆุฒ ุญุงููุงู. ุงุถุบุท ุนูู ุงูุฒุฑ ูุฅุถุงูุฉ ุฌุงุฆุฒุฉ.</div>'; 
                return; 
            }
            
            roleRewards.forEach((r, i) => {
                container.innerHTML += `
                    <div class="flex flex-col md:flex-row items-center space-x-0 md:space-x-4 md:space-x-reverse space-y-4 md:space-y-0 bg-dark-800 p-5 rounded-xl border border-dark-600 mb-2 shadow-sm">
                        <div class="flex items-center w-full md:w-auto">
                            <span class="text-brand-light font-bold text-sm w-32">ุนูุฏ ุงููุตูู ูู ููู:</span>
                            <input type="number" class="w-24 bg-dark-900 border border-dark-600 rounded-lg py-3 px-3 text-white font-black text-center text-lg" value="${r.levelRequired}" onchange="roleRewards[${i}].levelRequired=parseInt(this.value)">
                        </div>
                        <div class="flex items-center w-full md:flex-1">
                            <span class="text-slate-400 font-bold text-sm w-24">ูุฃุฎุฐ ุฑุชุจุฉ:</span>
                            <select class="flex-1 bg-dark-900 border border-dark-600 rounded-lg py-3 px-4 text-white font-bold" onchange="roleRewards[${i}].roleId=this.value">
                                <option value="">-- ุงุฎุชุฑ ุงูุฑุชุจุฉ --</option>
                                ${sRolesHTML.replace(`value="${r.roleId}"`, `value="${r.roleId}" selected`)}
                            </select>
                        </div>
                        <button type="button" onclick="roleRewards.splice(${i},1); renderLvlRewards();" class="w-full md:w-auto bg-red-500/20 text-red-500 px-6 py-3 rounded-lg font-bold hover:bg-red-500 hover:text-white transition-all">ุญุฐู ๐๏ธ</button>
                    </div>
                `;
            });
        }
        function addLevelRewardUI() { roleRewards.push({levelRequired: 5, roleId: ''}); renderLvlRewards(); }

        // -----------------------------------------------------------
        // ูุญุฑู ุงูุจุงููุงุช ุงููุชุนุฏุฏุฉ ุงูุนููุงู (ูุนุงูุฌุฉ ูุดููุฉ ุงูุนูุงููู)
        // -----------------------------------------------------------
        const catsHTML = `<%- categories.map(cat=>`<option value="${cat.id}">${cat.name}</option>`).join('') %>`;
        const chsHTML = `<%- textChannels.map(ch=>`<option value="${ch.id}">${ch.name}</option>`).join('') %>`;
        
        function renderAllPanels() {
            const container = document.getElementById('dynamic-panels-container'); 
            container.innerHTML = '';
            
            if(panelsArray.length === 0) { 
                container.innerHTML = `<div class="text-center p-12 bg-dark-900/50 rounded-2xl border-2 border-dashed border-dark-700 text-slate-500 font-bold text-lg">ูุง ุชูุฌุฏ ุจุงููุงุช ุชุฐุงูุฑ ุญุงููุงู. ุงุจุฏุฃ ุจุฅุถุงูุฉ ุจุงูู ุฌุฏูุฏ.</div>`; 
                return; 
            }

            panelsArray.forEach((panel, pIdx) => {
                let buttonsHTML = '';
                
                (panel.buttons || []).forEach((btn, bIdx) => {
                    let modalHTML = '';
                    if(btn.requireModal) {
                        modalHTML += `
                            <div class="mt-6 p-5 bg-dark-900/80 rounded-xl border border-dark-700 shadow-inner">
                                <div class="flex justify-between items-center mb-4 border-b border-dark-600 pb-2">
                                    <span class="text-sm font-bold text-brand-light">๐ ุฃุณุฆูุฉ ุงููุงูุฐุฉ (ุงูุฅุฌุงุจุงุช ุณุชุนุฑุถ ูู Code Blocks)</span>
                                    <button type="button" onclick="if(!panelsArray[${pIdx}].buttons[${bIdx}].modalFields) panelsArray[${pIdx}].buttons[${bIdx}].modalFields=[]; panelsArray[${pIdx}].buttons[${bIdx}].modalFields.push({label:'',placeholder:'',style:'Short'}); renderAllPanels();" class="text-xs bg-brand hover:bg-brand-light text-white px-4 py-2 rounded-lg font-bold transition-all">โ ุฅุถุงูุฉ ุณุคุงู</button>
                                </div>
                        `;
                        
                        (btn.modalFields || []).forEach((mf, mIdx) => {
                            modalHTML += `
                                <div class="flex flex-col md:flex-row md:space-x-3 md:space-x-reverse space-y-3 md:space-y-0 mb-3 bg-dark-800 p-3 rounded-lg border border-dark-600">
                                    <input type="text" class="w-full md:w-1/3 bg-dark-900 border border-dark-700 text-sm text-white rounded-lg p-2.5 font-bold" placeholder="ุงูุณุคุงู" value="${mf.label}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].modalFields[${mIdx}].label=this.value">
                                    <input type="text" class="w-full md:flex-1 bg-dark-900 border border-dark-700 text-sm text-white rounded-lg p-2.5" placeholder="ูุซุงู ูุฅุฑุดุงุฏ ุงูุนููู" value="${mf.placeholder}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].modalFields[${mIdx}].placeholder=this.value">
                                    <select class="w-full md:w-auto bg-dark-900 border border-dark-700 text-sm text-white font-bold rounded-lg p-2.5" onchange="panelsArray[${pIdx}].buttons[${bIdx}].modalFields[${mIdx}].style=this.value">
                                        <option value="Short" ${mf.style!=='Paragraph'?'selected':''}>ุฅุฌุงุจุฉ ูุตูุฑุฉ</option>
                                        <option value="Paragraph" ${mf.style==='Paragraph'?'selected':''}>ุฅุฌุงุจุฉ ุทูููุฉ</option>
                                    </select>
                                    <button type="button" onclick="panelsArray[${pIdx}].buttons[${bIdx}].modalFields.splice(${mIdx},1); renderAllPanels();" class="w-full md:w-auto bg-red-500 hover:bg-red-600 text-white px-4 rounded-lg font-bold transition-all">ุญุฐู</button>
                                </div>
                            `;
                        });
                        modalHTML += `</div>`;
                    }

                    buttonsHTML += `
                        <div class="bg-dark-800 p-6 rounded-2xl border border-dark-600 mb-6 relative shadow-lg">
                            <button type="button" onclick="panelsArray[${pIdx}].buttons.splice(${bIdx},1); renderAllPanels();" class="absolute top-4 left-4 text-red-400 bg-red-500/10 hover:bg-red-500 hover:text-white px-4 py-2 rounded-lg text-xs font-bold transition-all">ุญุฐู ุงูุฒุฑ ๐๏ธ</button>
                            <h5 class="text-lg font-black text-white mb-6 border-b border-dark-700 pb-3">๐ ุฅุนุฏุงุฏุงุช ุงูุฒุฑ ุฑูู ${bIdx + 1}</h5>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label class="text-[12px] font-bold text-slate-400 block mb-2">ุงุณู ุงูุฒุฑ (ุงูุฐู ุณูุธูุฑ ููุนููู)</label>
                                    <input type="text" class="w-full bg-dark-900 border border-dark-700 text-base text-white font-bold rounded-xl p-3" value="${btn.label}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].label=this.value">
                                </div>
                                <div>
                                    <label class="text-[12px] font-bold text-slate-400 block mb-2">ููู ุงูุฒุฑ (Discord Style)</label>
                                    <select class="w-full bg-dark-900 border border-dark-700 text-base font-bold text-white rounded-xl p-3" onchange="panelsArray[${pIdx}].buttons[${bIdx}].buttonStyle=this.value">
                                        <option value="Primary" ${btn.buttonStyle==='Primary'?'selected':''}>ุฃุฒุฑู (Primary)</option>
                                        <option value="Success" ${btn.buttonStyle==='Success'?'selected':''}>ุฃุฎุถุฑ (Success)</option>
                                        <option value="Danger" ${btn.buttonStyle==='Danger'?'selected':''}>ุฃุญูุฑ (Danger)</option>
                                        <option value="Secondary" ${btn.buttonStyle==='Secondary'?'selected':''}>ุฑูุงุฏู (Secondary)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap space-x-6 space-x-reverse text-sm font-bold bg-dark-900/50 p-4 rounded-xl border border-dark-700 mb-6 gap-y-4">
                                <label class="text-amber-400 flex items-center cursor-pointer ml-6">
                                    <input type="checkbox" ${btn.isMiddleman?'checked':''} onchange="panelsArray[${pIdx}].buttons[${bIdx}].isMiddleman=this.checked" class="mr-2 ml-2 w-5 h-5 accent-amber-400"> 
                                    ๐ค ุฒุฑ ูุฎุตุต ูููุณุงุทุฉ (Middleman)
                                </label>
                                <label class="text-emerald-400 flex items-center cursor-pointer">
                                    <input type="checkbox" ${btn.requireModal?'checked':''} onchange="panelsArray[${pIdx}].buttons[${bIdx}].requireModal=this.checked; if(this.checked && !panelsArray[${pIdx}].buttons[${bIdx}].modalFields) panelsArray[${pIdx}].buttons[${bIdx}].modalFields=[]; renderAllPanels();" class="mr-2 ml-2 w-5 h-5 accent-emerald-400"> 
                                    ๐ ุชูุนูู ูุงูุฐุฉ ููุจุซูุฉ (Modal)
                                </label>
                            </div>
                            
                            <h6 class="text-sm font-bold text-brand-light mb-4 mt-6 border-t border-dark-700 pt-5">๐จ ุฅููุจุฏ ุงูุชุฐูุฑุฉ ุงูุฏุงุฎูู ููุฒุฑ:</h6>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="text-[11px] font-bold text-slate-400 block mb-2">ุนููุงู ุงูุฅููุจุฏ ุงูุฏุงุฎูู (Title)</label>
                                    <input type="text" class="w-full bg-dark-900 border border-dark-700 text-sm text-white rounded-lg p-3 font-bold" placeholder="ูุซุงู: ุชุฐูุฑุฉ ุงูุฏุนู ุงูููู" value="${btn.insideEmbedTitle || 'ุชุฐูุฑุฉ ุฌุฏูุฏุฉ'}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].insideEmbedTitle=this.value">
                                </div>
                                <div>
                                    <label class="text-[11px] font-bold text-slate-400 block mb-2">ูุตู ุงูุฅููุจุฏ ุงูุฏุงุฎูู (Description)</label>
                                    <input type="text" class="w-full bg-dark-900 border border-dark-700 text-sm text-white rounded-lg p-3" placeholder="ุฃููุงู ุจู ูู ุงูุชุฐูุฑุฉุ ูุฑุฌู ุงูุงูุชุธุงุฑ..." value="${btn.insideEmbedDesc || ''}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].insideEmbedDesc=this.value">
                                </div>
                                <div class="md:col-span-2 bg-dark-900/30 p-4 rounded-xl border border-dark-700">
                                    <label class="text-[12px] font-black text-amber-400 block mb-2">๐จ ููู ุฅููุจุฏ ุฅุฌุงุจุงุช ุงููุงูุฐุฉ ุงููุฎุตุต (ุงููุฑุจุนุงุช - Code Blocks)</label>
                                    <div class="flex items-center space-x-4 space-x-reverse">
                                        <input type="color" class="w-14 h-12 bg-dark-900 rounded-lg p-1 cursor-pointer border border-dark-600 shadow-inner" value="${btn.modalAnswersEmbedColor || '#2b2d31'}" onchange="panelsArray[${pIdx}].buttons[${bIdx}].modalAnswersEmbedColor=this.value">
                                        <input type="text" class="flex-1 bg-dark-900 text-sm font-mono uppercase text-center rounded-lg border border-dark-600 py-3" value="${btn.modalAnswersEmbedColor || '#2b2d31'}" readonly>
                                    </div>
                                    <p class="text-[10px] text-slate-500 mt-2">ุงูุฅููุจุฏ ุงูุฐู ููุนุฑุถ ุจุฏุงุฎูู ุฅุฌุงุจุงุช ุงูุนููู ุจุดูู ูููุตู ุฏุงุฎู ุงูุชุฐูุฑุฉ.</p>
                                </div>
                            </div>
                            
                            ${modalHTML}
                        </div>
                    `;
                });

                container.innerHTML += `
                    <div class="bg-dark-900/80 border-2 border-blue-500/30 rounded-[2rem] p-8 relative shadow-2xl mb-10">
                        <button type="button" onclick="panelsArray.splice(${pIdx},1); renderAllPanels();" class="absolute top-6 left-6 bg-red-600 hover:bg-red-500 text-white px-5 py-3 rounded-xl text-sm font-black shadow-lg transition-all transform hover:scale-105">ุญุฐู ุงูุจุงูู ุจุงููุงูู ๐๏ธ</button>
                        
                        <div class="flex items-center space-x-5 space-x-reverse mb-8 border-b border-dark-700 pb-6">
                            <input type="color" class="w-16 h-16 rounded-2xl bg-dark-800 p-1.5 cursor-pointer border-2 border-dark-600 shadow-inner" value="${panel.panelColor || '#5865F2'}" onchange="panelsArray[${pIdx}].panelColor=this.value" title="ููู ุงูุจุงูู ุงูุฎุงุฑุฌู">
                            <div class="flex-1">
                                <label class="text-[11px] font-bold text-slate-500 block mb-1">ุนููุงู ุงูุจุงูู ุงูุฎุงุฑุฌู (ุงูุฐู ุณูุธูุฑ ูู ุงูุฑูู)</label>
                                <input type="text" class="bg-transparent text-3xl font-black text-white focus:border-b-2 focus:border-brand outline-none w-full md:w-3/4 pb-1 transition-all" placeholder="ูุซุงู: ุจุงูู ุงูุฏุนู ุงูููู" value="${panel.panelTitle || ''}" onchange="panelsArray[${pIdx}].panelTitle=this.value">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div class="bg-dark-800 p-5 rounded-2xl border border-dark-600 shadow-inner">
                                <label class="text-sm font-bold text-slate-400 block mb-3">ุฑูู ุฅุฑุณุงู ุงูุจุงูู</label>
                                <select class="w-full bg-dark-900 text-white font-bold text-base rounded-xl p-3.5 cursor-pointer outline-none border border-dark-700 focus:border-brand" onchange="panelsArray[${pIdx}].channelId=this.value">
                                    <option value="">-- ุงุฎุชุฑ ุงูุฑูู --</option>
                                    ${chsHTML.replace(`value="${panel.channelId}"`, `value="${panel.channelId}" selected`)}
                                </select>
                            </div>
                            
                            <div class="bg-dark-800 p-5 rounded-2xl border border-dark-600 shadow-inner">
                                <label class="text-sm font-bold text-slate-400 block mb-3">ูุณู ูุชุญ ุงูุชุฐุงูุฑ (Category)</label>
                                <select class="w-full bg-dark-900 text-white font-bold text-base rounded-xl p-3.5 cursor-pointer outline-none border border-dark-700 focus:border-brand" onchange="panelsArray[${pIdx}].categoryId=this.value">
                                    <option value="">-- ุงุฎุชุฑ ุงููุณู --</option>
                                    ${catsHTML.replace(`value="${panel.categoryId}"`, `value="${panel.categoryId}" selected`)}
                                </select>
                            </div>
                            
                            <div class="md:col-span-2 bg-dark-800 p-5 rounded-2xl border border-dark-600 shadow-inner">
                                <label class="text-sm font-bold text-slate-400 block mb-3">ูุตู ุงูุจุงูู ุงูุฎุงุฑุฌู (Description)</label>
                                <textarea class="w-full bg-dark-900 text-white text-base rounded-xl p-4 outline-none resize-y border border-dark-700 focus:border-brand leading-relaxed" rows="3" placeholder="ุงูุชุจ ููุง ุงููุตู ุงูุฐู ุณูุธูุฑ ููุฃุนุถุงุก ูู ุงูุฅููุจุฏ ุงูุฎุงุฑุฌู..." onchange="panelsArray[${pIdx}].panelDescription=this.value">${panel.panelDescription || ''}</textarea>
                            </div>
                        </div>

                        <div class="p-8 bg-dark-900/50 rounded-3xl border border-dark-700 shadow-inner">
                            <h4 class="text-2xl font-black text-brand-light mb-6">๐ ุฃุฒุฑุงุฑ ุงูุจุงูู ูููุงูุฐูุง</h4>
                            ${buttonsHTML}
                            
                            <button type="button" onclick="panelsArray[${pIdx}].buttons.push({id:'btn_'+Math.random().toString(36).substr(2,7),label:'ุฒุฑ ุฌุฏูุฏ',buttonStyle:'Primary',requireModal:false,insideEmbedTitle:'ุชุฐูุฑุฉ ุฌุฏูุฏุฉ',modalAnswersEmbedColor:'#2b2d31'}); renderAllPanels();" class="w-full mt-6 py-5 border-2 border-dashed border-brand/60 bg-brand/10 hover:bg-brand/20 rounded-2xl text-brand-light font-black text-lg transition-all shadow-md transform hover:-translate-y-1">
                                โ ุฅุถุงูุฉ ุฒุฑ ุฌุฏูุฏ ููุฐุง ุงูุจุงูู
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        // ุฏุงูุฉ ุฅุถุงูุฉ ุจุงูู ุฌุฏูุฏ ูุงุฑุบ ููุฌูุฒ ุจุงูุนูุงููู
        function addNewPanelUI() { 
            panelsArray.push({
                panelId: 'pnl_' + Math.random().toString(36).substr(2,7), 
                panelTitle: 'ุจุงูู ุชุฐุงูุฑ ุฌุฏูุฏ', 
                panelColor: '#5865F2', 
                panelDescription: 'ูุทูุจ ุงูุฏุนู ุงูููู ูุฑุฌู ุงูุถุบุท ุนูู ุงูุฒุฑ ุฃุฏูุงู.',
                buttons: []
            }); 
            renderAllPanels(); 
        }

        // -----------------------------------------------------------
        // ๐ ุฏุงูุฉ ุงูุญูุธ ุงูุณุญุฑูุฉ (ูููุน ูุณุญ ุงูุฏุงุชุง ุงููุนูุฏุฉ)
        // -----------------------------------------------------------
        function syncAllDataBeforeSave() {
            // ููู ูู ุงูุจูุงูุงุช ูู ุงููุตูููุงุช (ุงููุญุฑูุงุช) ุฅูู ุญููู HTML ูุฎููุฉ ูุจู ุงูุฅุฑุณุงู ููุฑุงู
            document.getElementById('hidden_warn_ar').value = warnAr.join('\n');
            document.getElementById('hidden_warn_en').value = warnEn.join('\n');
            document.getElementById('mm_modalFieldsData').value = JSON.stringify(mmFields);
            document.getElementById('ticketPanelsData').value = JSON.stringify(panelsArray);
            document.getElementById('lvl_roleRewardsData').value = JSON.stringify(roleRewards);
            
            // ุชุญููู ุงูุฒุฑ ููุนุทู ุงูุทุจุงุน ุงูุชุญููู ูุงููุฌุงุญ
            const saveBtn = document.querySelector('button[type="submit"]');
            saveBtn.innerHTML = '<span class="mr-3 ml-2 text-3xl animate-spin">โณ</span> ุฌุงุฑู ุงูุญูุธ ูุชุญุฏูุซ ุงูุณูุฑูุฑ...';
            saveBtn.classList.replace('bg-emerald-500', 'bg-emerald-700');
            saveBtn.classList.replace('border-emerald-400/50', 'border-emerald-700');
            saveBtn.classList.remove('hover:bg-emerald-400', 'hover:-translate-y-2');
            
            return true; // ุงูุณูุงุญ ููููุฑู ุจุงูุงูุทูุงู
        }

        // -----------------------------------------------------------
        // ๐ ูุญุฑู ุงูุชุฑุฌูุฉ ุงูุฏููุงูููู (ููุจ ุงูุฏุงุดุจูุฑุฏ LTR ู RTL)
        // -----------------------------------------------------------
        const systemLang = document.querySelector('select[name="language"]');
        function applyDashboardLanguage() {
            if(systemLang && systemLang.value === 'en') {
                document.documentElement.setAttribute('dir', 'ltr');
                document.documentElement.setAttribute('lang', 'en');
                document.body.style.fontFamily = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
            } else {
                document.documentElement.setAttribute('dir', 'rtl');
                document.documentElement.setAttribute('lang', 'ar');
                document.body.style.fontFamily = "'Tajawal', sans-serif";
            }
        }
        if(systemLang) {
            systemLang.addEventListener('change', applyDashboardLanguage);
            applyDashboardLanguage();
        }

        // -----------------------------------------------------------
        // ๐ ุชุดุบูู ุฌููุน ุงููุญุฑูุงุช ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        // -----------------------------------------------------------
        window.onload = () => { 
            // ุฑุณู ุฌููุน ุงูุฃูุณุงู ุงูุฏููุงููููุฉ
            renderWarns('ar'); 
            renderWarns('en'); 
            renderMmFields(); 
            renderAllPanels(); 
            renderLvlRewards();
        };
    </script>
</body>
</html>
